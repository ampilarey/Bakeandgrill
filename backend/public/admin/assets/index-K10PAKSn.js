import{r,a as re,u as Q,N as ae,R as H,b as C,c as N,d as de,B as ce}from"./vendor-ik71KGou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const a of d.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(l){if(l.ep)return;l.ep=!0;const d=s(l);fetch(l.href,d)}})();var Z={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fe=r,xe=Symbol.for("react.element"),ge=Symbol.for("react.fragment"),ue=Object.prototype.hasOwnProperty,pe=fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,he={key:!0,ref:!0,__self:!0,__source:!0};function ee(t,n,s){var o,l={},d=null,a=null;s!==void 0&&(d=""+s),n.key!==void 0&&(d=""+n.key),n.ref!==void 0&&(a=n.ref);for(o in n)ue.call(n,o)&&!he.hasOwnProperty(o)&&(l[o]=n[o]);if(t&&t.defaultProps)for(o in n=t.defaultProps,n)l[o]===void 0&&(l[o]=n[o]);return{$$typeof:xe,type:t,key:d,ref:a,props:l,_owner:pe.current}}A.Fragment=ge;A.jsx=ee;A.jsxs=ee;Z.exports=A;var e=Z.exports,V={},J=re;V.createRoot=J.createRoot,V.hydrateRoot=J.hydrateRoot;const ye="/api";async function v(t,n={}){var l;const s=localStorage.getItem("admin_token"),o=await fetch(`${ye}${t}`,{headers:{"Content-Type":"application/json",Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{},...n.headers},...n});if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.message??((l=Object.values(d.errors??{})[0])==null?void 0:l[0])??`HTTP ${o.status}`)}return o.json()}async function me(t){return v("/auth/staff/pin-login",{method:"POST",body:JSON.stringify({pin:t})})}async function je(){return v("/auth/me")}async function be(){await v("/auth/logout",{method:"POST"})}async function te(t){const n=new URLSearchParams;return t!=null&&t.status&&n.set("status",t.status),t!=null&&t.type&&n.set("type",t.type),t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.date&&n.set("date",t.date),v(`/orders?${n}`)}async function ve(t){return v(`/orders/${t}`)}async function Se(){return v("/kds/orders")}async function ke(t){await v(`/kds/orders/${t}/start`,{method:"POST"})}async function Y(t){await v(`/kds/orders/${t}/bump`,{method:"POST"})}async function we(t){await v(`/kds/orders/${t}/recall`,{method:"POST"})}async function Ce(){return v("/admin/promotions")}async function _e(t){return v("/admin/promotions",{method:"POST",body:JSON.stringify(t)})}async function K(t,n){return v(`/admin/promotions/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function ze(t){await v(`/admin/promotions/${t}`,{method:"DELETE"})}async function Te(t){const n=new URLSearchParams;return t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.search&&n.set("search",t.search),v(`/admin/loyalty/accounts?${n}`)}async function Pe(t,n,s){await v(`/admin/loyalty/accounts/${t}/adjust`,{method:"POST",body:JSON.stringify({delta:n,reason:s})})}async function Re(t){return v(`/admin/loyalty/accounts/${t}/ledger`)}async function Be(t){const n=new URLSearchParams;return t!=null&&t.type&&n.set("type",t.type),t!=null&&t.status&&n.set("status",t.status),t!=null&&t.page&&n.set("page",String(t.page)),v(`/admin/sms/logs?${n}`)}async function Le(){return v("/admin/sms/logs/stats")}async function We(){return v("/admin/sms/campaigns")}async function De(t){return v("/admin/sms/campaigns/preview",{method:"POST",body:JSON.stringify(t)})}async function Oe(t){return v("/admin/sms/campaigns",{method:"POST",body:JSON.stringify(t)})}async function Ie(t){await v(`/admin/sms/campaigns/${t}/send`,{method:"POST"})}async function Ae(t){await v(`/admin/sms/campaigns/${t}/cancel`,{method:"POST"})}async function Ee(t){const n=new URLSearchParams;return t!=null&&t.from&&n.set("from",t.from),t!=null&&t.to&&n.set("to",t.to),v(`/reports/sales-summary?${n}`)}const Fe=[{to:"/orders",icon:"ðŸ“‹",label:"Orders"},{to:"/kds",icon:"ðŸ‘¨â€ðŸ³",label:"Kitchen"},{to:"/delivery",icon:"ðŸ›µ",label:"Delivery"},{to:"/promotions",icon:"ðŸ·ï¸",label:"Promos"},{to:"/loyalty",icon:"â­",label:"Loyalty"},{to:"/sms",icon:"ðŸ“±",label:"SMS"},{to:"/reports",icon:"ðŸ“Š",label:"Reports"}];function Me({user:t,children:n,onLogout:s}){const o=Q(),[l,d]=r.useState(!1),a=async()=>{try{await be()}catch{}localStorage.removeItem("admin_token"),s(),o("/login")};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"#f1f5f9"},children:[e.jsxs("aside",{style:{width:l?64:220,background:"#0f172a",display:"flex",flexDirection:"column",transition:"width 0.2s",flexShrink:0,position:"sticky",top:0,height:"100vh",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:l?"20px 12px":"20px 20px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",gap:10,cursor:"pointer"},onClick:()=>d(!l),children:[e.jsx("span",{style:{fontSize:22,flexShrink:0},children:"ðŸž"}),!l&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:800,fontSize:14},children:"Bake & Grill"}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:"Admin"})]})]}),e.jsx("nav",{style:{flex:1,padding:"12px 0"},children:Fe.map(({to:x,icon:f,label:p})=>e.jsxs(ae,{to:x,style:({isActive:c})=>({display:"flex",alignItems:"center",gap:12,padding:l?"12px 20px":"11px 20px",color:c?"#38bdf8":"#94a3b8",textDecoration:"none",fontWeight:c?700:400,fontSize:14,background:c?"rgba(56,189,248,0.08)":"transparent",borderLeft:c?"3px solid #38bdf8":"3px solid transparent",transition:"all 0.15s",whiteSpace:"nowrap"}),children:[e.jsx("span",{style:{fontSize:18,flexShrink:0},children:f}),!l&&e.jsx("span",{children:p})]},x))}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid #1e293b"},children:[!l&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:t.role??"Staff"})]}),e.jsx("button",{onClick:a,style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.2)",color:"#f87171",borderRadius:8,padding:l?"8px":"8px 14px",fontSize:12,fontWeight:600,width:"100%",cursor:"pointer"},children:l?"â†’":"Logout"})]})]}),e.jsx("main",{style:{flex:1,minWidth:0,padding:"24px",overflowY:"auto"},children:n})]})}function W({title:t,subtitle:n,action:s}){return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:t}),n&&e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:2},children:n})]}),s&&e.jsx("div",{children:s})]})}function S({children:t,style:n}){return e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",padding:"20px 24px",boxShadow:"0 1px 4px rgba(0,0,0,0.04)",...n},children:t})}function w({label:t,color:n}){const s={green:{bg:"#dcfce7",text:"#166534"},yellow:{bg:"#fef9c3",text:"#854d0e"},blue:{bg:"#dbeafe",text:"#1e40af"},red:{bg:"#fee2e2",text:"#991b1b"},gray:{bg:"#f1f5f9",text:"#475569"},teal:{bg:"#ccfbf1",text:"#115e59"},orange:{bg:"#ffedd5",text:"#9a3412"}},o=s[n]??s.gray;return e.jsx("span",{style:{background:o.bg,color:o.text,padding:"2px 10px",borderRadius:999,fontSize:12,fontWeight:600,display:"inline-block"},children:t})}function b({children:t,onClick:n,variant:s="primary",disabled:o,small:l,style:d}){const a={primary:{background:"#0ea5e9",color:"#fff",border:"none"},secondary:{background:"#f1f5f9",color:"#0f172a",border:"1px solid #e2e8f0"},danger:{background:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca"},ghost:{background:"transparent",color:"#64748b",border:"1px solid #e2e8f0"}};return e.jsx("button",{onClick:n,disabled:o,style:{...a[s],padding:l?"5px 12px":"9px 18px",borderRadius:9,fontSize:l?12:14,fontWeight:600,cursor:o?"not-allowed":"pointer",opacity:o?.6:1,transition:"opacity 0.15s",...d},children:t})}function _({value:t,onChange:n,placeholder:s,type:o="text",style:l}){return e.jsx("input",{type:o,value:t,onChange:d=>n(d.target.value),placeholder:s,style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",outline:"none",width:"100%",background:"#fff",...l}})}function O({value:t,onChange:n,options:s,style:o}){return e.jsx("select",{value:t,onChange:l=>n(l.target.value),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",background:"#fff",cursor:"pointer",...o},children:s.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})}function T(){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:"Loadingâ€¦"})}function P({message:t}){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8",fontSize:14},children:t})}function R({message:t}){return e.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#991b1b",borderRadius:10,padding:"12px 16px",fontSize:13,marginBottom:16},children:t})}function D(t){return{pending:"yellow",preparing:"blue",ready:"teal",paid:"green",completed:"gray",cancelled:"red",out_for_delivery:"teal",draft:"gray",sent:"green",failed:"red",active:"green",expired:"gray"}[t]??"gray"}function $e({onLogin:t}){const[n,s]=r.useState(""),[o,l]=r.useState(""),[d,a]=r.useState(!1),x=async()=>{if(!(n.length<4)){l(""),a(!0);try{const c=await me(n);localStorage.setItem("admin_token",c.token),t(c.token,c.user)}catch(c){l(c.message),s("")}finally{a(!1)}}},f=c=>{n.length<8&&s(i=>i+c)},p=()=>s("");return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,padding:"40px 36px",width:"100%",maxWidth:380,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:"ðŸž"}),e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:"Bake & Grill"}),e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:4},children:"Staff Admin â€” Enter your PIN"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:10,marginBottom:24},children:Array.from({length:6}).map((c,i)=>e.jsx("div",{style:{width:44,height:44,borderRadius:10,border:`2px solid ${n.length>i?"#0ea5e9":"#e2e8f0"}`,background:n.length>i?"#e0f2fe":"#f8fafc",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:800,color:"#0f172a",transition:"all 0.15s"},children:n.length>i?"â—":""},i))}),o&&e.jsx("div",{style:{background:"#fee2e2",color:"#991b1b",borderRadius:10,padding:"10px 14px",fontSize:13,marginBottom:16,textAlign:"center"},children:o}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:10},children:["1","2","3","4","5","6","7","8","9","","0","âŒ«"].map(c=>e.jsx("button",{onClick:()=>{c==="âŒ«"?s(i=>i.slice(0,-1)):c!==""&&f(c)},disabled:c==="",style:{height:56,borderRadius:12,border:"1px solid #e2e8f0",background:c==="âŒ«"?"#fee2e2":c===""?"transparent":"#f8fafc",fontSize:18,fontWeight:700,color:c==="âŒ«"?"#991b1b":"#0f172a",cursor:c===""?"default":"pointer",transition:"background 0.1s"},children:c},c))}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[e.jsx("button",{onClick:p,style:{flex:1,height:48,borderRadius:12,border:"1px solid #e2e8f0",background:"#f1f5f9",fontSize:14,fontWeight:600,color:"#64748b",cursor:"pointer"},children:"Clear"}),e.jsx("button",{onClick:x,disabled:n.length<4||d,style:{flex:2,height:48,borderRadius:12,border:"none",background:d||n.length<4?"#bae6fd":"#0ea5e9",fontSize:14,fontWeight:700,color:"#fff",cursor:"pointer",transition:"background 0.15s"},children:d?"Signing inâ€¦":"Sign In â†’"})]})]})})}const Ne=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"preparing",label:"Preparing"},{value:"ready",label:"Ready"},{value:"paid",label:"Paid"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],Ve=[{value:"",label:"All Types"},{value:"dine_in",label:"Dine In"},{value:"takeaway",label:"Takeaway"},{value:"online_pickup",label:"Online Pickup"},{value:"delivery",label:"Delivery"}];function U(t){return{dine_in:"Dine In",takeaway:"Takeaway",online_pickup:"Online",delivery:"Delivery",preorder:"Pre-order"}[t]??t}function Ue(t){const n=Date.now()-new Date(t).getTime(),s=Math.floor(n/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const o=Math.floor(s/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`}function qe({orderId:t,onClose:n}){const[s,o]=r.useState(null),[l,d]=r.useState(!0);return r.useEffect(()=>{ve(t).then(a=>{o(a.order),d(!1)}).catch(()=>d(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"stretch",justifyContent:"flex-end"},onClick:n,children:e.jsxs("div",{style:{width:420,background:"#fff",height:"100%",overflowY:"auto",padding:24,boxShadow:"-4px 0 20px rgba(0,0,0,0.1)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:18,color:"#0f172a"},children:s?`#${s.order_number}`:"Order Details"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#64748b"},children:"âœ•"})]}),l&&e.jsx(T,{}),!l&&!s&&e.jsx(P,{message:"Order not found."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:20},children:[e.jsx(w,{label:s.status,color:D(s.status)}),e.jsx(w,{label:U(s.type),color:"blue"})]}),e.jsxs("div",{style:{background:"#f8fafc",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx(L,{label:"Order #",value:s.order_number}),e.jsx(L,{label:"Type",value:U(s.type)}),e.jsx(L,{label:"Time",value:new Date(s.created_at).toLocaleString()}),s.table_number&&e.jsx(L,{label:"Table",value:s.table_number}),s.customer_name&&e.jsx(L,{label:"Customer",value:s.customer_name}),s.customer_phone&&e.jsx(L,{label:"Phone",value:s.customer_phone}),s.paid_at&&e.jsx(L,{label:"Paid at",value:new Date(s.paid_at).toLocaleString()})]}),s.type==="delivery"&&s.delivery_address_line1&&e.jsxs("div",{style:{background:"#eff6ff",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#1e40af",marginBottom:8},children:"Delivery Address"}),e.jsx("p",{style:{fontSize:14},children:s.delivery_address_line1}),s.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:s.delivery_island}),s.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:4},children:[s.delivery_contact_name," Â· ",s.delivery_contact_phone]})]}),s.items&&s.items.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#475569",marginBottom:8},children:"Items"}),s.items.map(a=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,paddingBottom:6,marginBottom:6,borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:[a.quantity,"Ã— ",a.name]}),e.jsxs("span",{style:{color:"#0ea5e9",fontWeight:600},children:["MVR ",a.subtotal.toFixed(2)]})]},a.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:16,paddingTop:8},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["MVR ",s.total.toFixed(2)]})]})]}),s.notes&&e.jsxs("div",{style:{background:"#fefce8",borderRadius:10,padding:"12px 14px",fontSize:13,color:"#713f12"},children:["ðŸ“ ",s.notes]})]})]})})}function L({label:t,value:n}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:4},children:[e.jsx("span",{style:{color:"#64748b"},children:t}),e.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:n})]})}function He(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(""),[f,p]=r.useState(""),[c,i]=r.useState(null),[y,g]=r.useState(1),[h,u]=r.useState(1),z=async()=>{var j;o(!0),d("");try{const k=await te({status:a||void 0,type:f||void 0,page:y});n(k.data),u(((j=k.meta)==null?void 0:j.last_page)??1)}catch(k){d(k.message)}finally{o(!1)}};return r.useEffect(()=>{z()},[a,f,y]),r.useEffect(()=>{const j=setInterval(()=>void z(),3e4);return()=>clearInterval(j)},[a,f,y]),e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Orders",subtitle:"All customer and POS orders",action:e.jsx(b,{onClick:z,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(R,{message:l}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(O,{value:a,onChange:j=>{x(j),g(1)},options:Ne,style:{width:160}}),e.jsx(O,{value:f,onChange:j=>{p(j),g(1)},options:Ve,style:{width:160}})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No orders found."})}):e.jsxs(S,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Order #","Type","Status","Customer","Total","Time",""].map(j=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:j},j))})}),e.jsx("tbody",{children:t.map(j=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",transition:"background 0.1s"},onMouseEnter:k=>{k.currentTarget.style.background="#f8fafc"},onMouseLeave:k=>{k.currentTarget.style.background=""},children:[e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0f172a"},children:["#",j.order_number,j.type==="delivery"&&e.jsx("span",{style:{marginLeft:6,fontSize:12},children:"ðŸ›µ"})]}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(w,{label:U(j.type),color:"blue"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(w,{label:j.status,color:D(j.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:j.customer_name??j.table_number??"â€”"}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:600,color:"#0ea5e9"},children:["MVR ",j.total.toFixed(2)]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:Ue(j.created_at)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(b,{small:!0,onClick:()=>i(j.id),variant:"ghost",children:"View"})})]},j.id))})]}),h>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,padding:"16px"},children:[e.jsx(b,{small:!0,variant:"secondary",disabled:y<=1,onClick:()=>g(j=>j-1),children:"â† Prev"}),e.jsxs("span",{style:{lineHeight:"30px",fontSize:13,color:"#64748b"},children:["Page ",y," of ",h]}),e.jsx(b,{small:!0,variant:"secondary",disabled:y>=h,onClick:()=>g(j=>j+1),children:"Next â†’"})]})]}),c&&e.jsx(qe,{orderId:c,onClose:()=>i(null)})]})}function Je(t){const n=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(n<60)return`${n}s`;const s=Math.floor(n/60);return s<60?`${s}m ${n%60}s`:`${Math.floor(s/60)}h ${s%60}m`}function ne(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n>=15?"#ef4444":n>=8?"#f97316":"#22c55e"}function Ye(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(null),f=async()=>{try{const h=await Se();n(h.data),d("")}catch(h){d(h.message)}finally{o(!1)}};r.useEffect(()=>{f();const h=setInterval(()=>void f(),1e4);return()=>clearInterval(h)},[]);const p=async(h,u)=>{x(h);try{await u(h),await f()}catch(z){d(z.message)}finally{x(null)}},c=t.filter(h=>h.status==="pending"),i=t.filter(h=>h.status==="preparing"),y=t.filter(h=>h.status==="ready"),g=({title:h,items:u,color:z,children:j})=>e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:z}}),e.jsx("span",{style:{fontWeight:700,fontSize:14,color:"#0f172a"},children:h}),e.jsx("span",{style:{background:"#f1f5f9",color:"#64748b",borderRadius:999,padding:"1px 8px",fontSize:12,fontWeight:600},children:u.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:u.length===0?e.jsx("div",{style:{color:"#94a3b8",fontSize:13,padding:"20px 0"},children:"Nothing here"}):u.map(k=>e.jsx("div",{style:{background:"#fff",borderRadius:14,padding:"16px",border:`2px solid ${ne(k.created_at)}22`,boxShadow:"0 2px 6px rgba(0,0,0,0.04)"},children:j(k)},k.id))})]});return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Kitchen Display",subtitle:"Live ticket board â€” auto-refreshes every 10s",action:e.jsx(b,{onClick:f,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(R,{message:l}),s&&t.length===0?e.jsx(S,{children:e.jsx(P,{message:"Loading kitchen ticketsâ€¦"})}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:20},children:[e.jsx(g,{title:"Pending",items:c,color:"#f59e0b",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsx(b,{small:!0,onClick:()=>p(h.id,ke),disabled:a===h.id,style:{marginTop:12,width:"100%",background:"#f59e0b",color:"#fff",border:"none"},children:a===h.id?"â€¦":"Start Cooking"})]})}),e.jsx(g,{title:"Cooking",items:i,color:"#3b82f6",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsx(b,{small:!0,onClick:()=>p(h.id,Y),disabled:a===h.id,style:{marginTop:12,width:"100%",background:"#3b82f6",color:"#fff",border:"none"},children:a===h.id?"â€¦":"Mark Ready âœ“"})]})}),e.jsx(g,{title:"Ready",items:y,color:"#22c55e",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx(b,{small:!0,onClick:()=>p(h.id,Y),disabled:a===h.id,style:{flex:1,background:"#22c55e",color:"#fff",border:"none"},children:"Complete"}),e.jsx(b,{small:!0,onClick:()=>p(h.id,we),disabled:a===h.id,variant:"ghost",children:"Recall"})]})]})})]})]})}function F({ticket:t}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:"#0f172a"},children:["#",t.order_number]}),t.table_number&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#64748b"},children:["Table ",t.table_number]}),t.delivery_island&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#0ea5e9"},children:["ðŸ›µ ",t.delivery_island]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{color:ne(t.created_at),fontSize:13,fontWeight:700},children:Je(t.created_at)}),e.jsx(w,{label:t.type,color:D(t.status)})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.items.map((n,s)=>e.jsxs("div",{style:{fontSize:13,color:"#374151"},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0f172a"},children:[n.quantity,"Ã—"]})," ",n.name,n.modifiers&&n.modifiers.length>0&&e.jsxs("span",{style:{color:"#6b7280",fontSize:11,display:"block",marginLeft:16},children:["+ ",n.modifiers.join(", ")]})]},s))})]})}function Ke(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n<1?"just now":n<60?`${n}m ago`:`${Math.floor(n/60)}h ago`}function Ge(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(null),f=async()=>{try{const i=await te({type:"delivery"});n(i.data),d("")}catch(i){d(i.message)}finally{o(!1)}};r.useEffect(()=>{f();const i=setInterval(()=>void f(),3e4);return()=>clearInterval(i)},[]);const p=t.filter(i=>!["completed","cancelled"].includes(i.status)),c=t.filter(i=>["completed","cancelled"].includes(i.status));return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Delivery Orders",subtitle:"All delivery orders â€” auto-refreshes every 30s",action:e.jsx(b,{onClick:f,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(R,{message:l}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No delivery orders yet."})}):e.jsxs(e.Fragment,{children:[p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#475569",marginBottom:12},children:["ACTIVE (",p.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16,marginBottom:28},children:p.map(i=>e.jsx(G,{order:i,onSelect:x},i.id))})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#94a3b8",marginBottom:12},children:["COMPLETED (",c.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:c.slice(0,10).map(i=>e.jsx(G,{order:i,onSelect:x},i.id))})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>x(null),children:e.jsx(S,{style:{width:"100%",maxWidth:480},children:e.jsxs("div",{onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:18},children:["#",a.order_number]}),e.jsx("button",{onClick:()=>x(null),style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),e.jsx(w,{label:a.status,color:D(a.status)}),e.jsxs("div",{style:{background:"#f0f9ff",borderRadius:10,padding:16,marginTop:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#0369a1",marginBottom:8},children:"Delivery Details"}),e.jsx("p",{style:{fontSize:14,color:"#0f172a"},children:a.delivery_address_line1??"N/A"}),a.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:a.delivery_island}),a.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:6},children:["ðŸ‘¤ ",a.delivery_contact_name," Â· ",a.delivery_contact_phone]})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:18},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:"#0ea5e9"},children:["MVR ",a.total.toFixed(2)]})]})]})})})]})}function G({order:t,onSelect:n}){const s=t.status==="pending"&&Date.now()-new Date(t.created_at).getTime()>6e5;return e.jsxs(S,{style:{border:s?"2px solid #ef4444":void 0,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("span",{style:{fontWeight:800,fontSize:15,color:"#0f172a"},children:["#",t.order_number]}),e.jsx(w,{label:t.status,color:D(t.status)})]}),e.jsx("p",{style:{fontSize:14,color:"#374151",marginBottom:4},children:t.delivery_address_line1??"â€”"}),t.delivery_island&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ“ ",t.delivery_island]}),t.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ‘¤ ",t.delivery_contact_name]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[e.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:Ke(t.created_at)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0ea5e9"},children:["MVR ",t.total.toFixed(2)]}),e.jsx(b,{small:!0,variant:"ghost",onClick:()=>n(t),children:"Details"})]})]})]})}const Xe={name:"",code:"",type:"flat",discount_value:0,scope:"order",min_order_amount:null,max_uses:null,stackable:!1,active:!0,starts_at:null,expires_at:null};function Qe({initial:t,onSave:n,onCancel:s}){const[o,l]=r.useState(t),[d,a]=r.useState(!1),[x,f]=r.useState(""),p=(i,y)=>l(g=>({...g,[i]:y})),c=async()=>{if(!o.name||!o.code){f("Name and code are required.");return}f(""),a(!0);try{await n(o)}catch(i){f(i.message)}finally{a(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[x&&e.jsx(R,{message:x}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(B,{label:"Promo Name",children:e.jsx(_,{value:o.name,onChange:i=>p("name",i),placeholder:"e.g. Ramadan Special"})}),e.jsx(B,{label:"Code",children:e.jsx(_,{value:o.code,onChange:i=>p("code",i.toUpperCase()),placeholder:"e.g. RAMADAN20"})}),e.jsx(B,{label:"Discount Type",children:e.jsx(O,{value:o.type,onChange:i=>p("type",i),options:[{value:"flat",label:"Fixed (MVR)"},{value:"percent",label:"Percentage (%)"}]})}),e.jsx(B,{label:`Discount Value (${o.type==="percent"?"%":"MVR"})`,children:e.jsx(_,{value:String(o.discount_value),onChange:i=>p("discount_value",parseFloat(i)||0),type:"number"})}),e.jsx(B,{label:"Min Order Amount (MVR)",children:e.jsx(_,{value:o.min_order_amount!=null?String(o.min_order_amount):"",onChange:i=>p("min_order_amount",i?parseFloat(i):null),type:"number",placeholder:"No minimum"})}),e.jsx(B,{label:"Max Uses",children:e.jsx(_,{value:o.max_uses!=null?String(o.max_uses):"",onChange:i=>p("max_uses",i?parseInt(i):null),type:"number",placeholder:"Unlimited"})}),e.jsx(B,{label:"Starts At",children:e.jsx(_,{value:o.starts_at??"",onChange:i=>p("starts_at",i||null),type:"datetime-local"})}),e.jsx(B,{label:"Expires At",children:e.jsx(_,{value:o.expires_at??"",onChange:i=>p("expires_at",i||null),type:"datetime-local"})})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o.active,onChange:i=>p("active",i.target.checked)}),"Active"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o.stackable,onChange:i=>p("stackable",i.target.checked)}),"Stackable"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(b,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(b,{onClick:c,disabled:d,children:d?"Savingâ€¦":"Save Promo"})]})]})}function B({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function Ze(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(!1),[f,p]=r.useState(null),c=async()=>{o(!0);try{const u=await Ce();n(u.data)}catch(u){d(u.message)}finally{o(!1)}};r.useEffect(()=>{c()},[]);const i=async u=>{await _e(u),x(!1),await c()},y=async u=>{f&&(await K(f.id,u),p(null),await c())},g=async u=>{confirm("Delete this promotion?")&&(await ze(u),await c())},h=async u=>{await K(u.id,{active:!u.active}),await c()};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Promotions",subtitle:"Manage promo codes and discounts",action:!a&&!f?e.jsx(b,{onClick:()=>x(!0),children:"+ New Promo"}):void 0}),l&&e.jsx(R,{message:l}),(a||f)&&e.jsxs(S,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:18,color:"#0f172a"},children:a?"Create New Promotion":`Edit: ${f==null?void 0:f.name}`}),e.jsx(Qe,{initial:f?{name:f.name,code:f.code,type:f.type,discount_value:f.discount_value,scope:f.scope,min_order_amount:f.min_order_amount,max_uses:f.max_uses,stackable:f.stackable,active:f.active,starts_at:f.starts_at,expires_at:f.expires_at}:Xe,onSave:a?i:y,onCancel:()=>{x(!1),p(null)}})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No promotions yet. Create your first promo code."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Code","Discount","Uses","Valid","Status",""].map(u=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:u},u))})}),e.jsx("tbody",{children:t.map(u=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:u.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 8px",borderRadius:6,fontSize:13,fontWeight:700,letterSpacing:1},children:u.code})}),e.jsx("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:u.type==="percent"?`${u.discount_value}%`:`MVR ${u.discount_value}`}),e.jsxs("td",{style:{padding:"12px 16px",color:"#475569"},children:[u.used_count,u.max_uses?` / ${u.max_uses}`:""]}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569",fontSize:12},children:u.expires_at?new Date(u.expires_at).toLocaleDateString():"âˆž"}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(w,{label:u.active?"Active":"Inactive",color:u.active?"green":"gray"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(b,{small:!0,variant:"ghost",onClick:()=>h(u),children:u.active?"Disable":"Enable"}),e.jsx(b,{small:!0,variant:"secondary",onClick:()=>{p(u),x(!1)},children:"Edit"}),e.jsx(b,{small:!0,variant:"danger",onClick:()=>g(u.id),children:"Delete"})]})})]},u.id))})]})})]})}const et={bronze:"orange",silver:"gray",gold:"yellow",platinum:"blue"};function tt({customerId:t,name:n,onClose:s}){const[o,l]=r.useState([]),[d,a]=r.useState(!0);return r.useEffect(()=>{Re(t).then(x=>l(x.data)).finally(()=>a(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s,children:e.jsx(S,{style:{width:"100%",maxWidth:520,maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsxs("div",{onClick:x=>x.stopPropagation(),style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:17},children:["Ledger â€” ",n]}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),d?e.jsx(T,{}):o.length===0?e.jsx(P,{message:"No transactions yet."}):e.jsx("div",{style:{overflowY:"auto",flex:1},children:o.map(x=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,color:"#374151"},children:x.reason}),e.jsx("p",{style:{fontSize:11,color:"#94a3b8"},children:new Date(x.created_at).toLocaleString()})]}),e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:x.delta>=0?"#22c55e":"#ef4444"},children:[x.delta>=0?"+":"",x.delta," pts"]})]},x.id))})]})})})}function nt({account:t,onClose:n,onDone:s}){const[o,l]=r.useState(""),[d,a]=r.useState(""),[x,f]=r.useState(!1),[p,c]=r.useState(""),i=async()=>{const y=parseInt(o);if(!y||!d){c("Delta and reason are required.");return}c(""),f(!0);try{await Pe(t.customer_id,y,d),s(),n()}catch(g){c(g.message)}finally{f(!1)}};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:n,children:e.jsx(S,{style:{width:"100%",maxWidth:400},children:e.jsxs("div",{onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:17},children:"Adjust Points"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer"},children:"âœ•"})]}),e.jsxs("p",{style:{color:"#475569",fontSize:14,marginBottom:16},children:[t.customer_name??t.customer_phone," â€” current balance: ",e.jsxs("strong",{children:[t.points_balance," pts"]})]}),p&&e.jsx(R,{message:p}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Points (use âˆ’ to deduct)"}),e.jsx(_,{value:o,onChange:l,placeholder:"e.g. 100 or -50",type:"number"})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Reason"}),e.jsx(_,{value:d,onChange:a,placeholder:"e.g. Goodwill adjustment"})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(b,{variant:"ghost",onClick:n,children:"Cancel"}),e.jsx(b,{onClick:i,disabled:x,children:x?"Savingâ€¦":"Apply Adjustment"})]})]})})})}function st(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(""),[f,p]=r.useState(null),[c,i]=r.useState(null),y=async()=>{o(!0);try{const g=await Te({search:a||void 0});n(g.data)}catch(g){d(g.message)}finally{o(!1)}};return r.useEffect(()=>{y()},[a]),e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Loyalty Accounts",subtitle:"View and manage customer loyalty points"}),l&&e.jsx(R,{message:l}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(_,{value:a,onChange:x,placeholder:"Search by name or phoneâ€¦",style:{maxWidth:320}})}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No loyalty accounts found."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Customer","Phone","Tier","Balance","Held","Lifetime",""].map(g=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:g},g))})}),e.jsx("tbody",{children:t.map(g=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:g.customer_name??"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.customer_phone}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(w,{label:g.tier,color:et[g.tier]??"gray"})}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0ea5e9"},children:[g.points_balance.toLocaleString()," pts"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8"},children:g.points_held>0?`${g.points_held} held`:"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.lifetime_points.toLocaleString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(b,{small:!0,variant:"ghost",onClick:()=>i(g),children:"Ledger"}),e.jsx(b,{small:!0,variant:"secondary",onClick:()=>p(g),children:"Adjust"})]})})]},g.id))})]})}),f&&e.jsx(nt,{account:f,onClose:()=>p(null),onDone:y}),c&&e.jsx(tt,{customerId:c.customer_id,name:c.customer_name??c.customer_phone,onClose:()=>i(null)})]})}function ot(){const[t,n]=r.useState([]),[s,o]=r.useState(null),[l,d]=r.useState(!0),[a,x]=r.useState(""),[f,p]=r.useState(""),c=async()=>{d(!0);try{const[i,y]=await Promise.all([Be({type:a||void 0,status:f||void 0}),Le()]);n(i.data),o(y)}finally{d(!1)}};return r.useEffect(()=>{c()},[a,f]),e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:14,marginBottom:20},children:[e.jsx(M,{label:"Total SMS",value:s.total,color:"#0ea5e9"}),e.jsx(M,{label:"Sent",value:s.sent,color:"#22c55e"}),e.jsx(M,{label:"Failed",value:s.failed,color:"#ef4444"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsx(O,{value:a,onChange:x,options:[{value:"",label:"All Types"},{value:"otp",label:"OTP"},{value:"promotion",label:"Promotion"},{value:"campaign",label:"Campaign"},{value:"transactional",label:"Transactional"}],style:{width:160}}),e.jsx(O,{value:f,onChange:p,options:[{value:"",label:"All Statuses"},{value:"sent",label:"Sent"},{value:"failed",label:"Failed"},{value:"demo",label:"Demo"}],style:{width:140}}),e.jsx(b,{variant:"secondary",onClick:c,children:"â†» Refresh"})]}),l&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No SMS logs found."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["To","Type","Status","Message","Segments","Cost","Sent At"].map(i=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:11},children:i},i))})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:i.to}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(w,{label:i.type,color:"blue"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(w,{label:i.status,color:D(i.status)})}),e.jsxs("td",{style:{padding:"10px 14px",color:"#475569",maxWidth:200},children:[e.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.message}),i.error_message&&e.jsx("span",{style:{color:"#ef4444",fontSize:11},children:i.error_message})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#64748b",textAlign:"center"},children:i.segments}),e.jsxs("td",{style:{padding:"10px 14px",color:"#0ea5e9",fontWeight:600},children:["MVR ",i.cost_estimate_mvr]}),e.jsx("td",{style:{padding:"10px 14px",color:"#94a3b8",fontSize:11},children:i.sent_at?new Date(i.sent_at).toLocaleString():"â€”"})]},i.id))})]})})]})}function it(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(!1),[f,p]=r.useState(""),[c,i]=r.useState(""),[y,g]=r.useState(null),[h,u]=r.useState(!1),[z,j]=r.useState(!1),k=async()=>{o(!0);try{const m=await We();n(m.data)}catch(m){d(m.message)}finally{o(!1)}};r.useEffect(()=>{k()},[]);const se=async()=>{if(c){u(!0);try{const m=await De({message:c,criteria:{}});g(m)}catch(m){d(m.message)}finally{u(!1)}}},oe=async()=>{if(!(!f||!c)){j(!0);try{await Oe({name:f,message:c,criteria:{}}),x(!1),p(""),i(""),g(null),await k()}catch(m){d(m.message)}finally{j(!1)}}},ie=async m=>{if(confirm("Send this campaign to all recipients?"))try{await Ie(m),await k()}catch(E){d(E.message)}},le=async m=>{if(confirm("Cancel this campaign?"))try{await Ae(m),await k()}catch(E){d(E.message)}},I=c.length,q=I<=160?1:Math.ceil(I/153);return e.jsxs(e.Fragment,{children:[l&&e.jsx(R,{message:l}),!a&&e.jsx(b,{onClick:()=>x(!0),style:{marginBottom:20},children:"+ New Campaign"}),a&&e.jsxs(S,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:16},children:"New SMS Campaign"}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Campaign Name"}),e.jsx(_,{value:f,onChange:p,placeholder:"e.g. Eid Special Offer"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569"},children:"Message"}),e.jsxs("span",{style:{fontSize:11,color:I>160?"#ef4444":"#94a3b8"},children:[I," chars Â· ",q," segment",q>1?"s":""]})]}),e.jsx("textarea",{value:c,onChange:m=>i(m.target.value),placeholder:"Type your SMS message hereâ€¦",rows:4,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"10px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical"}})]}),y&&e.jsx("div",{style:{background:"#f0f9ff",borderRadius:10,padding:"12px 16px",marginBottom:14},children:e.jsxs("p",{style:{fontSize:14,fontWeight:600,color:"#0369a1"},children:["Preview: ",y.recipient_count," recipients Â· Est. MVR ",y.estimated_cost_mvr]})}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx(b,{variant:"secondary",onClick:se,disabled:h||!c,children:h?"Checkingâ€¦":"ðŸ‘ Preview Audience"}),e.jsx(b,{onClick:oe,disabled:z||!f||!c,children:z?"Creatingâ€¦":"Create Draft"}),e.jsx(b,{variant:"ghost",onClick:()=>{x(!1),g(null)},children:"Cancel"})]})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No campaigns yet."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Status","Recipients","Sent","Cost","Created",""].map(m=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:m},m))})}),e.jsx("tbody",{children:t.map(m=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:m.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(w,{label:m.status,color:D(m.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:m.total_recipients}),e.jsxs("td",{style:{padding:"12px 16px"},children:[e.jsx("span",{style:{color:"#22c55e"},children:m.sent_count}),m.failed_count>0&&e.jsxs("span",{style:{color:"#ef4444",marginLeft:4},children:["/ ",m.failed_count," failed"]})]}),e.jsxs("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:["MVR ",m.total_cost_mvr??"â€”"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:new Date(m.created_at).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[m.status==="draft"&&e.jsx(b,{small:!0,onClick:()=>ie(m.id),style:{background:"#22c55e",color:"#fff",border:"none"},children:"Send"}),["draft","sending"].includes(m.status)&&e.jsx(b,{small:!0,variant:"danger",onClick:()=>le(m.id),children:"Cancel"})]})})]},m.id))})]})})]})}function M({label:t,value:n,color:s}){return e.jsxs(S,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:s},children:n.toLocaleString()}),e.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:4},children:t})]})}function lt(){const[t,n]=r.useState("logs");return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"SMS",subtitle:"Logs and bulk campaigns"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20,borderBottom:"2px solid #e2e8f0"},children:[["logs","Audit Logs"],["campaigns","Campaigns"]].map(([s,o])=>e.jsx("button",{onClick:()=>n(s),style:{padding:"10px 20px",fontSize:14,fontWeight:t===s?700:400,color:t===s?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",borderBottom:t===s?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:o},s))}),t==="logs"?e.jsx(ot,{}):e.jsx(it,{})]})}function X(){return new Date().toISOString().slice(0,10)}function rt(){const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().slice(0,10)}function $({label:t,value:n,sub:s,color:o="#0ea5e9"}){return e.jsxs(S,{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:6},children:t}),e.jsx("div",{style:{fontSize:28,fontWeight:800,color:o},children:n}),s&&e.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginTop:4},children:s})]})}function at(){const[t,n]=r.useState(null),[s,o]=r.useState(!0),[l,d]=r.useState(""),[a,x]=r.useState(rt()),[f,p]=r.useState(X()),c=async()=>{o(!0),d("");try{const y=await Ee({from:a,to:f});n(y)}catch(y){d(y.message)}finally{o(!1)}};r.useEffect(()=>{c()},[]);const i=y=>{const g=new Date;g.setDate(g.getDate()-y),x(g.toISOString().slice(0,10)),p(X())};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Reports",subtitle:"Sales overview"}),l&&e.jsx(R,{message:l}),e.jsx(S,{style:{marginBottom:20},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"From"}),e.jsx("input",{type:"date",value:a,onChange:y=>x(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"To"}),e.jsx("input",{type:"date",value:f,onChange:y=>p(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[[[0,"Today"],[7,"7 days"],[30,"30 days"],[90,"90 days"]].map(([y,g])=>e.jsx(b,{small:!0,variant:"secondary",onClick:()=>i(y),children:g},g)),e.jsx(b,{small:!0,onClick:c,children:"Apply"})]})]})}),s?e.jsx(T,{}):t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[e.jsx($,{label:"Total Revenue",value:`MVR ${t.total_revenue.toLocaleString(void 0,{minimumFractionDigits:2})}`,color:"#22c55e"}),e.jsx($,{label:"Orders",value:t.order_count.toLocaleString(),color:"#0ea5e9"}),e.jsx($,{label:"Avg Order Value",value:`MVR ${t.average_order_value.toFixed(2)}`,color:"#8b5cf6"})]}),e.jsxs(S,{children:[e.jsxs("p",{style:{color:"#64748b",fontSize:14,textAlign:"center",padding:"20px 0"},children:["Period: ",e.jsx("strong",{children:t.period})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Detailed breakdown reports (by item, category, staff) coming soon."})]})]})]})}function dt({user:t,children:n}){return t?e.jsx(e.Fragment,{children:n}):e.jsx(N,{to:"/login",replace:!0})}function ct(){const[t,n]=r.useState(null),[s,o]=r.useState(!0),l=Q();r.useEffect(()=>{if(!localStorage.getItem("admin_token")){o(!1);return}je().then(f=>n(f.user)).catch(()=>{localStorage.removeItem("admin_token"),l("/login")}).finally(()=>o(!1))},[]);const d=(x,f)=>{n(f),l("/orders")},a=()=>{n(null)};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9"},children:e.jsx("div",{style:{color:"#64748b",fontSize:14},children:"Loadingâ€¦"})}):e.jsxs(H,{children:[e.jsx(C,{path:"/login",element:e.jsx($e,{onLogin:d})}),e.jsx(C,{path:"/*",element:e.jsx(dt,{user:t,children:e.jsx(Me,{user:t,onLogout:a,children:e.jsxs(H,{children:[e.jsx(C,{index:!0,element:e.jsx(N,{to:"/orders",replace:!0})}),e.jsx(C,{path:"orders",element:e.jsx(He,{})}),e.jsx(C,{path:"kds",element:e.jsx(Ye,{})}),e.jsx(C,{path:"delivery",element:e.jsx(Ge,{})}),e.jsx(C,{path:"promotions",element:e.jsx(Ze,{})}),e.jsx(C,{path:"loyalty",element:e.jsx(st,{})}),e.jsx(C,{path:"sms",element:e.jsx(lt,{})}),e.jsx(C,{path:"reports",element:e.jsx(at,{})}),e.jsx(C,{path:"*",element:e.jsx(N,{to:"/orders",replace:!0})})]})})})})]})}V.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(ce,{basename:"/admin",children:e.jsx(ct,{})})}));
