import{r as a,a as Ee,u as he,N as De,R as ie,b as E,c as ee,d as Le,B as Be}from"./vendor-ik71KGou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=s(l);fetch(l.href,r)}})();var pe={exports:{}},G={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We=a,Ae=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),Oe=Object.prototype.hasOwnProperty,Me=We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fe={key:!0,ref:!0,__self:!0,__source:!0};function ye(t,n,s){var i,l={},r=null,d=null;s!==void 0&&(r=""+s),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(d=n.ref);for(i in n)Oe.call(n,i)&&!Fe.hasOwnProperty(i)&&(l[i]=n[i]);if(t&&t.defaultProps)for(i in n=t.defaultProps,n)l[i]===void 0&&(l[i]=n[i]);return{$$typeof:Ae,type:t,key:r,ref:d,props:l,_owner:Me.current}}G.Fragment=Ne;G.jsx=ye;G.jsxs=ye;pe.exports=G;var e=pe.exports,te={},ae=Ee;te.createRoot=ae.createRoot,te.hydrateRoot=ae.hydrateRoot;const $e="/api";async function S(t,n={}){var l;const s=localStorage.getItem("admin_token"),i=await fetch(`${$e}${t}`,{headers:{"Content-Type":"application/json",Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{},...n.headers},...n});if(!i.ok){const r=await i.json().catch(()=>({}));throw new Error(r.message??((l=Object.values(r.errors??{})[0])==null?void 0:l[0])??`HTTP ${i.status}`)}return i.json()}async function Ve(t){return S("/auth/staff/pin-login",{method:"POST",body:JSON.stringify({pin:t})})}async function He(){return S("/auth/me")}async function Ue(){await S("/auth/logout",{method:"POST"})}async function me(t){const n=new URLSearchParams;return t!=null&&t.status&&n.set("status",t.status),t!=null&&t.type&&n.set("type",t.type),t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.date&&n.set("date",t.date),S(`/orders?${n}`)}async function qe(t){return S(`/orders/${t}`)}async function Je(){return S("/kds/orders?status=pending,in_progress,paid")}async function Ye(t){await S(`/kds/orders/${t}/start`,{method:"POST"})}async function le(t){await S(`/kds/orders/${t}/bump`,{method:"POST"})}async function Ke(t){await S(`/kds/orders/${t}/recall`,{method:"POST"})}async function Ge(){return S("/admin/promotions")}async function Xe(t){return S("/admin/promotions",{method:"POST",body:JSON.stringify(t)})}async function re(t,n){return S(`/admin/promotions/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function Qe(t){await S(`/admin/promotions/${t}`,{method:"DELETE"})}async function Ze(t){const n=new URLSearchParams;return t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.search&&n.set("search",t.search),S(`/admin/loyalty/accounts?${n}`)}async function et(t,n,s){await S(`/admin/loyalty/accounts/${t}/adjust`,{method:"POST",body:JSON.stringify({delta:n,reason:s})})}async function tt(t){return S(`/admin/loyalty/accounts/${t}/ledger`)}async function nt(t){const n=new URLSearchParams;return t!=null&&t.type&&n.set("type",t.type),t!=null&&t.status&&n.set("status",t.status),t!=null&&t.page&&n.set("page",String(t.page)),S(`/admin/sms/logs?${n}`)}async function st(){const n=(await S("/admin/sms/logs/stats")).stats??[],s=n.reduce((d,h)=>d+h.count,0),i=n.filter(d=>d.status==="sent").reduce((d,h)=>d+h.count,0),l=n.filter(d=>d.status==="failed").reduce((d,h)=>d+h.count,0),r={};for(const d of n)r[d.type]=(r[d.type]??0)+d.count;return{total:s,sent:i,failed:l,by_type:r}}async function it(){return S("/admin/sms/campaigns")}async function at(t){return S("/admin/sms/campaigns/preview",{method:"POST",body:JSON.stringify(t)})}async function lt(t){return S("/admin/sms/campaigns",{method:"POST",body:JSON.stringify(t)})}async function rt(t){await S(`/admin/sms/campaigns/${t}/send`,{method:"POST"})}async function ot(t){await S(`/admin/sms/campaigns/${t}/cancel`,{method:"POST"})}async function dt(t){var r,d;const n=new URLSearchParams;t!=null&&t.from&&n.set("from",t.from),t!=null&&t.to&&n.set("to",t.to);const s=await S(`/reports/sales-summary?${n}`),i=((r=s.totals)==null?void 0:r.orders_count)??0,l=((d=s.totals)==null?void 0:d.total)??0;return{total_revenue:l,order_count:i,average_order_value:i>0?l/i:0,period:`${s.from} â€“ ${s.to}`}}async function ct(){return S("/categories?admin=1")}async function gt(t){return S("/categories",{method:"POST",body:JSON.stringify(t)})}async function oe(t,n){return S(`/categories/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function xt(t){await S(`/categories/${t}`,{method:"DELETE"})}async function ut(t){const n=new URLSearchParams({admin:"1"});return t!=null&&t.category_id&&n.set("category_id",String(t.category_id)),t!=null&&t.search&&n.set("search",t.search),t!=null&&t.page&&n.set("page",String(t.page)),S(`/items?${n}`)}async function ft(t){return S("/items",{method:"POST",body:JSON.stringify(t)})}async function ht(t,n){return S(`/items/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function pt(t){await S(`/items/${t}`,{method:"DELETE"})}async function yt(t){return S(`/items/${t}/toggle-availability`,{method:"PATCH"})}async function mt(){return S("/admin/staff")}async function jt(t){return S("/admin/staff",{method:"POST",body:JSON.stringify(t)})}async function de(t,n){return S(`/admin/staff/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function bt(t,n){await S(`/admin/staff/${t}/pin`,{method:"POST",body:JSON.stringify({pin:n})})}async function vt(t){await S(`/admin/staff/${t}`,{method:"DELETE"})}const St=[{to:"/orders",icon:"ðŸ“‹",label:"Orders"},{to:"/kds",icon:"ðŸ‘¨â€ðŸ³",label:"Kitchen"},{to:"/delivery",icon:"ðŸ›µ",label:"Delivery"},{to:"/menu",icon:"ðŸ½ï¸",label:"Menu"},{to:"/promotions",icon:"ðŸ·ï¸",label:"Promos"},{to:"/loyalty",icon:"â­",label:"Loyalty"},{to:"/sms",icon:"ðŸ“±",label:"SMS"},{to:"/reports",icon:"ðŸ“Š",label:"Reports"},{to:"/staff",icon:"ðŸ‘¥",label:"Staff"}];function _t({user:t,children:n,onLogout:s}){const i=he(),[l,r]=a.useState(!1),d=async()=>{try{await Ue()}catch{}localStorage.removeItem("admin_token"),s(),i("/login")};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"#f1f5f9"},children:[e.jsxs("aside",{style:{width:l?64:220,background:"#0f172a",display:"flex",flexDirection:"column",transition:"width 0.2s",flexShrink:0,position:"sticky",top:0,height:"100vh",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:l?"20px 12px":"20px 20px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",gap:10,cursor:"pointer"},onClick:()=>r(!l),children:[e.jsx("span",{style:{fontSize:22,flexShrink:0},children:"ðŸž"}),!l&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:800,fontSize:14},children:"Bake & Grill"}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:"Admin"})]})]}),e.jsx("nav",{style:{flex:1,padding:"12px 0"},children:St.map(({to:h,icon:u,label:p})=>e.jsxs(De,{to:h,style:({isActive:o})=>({display:"flex",alignItems:"center",gap:12,padding:l?"12px 20px":"11px 20px",color:o?"#38bdf8":"#94a3b8",textDecoration:"none",fontWeight:o?700:400,fontSize:14,background:o?"rgba(56,189,248,0.08)":"transparent",borderLeft:o?"3px solid #38bdf8":"3px solid transparent",transition:"all 0.15s",whiteSpace:"nowrap"}),children:[e.jsx("span",{style:{fontSize:18,flexShrink:0},children:u}),!l&&e.jsx("span",{children:p})]},h))}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid #1e293b"},children:[!l&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:t.role??"Staff"})]}),e.jsx("button",{onClick:d,style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.2)",color:"#f87171",borderRadius:8,padding:l?"8px":"8px 14px",fontSize:12,fontWeight:600,width:"100%",cursor:"pointer"},children:l?"â†’":"Logout"})]})]}),e.jsx("main",{style:{flex:1,minWidth:0,padding:"24px",overflowY:"auto"},children:n})]})}function A({title:t,subtitle:n,action:s}){return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:t}),n&&e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:2},children:n})]}),s&&e.jsx("div",{children:s})]})}function z({children:t,style:n}){return e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",padding:"20px 24px",boxShadow:"0 1px 4px rgba(0,0,0,0.04)",...n},children:t})}function P({label:t,color:n}){const s={green:{bg:"#dcfce7",text:"#166534"},yellow:{bg:"#fef9c3",text:"#854d0e"},blue:{bg:"#dbeafe",text:"#1e40af"},red:{bg:"#fee2e2",text:"#991b1b"},gray:{bg:"#f1f5f9",text:"#475569"},teal:{bg:"#ccfbf1",text:"#115e59"},orange:{bg:"#ffedd5",text:"#9a3412"}},i=s[n]??s.gray;return e.jsx("span",{style:{background:i.bg,color:i.text,padding:"2px 10px",borderRadius:999,fontSize:12,fontWeight:600,display:"inline-block"},children:t})}function j({children:t,onClick:n,variant:s="primary",disabled:i,small:l,style:r}){const d={primary:{background:"#0ea5e9",color:"#fff",border:"none"},secondary:{background:"#f1f5f9",color:"#0f172a",border:"1px solid #e2e8f0"},danger:{background:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca"},ghost:{background:"transparent",color:"#64748b",border:"1px solid #e2e8f0"}};return e.jsx("button",{onClick:n,disabled:i,style:{...d[s],padding:l?"5px 12px":"9px 18px",borderRadius:9,fontSize:l?12:14,fontWeight:600,cursor:i?"not-allowed":"pointer",opacity:i?.6:1,transition:"opacity 0.15s",...r},children:t})}function k({value:t,onChange:n,placeholder:s,type:i="text",style:l}){return e.jsx("input",{type:i,value:t,onChange:r=>n(r.target.value),placeholder:s,style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",outline:"none",width:"100%",background:"#fff",...l}})}function J({value:t,onChange:n,options:s,style:i}){return e.jsx("select",{value:t,onChange:l=>n(l.target.value),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",background:"#fff",cursor:"pointer",...i},children:s.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})}function D(){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:"Loadingâ€¦"})}function L({message:t}){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8",fontSize:14},children:t})}function T({message:t}){return e.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#991b1b",borderRadius:10,padding:"12px 16px",fontSize:13,marginBottom:16},children:t})}function q(t){return{pending:"yellow",preparing:"blue",in_progress:"blue",ready:"teal",paid:"green",completed:"gray",cancelled:"red",out_for_delivery:"teal",draft:"gray",sent:"green",failed:"red",active:"green",expired:"gray"}[t]??"gray"}function Ct({onLogin:t}){const[n,s]=a.useState(""),[i,l]=a.useState(""),[r,d]=a.useState(!1),h=async()=>{if(!(n.length<4)){l(""),d(!0);try{const o=await Ve(n);localStorage.setItem("admin_token",o.token),t(o.token,o.user)}catch(o){l(o.message),s("")}finally{d(!1)}}},u=o=>{n.length<8&&s(x=>x+o)},p=()=>s("");return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,padding:"40px 36px",width:"100%",maxWidth:380,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:"ðŸž"}),e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:"Bake & Grill"}),e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:4},children:"Staff Admin â€” Enter your PIN"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:10,marginBottom:24,minHeight:54,alignItems:"center"},children:n.length===0?e.jsx("span",{style:{color:"#94a3b8",fontSize:14},children:"Enter your PIN below"}):Array.from({length:n.length}).map((o,x)=>e.jsx("div",{style:{width:16,height:16,borderRadius:"50%",background:"#0ea5e9",transition:"all 0.1s"}},x))}),i&&e.jsx("div",{style:{background:"#fee2e2",color:"#991b1b",borderRadius:10,padding:"10px 14px",fontSize:13,marginBottom:16,textAlign:"center"},children:i}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:10},children:["1","2","3","4","5","6","7","8","9","","0","âŒ«"].map(o=>e.jsx("button",{onClick:()=>{o==="âŒ«"?s(x=>x.slice(0,-1)):o!==""&&u(o)},disabled:o==="",style:{height:56,borderRadius:12,border:"1px solid #e2e8f0",background:o==="âŒ«"?"#fee2e2":o===""?"transparent":"#f8fafc",fontSize:18,fontWeight:700,color:o==="âŒ«"?"#991b1b":"#0f172a",cursor:o===""?"default":"pointer",transition:"background 0.1s"},children:o},o))}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[e.jsx("button",{onClick:p,style:{flex:1,height:48,borderRadius:12,border:"1px solid #e2e8f0",background:"#f1f5f9",fontSize:14,fontWeight:600,color:"#64748b",cursor:"pointer"},children:"Clear"}),e.jsx("button",{onClick:h,disabled:n.length<4||r,style:{flex:2,height:48,borderRadius:12,border:"none",background:r||n.length<4?"#bae6fd":"#0ea5e9",fontSize:14,fontWeight:700,color:"#fff",cursor:"pointer",transition:"background 0.15s"},children:r?"Signing inâ€¦":"Sign In â†’"})]})]})})}const wt=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"preparing",label:"Preparing"},{value:"ready",label:"Ready"},{value:"paid",label:"Paid"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],kt=[{value:"",label:"All Types"},{value:"dine_in",label:"Dine In"},{value:"takeaway",label:"Takeaway"},{value:"online_pickup",label:"Online Pickup"},{value:"delivery",label:"Delivery"}];function ne(t){return{dine_in:"Dine In",takeaway:"Takeaway",online_pickup:"Online",delivery:"Delivery",preorder:"Pre-order"}[t]??t}function zt(t){const n=Date.now()-new Date(t).getTime(),s=Math.floor(n/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const i=Math.floor(s/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function Pt({orderId:t,onClose:n}){var d,h,u,p;const[s,i]=a.useState(null),[l,r]=a.useState(!0);return a.useEffect(()=>{qe(t).then(o=>{i(o.order),r(!1)}).catch(()=>r(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"stretch",justifyContent:"flex-end"},onClick:n,children:e.jsxs("div",{style:{width:420,background:"#fff",height:"100%",overflowY:"auto",padding:24,boxShadow:"-4px 0 20px rgba(0,0,0,0.1)"},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:18,color:"#0f172a"},children:s?`#${s.order_number}`:"Order Details"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#64748b"},children:"âœ•"})]}),l&&e.jsx(D,{}),!l&&!s&&e.jsx(L,{message:"Order not found."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:20},children:[e.jsx(P,{label:s.status,color:q(s.status)}),e.jsx(P,{label:ne(s.type),color:"blue"})]}),e.jsxs("div",{style:{background:"#f8fafc",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx(U,{label:"Order #",value:s.order_number}),e.jsx(U,{label:"Type",value:ne(s.type)}),e.jsx(U,{label:"Time",value:new Date(s.created_at).toLocaleString()}),s.table_number&&e.jsx(U,{label:"Table",value:s.table_number}),(((d=s.customer)==null?void 0:d.name)??s.customer_name)&&e.jsx(U,{label:"Customer",value:((h=s.customer)==null?void 0:h.name)??s.customer_name}),(((u=s.customer)==null?void 0:u.phone)??s.customer_phone)&&e.jsx(U,{label:"Phone",value:((p=s.customer)==null?void 0:p.phone)??s.customer_phone}),s.paid_at&&e.jsx(U,{label:"Paid at",value:new Date(s.paid_at).toLocaleString()})]}),s.type==="delivery"&&s.delivery_address_line1&&e.jsxs("div",{style:{background:"#eff6ff",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#1e40af",marginBottom:8},children:"Delivery Address"}),e.jsx("p",{style:{fontSize:14},children:s.delivery_address_line1}),s.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:s.delivery_island}),s.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:4},children:[s.delivery_contact_name," Â· ",s.delivery_contact_phone]})]}),s.items&&s.items.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#475569",marginBottom:8},children:"Items"}),s.items.map(o=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,paddingBottom:6,marginBottom:6,borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:[o.quantity,"Ã— ",o.item_name]}),e.jsxs("span",{style:{color:"#0ea5e9",fontWeight:600},children:["MVR ",(o.total_price??0).toFixed(2)]})]},o.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:16,paddingTop:8},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["MVR ",s.total.toFixed(2)]})]})]}),s.notes&&e.jsxs("div",{style:{background:"#fefce8",borderRadius:10,padding:"12px 14px",fontSize:13,color:"#713f12"},children:["ðŸ“ ",s.notes]})]})]})})}function U({label:t,value:n}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:4},children:[e.jsx("span",{style:{color:"#64748b"},children:t}),e.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:n})]})}function Tt(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(""),[u,p]=a.useState(""),[o,x]=a.useState(null),[y,g]=a.useState(1),[m,f]=a.useState(1),w=async()=>{var b;i(!0),r("");try{const C=await me({status:d||void 0,type:u||void 0,page:y});n(C.data),f(((b=C.meta)==null?void 0:b.last_page)??1)}catch(C){r(C.message)}finally{i(!1)}};return a.useEffect(()=>{w()},[d,u,y]),a.useEffect(()=>{const b=setInterval(()=>void w(),3e4);return()=>clearInterval(b)},[d,u,y]),e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Orders",subtitle:"All customer and POS orders",action:e.jsx(j,{onClick:w,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(T,{message:l}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(J,{value:d,onChange:b=>{h(b),g(1)},options:wt,style:{width:160}}),e.jsx(J,{value:u,onChange:b=>{p(b),g(1)},options:kt,style:{width:160}})]}),s&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No orders found."})}):e.jsxs(z,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Order #","Type","Status","Customer","Total","Time",""].map(b=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:b},b))})}),e.jsx("tbody",{children:t.map(b=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",transition:"background 0.1s"},onMouseEnter:C=>{C.currentTarget.style.background="#f8fafc"},onMouseLeave:C=>{C.currentTarget.style.background=""},children:[e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0f172a"},children:["#",b.order_number,b.type==="delivery"&&e.jsx("span",{style:{marginLeft:6,fontSize:12},children:"ðŸ›µ"})]}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:ne(b.type),color:"blue"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:b.status,color:q(b.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:b.customer_name??b.table_number??"â€”"}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:600,color:"#0ea5e9"},children:["MVR ",b.total.toFixed(2)]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:zt(b.created_at)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(j,{small:!0,onClick:()=>x(b.id),variant:"ghost",children:"View"})})]},b.id))})]}),m>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,padding:"16px"},children:[e.jsx(j,{small:!0,variant:"secondary",disabled:y<=1,onClick:()=>g(b=>b-1),children:"â† Prev"}),e.jsxs("span",{style:{lineHeight:"30px",fontSize:13,color:"#64748b"},children:["Page ",y," of ",m]}),e.jsx(j,{small:!0,variant:"secondary",disabled:y>=m,onClick:()=>g(b=>b+1),children:"Next â†’"})]})]}),o&&e.jsx(Pt,{orderId:o,onClose:()=>x(null)})]})}function It(t){const n=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(n<60)return`${n}s`;const s=Math.floor(n/60);return s<60?`${s}m ${n%60}s`:`${Math.floor(s/60)}h ${s%60}m`}function je(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n>=15?"#ef4444":n>=8?"#f97316":"#22c55e"}function Rt(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(null),u=async()=>{try{const m=await Je();n(m.orders),r("")}catch(m){r(m.message)}finally{i(!1)}};a.useEffect(()=>{u();const m=setInterval(()=>void u(),1e4);return()=>clearInterval(m)},[]);const p=async(m,f)=>{h(m);try{await f(m),await u()}catch(w){r(w.message)}finally{h(null)}},o=t.filter(m=>["pending","paid"].includes(m.status)),x=t.filter(m=>m.status==="in_progress"),y=[],g=({title:m,items:f,color:w,children:b})=>e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:w}}),e.jsx("span",{style:{fontWeight:700,fontSize:14,color:"#0f172a"},children:m}),e.jsx("span",{style:{background:"#f1f5f9",color:"#64748b",borderRadius:999,padding:"1px 8px",fontSize:12,fontWeight:600},children:f.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:f.length===0?e.jsx("div",{style:{color:"#94a3b8",fontSize:13,padding:"20px 0"},children:"Nothing here"}):f.map(C=>e.jsx("div",{style:{background:"#fff",borderRadius:14,padding:"16px",border:`2px solid ${je(C.created_at)}22`,boxShadow:"0 2px 6px rgba(0,0,0,0.04)"},children:b(C)},C.id))})]});return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Kitchen Display",subtitle:"Live ticket board â€” auto-refreshes every 10s",action:e.jsx(j,{onClick:u,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(T,{message:l}),s&&t.length===0?e.jsx(z,{children:e.jsx(L,{message:"Loading kitchen ticketsâ€¦"})}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:20},children:[e.jsx(g,{title:"Pending",items:o,color:"#f59e0b",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(X,{ticket:m}),e.jsx(j,{small:!0,onClick:()=>p(m.id,Ye),disabled:d===m.id,style:{marginTop:12,width:"100%",background:"#f59e0b",color:"#fff",border:"none"},children:d===m.id?"â€¦":"Start Cooking"})]})}),e.jsx(g,{title:"Cooking",items:x,color:"#3b82f6",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(X,{ticket:m}),e.jsx(j,{small:!0,onClick:()=>p(m.id,le),disabled:d===m.id,style:{marginTop:12,width:"100%",background:"#3b82f6",color:"#fff",border:"none"},children:d===m.id?"â€¦":"Mark Ready âœ“"})]})}),e.jsx(g,{title:"Ready",items:y,color:"#22c55e",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(X,{ticket:m}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx(j,{small:!0,onClick:()=>p(m.id,le),disabled:d===m.id,style:{flex:1,background:"#22c55e",color:"#fff",border:"none"},children:"Complete"}),e.jsx(j,{small:!0,onClick:()=>p(m.id,Ke),disabled:d===m.id,variant:"ghost",children:"Recall"})]})]})})]})]})}function X({ticket:t}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:"#0f172a"},children:["#",t.order_number]}),t.table_number&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#64748b"},children:["Table ",t.table_number]}),t.delivery_island&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#0ea5e9"},children:["ðŸ›µ ",t.delivery_island]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{color:je(t.created_at),fontSize:13,fontWeight:700},children:It(t.created_at)}),e.jsx(P,{label:t.type,color:q(t.status)})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.items.map((n,s)=>e.jsxs("div",{style:{fontSize:13,color:"#374151"},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0f172a"},children:[n.quantity,"Ã—"]})," ",n.item_name,n.modifiers&&n.modifiers.length>0&&e.jsxs("span",{style:{color:"#6b7280",fontSize:11,display:"block",marginLeft:16},children:["+ ",n.modifiers.map(i=>i.modifier_name).join(", ")]})]},s))})]})}function Et(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n<1?"just now":n<60?`${n}m ago`:`${Math.floor(n/60)}h ago`}function Dt(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(null),u=async()=>{try{const x=await me({type:"delivery"});n(x.data),r("")}catch(x){r(x.message)}finally{i(!1)}};a.useEffect(()=>{u();const x=setInterval(()=>void u(),3e4);return()=>clearInterval(x)},[]);const p=t.filter(x=>!["completed","cancelled"].includes(x.status)),o=t.filter(x=>["completed","cancelled"].includes(x.status));return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Delivery Orders",subtitle:"All delivery orders â€” auto-refreshes every 30s",action:e.jsx(j,{onClick:u,variant:"secondary",children:"â†» Refresh"})}),l&&e.jsx(T,{message:l}),s&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No delivery orders yet."})}):e.jsxs(e.Fragment,{children:[p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#475569",marginBottom:12},children:["ACTIVE (",p.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16,marginBottom:28},children:p.map(x=>e.jsx(ce,{order:x,onSelect:h},x.id))})]}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#94a3b8",marginBottom:12},children:["COMPLETED (",o.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:o.slice(0,10).map(x=>e.jsx(ce,{order:x,onSelect:h},x.id))})]})]}),d&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>h(null),children:e.jsx(z,{style:{width:"100%",maxWidth:480},children:e.jsxs("div",{onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:18},children:["#",d.order_number]}),e.jsx("button",{onClick:()=>h(null),style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),e.jsx(P,{label:d.status,color:q(d.status)}),e.jsxs("div",{style:{background:"#f0f9ff",borderRadius:10,padding:16,marginTop:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#0369a1",marginBottom:8},children:"Delivery Details"}),e.jsx("p",{style:{fontSize:14,color:"#0f172a"},children:d.delivery_address_line1??"N/A"}),d.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:d.delivery_island}),d.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:6},children:["ðŸ‘¤ ",d.delivery_contact_name," Â· ",d.delivery_contact_phone]})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:18},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:"#0ea5e9"},children:["MVR ",d.total.toFixed(2)]})]})]})})})]})}function ce({order:t,onSelect:n}){const s=t.status==="pending"&&Date.now()-new Date(t.created_at).getTime()>6e5;return e.jsxs(z,{style:{border:s?"2px solid #ef4444":void 0,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("span",{style:{fontWeight:800,fontSize:15,color:"#0f172a"},children:["#",t.order_number]}),e.jsx(P,{label:t.status,color:q(t.status)})]}),e.jsx("p",{style:{fontSize:14,color:"#374151",marginBottom:4},children:t.delivery_address_line1??"â€”"}),t.delivery_island&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ“ ",t.delivery_island]}),t.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ‘¤ ",t.delivery_contact_name]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[e.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:Et(t.created_at)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0ea5e9"},children:["MVR ",t.total.toFixed(2)]}),e.jsx(j,{small:!0,variant:"ghost",onClick:()=>n(t),children:"Details"})]})]})]})}const Lt={name:"",code:"",type:"fixed",discount_value:0,scope:"order",min_order_laar:null,max_uses:null,stackable:!1,is_active:!0,starts_at:null,expires_at:null};function Bt({initial:t,onSave:n,onCancel:s}){const[i,l]=a.useState(t),[r,d]=a.useState(!1),[h,u]=a.useState(""),p=(f,w)=>l(b=>({...b,[f]:w})),o=i.type==="fixed"?String((i.discount_value/100).toFixed(2)):String(i.discount_value),x=f=>{const w=parseFloat(f)||0;p("discount_value",i.type==="fixed"?Math.round(w*100):w)},y=i.min_order_laar!=null?String((i.min_order_laar/100).toFixed(2)):"",g=f=>{p("min_order_laar",f?Math.round(parseFloat(f)*100):null)},m=async()=>{if(!i.name||!i.code){u("Name and code are required.");return}u(""),d(!0);try{await n(i)}catch(f){u(f.message)}finally{d(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[h&&e.jsx(T,{message:h}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(M,{label:"Promo Name",children:e.jsx(k,{value:i.name,onChange:f=>p("name",f),placeholder:"e.g. Ramadan Special"})}),e.jsx(M,{label:"Code",children:e.jsx(k,{value:i.code,onChange:f=>p("code",f.toUpperCase()),placeholder:"e.g. RAMADAN20"})}),e.jsx(M,{label:"Discount Type",children:e.jsx(J,{value:i.type,onChange:f=>p("type",f),options:[{value:"fixed",label:"Fixed Amount (MVR)"},{value:"percentage",label:"Percentage (%)"}]})}),e.jsx(M,{label:`Discount Value (${i.type==="percentage"?"%":"MVR"})`,children:e.jsx(k,{value:o,onChange:x,type:"number"})}),e.jsx(M,{label:"Min Order Amount (MVR)",children:e.jsx(k,{value:y,onChange:g,type:"number",placeholder:"No minimum"})}),e.jsx(M,{label:"Max Uses",children:e.jsx(k,{value:i.max_uses!=null?String(i.max_uses):"",onChange:f=>p("max_uses",f?parseInt(f):null),type:"number",placeholder:"Unlimited"})}),e.jsx(M,{label:"Starts At",children:e.jsx(k,{value:i.starts_at??"",onChange:f=>p("starts_at",f||null),type:"datetime-local"})}),e.jsx(M,{label:"Expires At",children:e.jsx(k,{value:i.expires_at??"",onChange:f=>p("expires_at",f||null),type:"datetime-local"})})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.is_active,onChange:f=>p("is_active",f.target.checked)}),"Active"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.stackable,onChange:f=>p("stackable",f.target.checked)}),"Stackable"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(j,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(j,{onClick:m,disabled:r,children:r?"Savingâ€¦":"Save Promo"})]})]})}function M({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function Wt(t){return t.type==="percentage"?`${t.discount_value}%`:t.type==="fixed"?`MVR ${(t.discount_value/100).toFixed(2)}`:t.type}function At(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(!1),[u,p]=a.useState(null),o=async()=>{i(!0);try{const f=await Ge();n(f.data)}catch(f){r(f.message)}finally{i(!1)}};a.useEffect(()=>{o()},[]);const x=async f=>{await Xe(f),h(!1),await o()},y=async f=>{u&&(await re(u.id,f),p(null),await o())},g=async f=>{confirm("Delete this promotion?")&&(await Qe(f),await o())},m=async f=>{await re(f.id,{is_active:!f.is_active}),await o()};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Promotions",subtitle:"Manage promo codes and discounts",action:!d&&!u?e.jsx(j,{onClick:()=>h(!0),children:"+ New Promo"}):void 0}),l&&e.jsx(T,{message:l}),(d||u)&&e.jsxs(z,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:18,color:"#0f172a"},children:d?"Create New Promotion":`Edit: ${u==null?void 0:u.name}`}),e.jsx(Bt,{initial:u?{name:u.name,code:u.code,type:u.type==="percentage"?"percentage":"fixed",discount_value:u.discount_value,scope:u.scope,min_order_laar:u.min_order_laar,max_uses:u.max_uses,stackable:u.stackable,is_active:u.is_active,starts_at:u.starts_at,expires_at:u.expires_at}:Lt,onSave:d?x:y,onCancel:()=>{h(!1),p(null)}})]}),s&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No promotions yet. Create your first promo code."})}):e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Code","Discount","Uses","Valid","Status",""].map(f=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:f},f))})}),e.jsx("tbody",{children:t.map(f=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:f.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 8px",borderRadius:6,fontSize:13,fontWeight:700,letterSpacing:1},children:f.code})}),e.jsx("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:Wt(f)}),e.jsxs("td",{style:{padding:"12px 16px",color:"#475569"},children:[f.redemptions_count,f.max_uses?` / ${f.max_uses}`:""]}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569",fontSize:12},children:f.expires_at?new Date(f.expires_at).toLocaleDateString():"âˆž"}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:f.is_active?"Active":"Inactive",color:f.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>m(f),children:f.is_active?"Disable":"Enable"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>{p(f),h(!1)},children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>g(f.id),children:"Delete"})]})})]},f.id))})]})})]})}const Nt={bronze:"orange",silver:"gray",gold:"yellow",platinum:"blue"};function Ot({customerId:t,name:n,onClose:s}){const[i,l]=a.useState([]),[r,d]=a.useState(!0);return a.useEffect(()=>{tt(t).then(h=>l(h.data)).finally(()=>d(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s,children:e.jsx(z,{style:{width:"100%",maxWidth:520,maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsxs("div",{onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:17},children:["Ledger â€” ",n]}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),r?e.jsx(D,{}):i.length===0?e.jsx(L,{message:"No transactions yet."}):e.jsx("div",{style:{overflowY:"auto",flex:1},children:i.map(h=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,color:"#374151"},children:h.reason}),e.jsx("p",{style:{fontSize:11,color:"#94a3b8"},children:new Date(h.created_at).toLocaleString()})]}),e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:h.delta>=0?"#22c55e":"#ef4444"},children:[h.delta>=0?"+":"",h.delta," pts"]})]},h.id))})]})})})}function Mt({account:t,onClose:n,onDone:s}){const[i,l]=a.useState(""),[r,d]=a.useState(""),[h,u]=a.useState(!1),[p,o]=a.useState(""),x=async()=>{const y=parseInt(i);if(!y||!r){o("Delta and reason are required.");return}o(""),u(!0);try{await et(t.customer_id,y,r),s(),n()}catch(g){o(g.message)}finally{u(!1)}};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:n,children:e.jsx(z,{style:{width:"100%",maxWidth:400},children:e.jsxs("div",{onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:17},children:"Adjust Points"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer"},children:"âœ•"})]}),e.jsxs("p",{style:{color:"#475569",fontSize:14,marginBottom:16},children:[t.customer_name??t.customer_phone," â€” current balance: ",e.jsxs("strong",{children:[t.points_balance," pts"]})]}),p&&e.jsx(T,{message:p}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Points (use âˆ’ to deduct)"}),e.jsx(k,{value:i,onChange:l,placeholder:"e.g. 100 or -50",type:"number"})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Reason"}),e.jsx(k,{value:r,onChange:d,placeholder:"e.g. Goodwill adjustment"})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(j,{variant:"ghost",onClick:n,children:"Cancel"}),e.jsx(j,{onClick:x,disabled:h,children:h?"Savingâ€¦":"Apply Adjustment"})]})]})})})}function Ft(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(""),[u,p]=a.useState(null),[o,x]=a.useState(null),y=async()=>{i(!0);try{const g=await Ze({search:d||void 0});n(g.data)}catch(g){r(g.message)}finally{i(!1)}};return a.useEffect(()=>{y()},[d]),e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Loyalty Accounts",subtitle:"View and manage customer loyalty points"}),l&&e.jsx(T,{message:l}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(k,{value:d,onChange:h,placeholder:"Search by name or phoneâ€¦",style:{maxWidth:320}})}),s&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No loyalty accounts found."})}):e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Customer","Phone","Tier","Balance","Held","Lifetime",""].map(g=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:g},g))})}),e.jsx("tbody",{children:t.map(g=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:g.customer_name??"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.customer_phone}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:g.tier,color:Nt[g.tier]??"gray"})}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0ea5e9"},children:[g.points_balance.toLocaleString()," pts"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8"},children:g.points_held>0?`${g.points_held} held`:"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.lifetime_points.toLocaleString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>x(g),children:"Ledger"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>p(g),children:"Adjust"})]})})]},g.id))})]})}),u&&e.jsx(Mt,{account:u,onClose:()=>p(null),onDone:y}),o&&e.jsx(Ot,{customerId:o.customer_id,name:o.customer_name??o.customer_phone,onClose:()=>x(null)})]})}function $t(){const[t,n]=a.useState([]),[s,i]=a.useState(null),[l,r]=a.useState(!0),[d,h]=a.useState(""),[u,p]=a.useState(""),o=async()=>{r(!0);try{const[x,y]=await Promise.all([nt({type:d||void 0,status:u||void 0}),st()]);n(x.data),i(y)}finally{r(!1)}};return a.useEffect(()=>{o()},[d,u]),e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:14,marginBottom:20},children:[e.jsx(Q,{label:"Total SMS",value:s.total,color:"#0ea5e9"}),e.jsx(Q,{label:"Sent",value:s.sent,color:"#22c55e"}),e.jsx(Q,{label:"Failed",value:s.failed,color:"#ef4444"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsx(J,{value:d,onChange:h,options:[{value:"",label:"All Types"},{value:"otp",label:"OTP"},{value:"promotion",label:"Promotion"},{value:"campaign",label:"Campaign"},{value:"transactional",label:"Transactional"}],style:{width:160}}),e.jsx(J,{value:u,onChange:p,options:[{value:"",label:"All Statuses"},{value:"sent",label:"Sent"},{value:"failed",label:"Failed"},{value:"demo",label:"Demo"}],style:{width:140}}),e.jsx(j,{variant:"secondary",onClick:o,children:"â†» Refresh"})]}),l&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No SMS logs found."})}):e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["To","Type","Status","Message","Segments","Cost","Sent At"].map(x=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:11},children:x},x))})}),e.jsx("tbody",{children:t.map(x=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:x.to}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:x.type,color:"blue"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:x.status,color:q(x.status)})}),e.jsxs("td",{style:{padding:"10px 14px",color:"#475569",maxWidth:200},children:[e.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:x.message}),x.error_message&&e.jsx("span",{style:{color:"#ef4444",fontSize:11},children:x.error_message})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#64748b",textAlign:"center"},children:x.segments}),e.jsxs("td",{style:{padding:"10px 14px",color:"#0ea5e9",fontWeight:600},children:["MVR ",x.cost_estimate_mvr]}),e.jsx("td",{style:{padding:"10px 14px",color:"#94a3b8",fontSize:11},children:x.sent_at?new Date(x.sent_at).toLocaleString():"â€”"})]},x.id))})]})})]})}function Vt(){const[t,n]=a.useState([]),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(!1),[u,p]=a.useState(""),[o,x]=a.useState(""),[y,g]=a.useState(null),[m,f]=a.useState(!1),[w,b]=a.useState(!1),C=async()=>{i(!0);try{const _=await it();n(_.data)}catch(_){r(_.message)}finally{i(!1)}};a.useEffect(()=>{C()},[]);const F=async()=>{if(o){f(!0);try{const _=await at({message:o,criteria:{}});g(_)}catch(_){r(_.message)}finally{f(!1)}}},v=async()=>{if(!(!u||!o)){b(!0);try{await lt({name:u,message:o,criteria:{}}),h(!1),p(""),x(""),g(null),await C()}catch(_){r(_.message)}finally{b(!1)}}},$=async _=>{if(confirm("Send this campaign to all recipients?"))try{await rt(_),await C()}catch(W){r(W.message)}},V=async _=>{if(confirm("Cancel this campaign?"))try{await ot(_),await C()}catch(W){r(W.message)}},N=o.length,Y=N<=160?1:Math.ceil(N/153);return e.jsxs(e.Fragment,{children:[l&&e.jsx(T,{message:l}),!d&&e.jsx(j,{onClick:()=>h(!0),style:{marginBottom:20},children:"+ New Campaign"}),d&&e.jsxs(z,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:16},children:"New SMS Campaign"}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Campaign Name"}),e.jsx(k,{value:u,onChange:p,placeholder:"e.g. Eid Special Offer"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569"},children:"Message"}),e.jsxs("span",{style:{fontSize:11,color:N>160?"#ef4444":"#94a3b8"},children:[N," chars Â· ",Y," segment",Y>1?"s":""]})]}),e.jsx("textarea",{value:o,onChange:_=>x(_.target.value),placeholder:"Type your SMS message hereâ€¦",rows:4,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"10px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical"}})]}),y&&e.jsx("div",{style:{background:"#f0f9ff",borderRadius:10,padding:"12px 16px",marginBottom:14},children:e.jsxs("p",{style:{fontSize:14,fontWeight:600,color:"#0369a1"},children:["Preview: ",y.recipient_count," recipients Â· Est. MVR ",y.estimated_cost_mvr]})}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx(j,{variant:"secondary",onClick:F,disabled:m||!o,children:m?"Checkingâ€¦":"ðŸ‘ Preview Audience"}),e.jsx(j,{onClick:v,disabled:w||!u||!o,children:w?"Creatingâ€¦":"Create Draft"}),e.jsx(j,{variant:"ghost",onClick:()=>{h(!1),g(null)},children:"Cancel"})]})]}),s&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No campaigns yet."})}):e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Status","Recipients","Sent","Cost","Created",""].map(_=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:_},_))})}),e.jsx("tbody",{children:t.map(_=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:_.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:_.status,color:q(_.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:_.total_recipients}),e.jsxs("td",{style:{padding:"12px 16px"},children:[e.jsx("span",{style:{color:"#22c55e"},children:_.sent_count}),_.failed_count>0&&e.jsxs("span",{style:{color:"#ef4444",marginLeft:4},children:["/ ",_.failed_count," failed"]})]}),e.jsxs("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:["MVR ",_.total_cost_mvr??"â€”"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:new Date(_.created_at).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[_.status==="draft"&&e.jsx(j,{small:!0,onClick:()=>$(_.id),style:{background:"#22c55e",color:"#fff",border:"none"},children:"Send"}),["draft","sending"].includes(_.status)&&e.jsx(j,{small:!0,variant:"danger",onClick:()=>V(_.id),children:"Cancel"})]})})]},_.id))})]})})]})}function Q({label:t,value:n,color:s}){return e.jsxs(z,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:s},children:n.toLocaleString()}),e.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:4},children:t})]})}function Ht(){const[t,n]=a.useState("logs");return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"SMS",subtitle:"Logs and bulk campaigns"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20,borderBottom:"2px solid #e2e8f0"},children:[["logs","Audit Logs"],["campaigns","Campaigns"]].map(([s,i])=>e.jsx("button",{onClick:()=>n(s),style:{padding:"10px 20px",fontSize:14,fontWeight:t===s?700:400,color:t===s?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",borderBottom:t===s?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:i},s))}),t==="logs"?e.jsx($t,{}):e.jsx(Vt,{})]})}function ge(){return new Date().toISOString().slice(0,10)}function Ut(){const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().slice(0,10)}function Z({label:t,value:n,sub:s,color:i="#0ea5e9"}){return e.jsxs(z,{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:6},children:t}),e.jsx("div",{style:{fontSize:28,fontWeight:800,color:i},children:n}),s&&e.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginTop:4},children:s})]})}function qt(){const[t,n]=a.useState(null),[s,i]=a.useState(!0),[l,r]=a.useState(""),[d,h]=a.useState(Ut()),[u,p]=a.useState(ge()),o=async()=>{i(!0),r("");try{const y=await dt({from:d,to:u});n(y)}catch(y){r(y.message)}finally{i(!1)}};a.useEffect(()=>{o()},[]);const x=y=>{const g=new Date;g.setDate(g.getDate()-y),h(g.toISOString().slice(0,10)),p(ge())};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Reports",subtitle:"Sales overview"}),l&&e.jsx(T,{message:l}),e.jsx(z,{style:{marginBottom:20},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"From"}),e.jsx("input",{type:"date",value:d,onChange:y=>h(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"To"}),e.jsx("input",{type:"date",value:u,onChange:y=>p(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[[[0,"Today"],[7,"7 days"],[30,"30 days"],[90,"90 days"]].map(([y,g])=>e.jsx(j,{small:!0,variant:"secondary",onClick:()=>x(y),children:g},g)),e.jsx(j,{small:!0,onClick:o,children:"Apply"})]})]})}),s?e.jsx(D,{}):t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[e.jsx(Z,{label:"Total Revenue",value:`MVR ${t.total_revenue.toLocaleString(void 0,{minimumFractionDigits:2})}`,color:"#22c55e"}),e.jsx(Z,{label:"Orders",value:t.order_count.toLocaleString(),color:"#0ea5e9"}),e.jsx(Z,{label:"Avg Order Value",value:`MVR ${t.average_order_value.toFixed(2)}`,color:"#8b5cf6"})]}),e.jsxs(z,{children:[e.jsxs("p",{style:{color:"#64748b",fontSize:14,textAlign:"center",padding:"20px 0"},children:["Period: ",e.jsx("strong",{children:t.period})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Detailed breakdown reports (by item, category, staff) coming soon."})]})]})]})}function I({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function be({value:t,onChange:n,placeholder:s,rows:i=3}){return e.jsx("textarea",{value:t,onChange:l=>n(l.target.value),placeholder:s,rows:i,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"}})}const Jt={name:"",name_dv:"",description:"",image_url:"",sort_order:"",is_active:!0};function xe({initial:t,title:n,onSave:s,onClose:i}){const[l,r]=a.useState(t),[d,h]=a.useState(!1),[u,p]=a.useState(""),o=(y,g)=>r(m=>({...m,[y]:g})),x=async()=>{if(!l.name.trim()){p("Category name is required.");return}p(""),h(!0);try{await s(l)}catch(y){p(y.message)}finally{h(!1)}};return e.jsxs(ve,{onClose:i,children:[e.jsx("h3",{style:{fontWeight:800,fontSize:17,marginBottom:20,color:"#0f172a"},children:n}),u&&e.jsx(T,{message:u}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(I,{label:"Name (English)",children:e.jsx(k,{value:l.name,onChange:y=>o("name",y),placeholder:"e.g. Grills"})}),e.jsx(I,{label:"Name (Dhivehi) â€” optional",children:e.jsx(k,{value:l.name_dv,onChange:y=>o("name_dv",y),placeholder:"Þ‹Þ¨ÞˆÞ¬Þ€Þ¨"})})]}),e.jsx(I,{label:"Description",children:e.jsx(be,{value:l.description,onChange:y=>o("description",y),placeholder:"Short descriptionâ€¦",rows:2})}),e.jsx(I,{label:"Image URL",children:e.jsx(k,{value:l.image_url,onChange:y=>o("image_url",y),placeholder:"https://â€¦"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(I,{label:"Sort Order",children:e.jsx(k,{value:l.sort_order,onChange:y=>o("sort_order",y),type:"number",placeholder:"0"})}),e.jsx(I,{label:"Status",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,height:38,cursor:"pointer",fontSize:14},children:[e.jsx("input",{type:"checkbox",checked:l.is_active,onChange:y=>o("is_active",y.target.checked)}),"Active (visible to customers)"]})})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:i,children:"Cancel"}),e.jsx(j,{onClick:x,disabled:d,children:d?"Savingâ€¦":"Save Category"})]})]})}function Yt(t){return{name:t.name,name_dv:t.name_dv??"",description:t.description??"",sku:t.sku??"",image_url:t.image_url??"",base_price:String(t.base_price),tax_rate:t.tax_rate!=null?String(t.tax_rate):"",sort_order:t.sort_order!=null?String(t.sort_order):"",is_active:t.is_active,is_available:t.is_available,category_id:t.category_id!=null?String(t.category_id):""}}function ue(t){return{name:t.name.trim(),name_dv:t.name_dv.trim()||null,description:t.description.trim()||null,sku:t.sku.trim()||null,image_url:t.image_url.trim()||null,base_price:parseFloat(t.base_price)||0,tax_rate:t.tax_rate!==""?parseFloat(t.tax_rate):null,sort_order:t.sort_order!==""?parseInt(t.sort_order):null,is_active:t.is_active,is_available:t.is_available,category_id:t.category_id!==""?parseInt(t.category_id):null}}function fe({initial:t,title:n,categories:s,onSave:i,onClose:l}){const[r,d]=a.useState(t),[h,u]=a.useState(!1),[p,o]=a.useState(""),x=(g,m)=>d(f=>({...f,[g]:m})),y=async()=>{if(!r.name.trim()){o("Item name is required.");return}if(!r.base_price||parseFloat(r.base_price)<0){o("Price must be 0 or more.");return}o(""),u(!0);try{await i(r)}catch(g){o(g.message)}finally{u(!1)}};return e.jsxs(ve,{onClose:l,wide:!0,children:[e.jsx("h3",{style:{fontWeight:800,fontSize:17,marginBottom:20,color:"#0f172a"},children:n}),p&&e.jsx(T,{message:p}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(I,{label:"Name (English) *",children:e.jsx(k,{value:r.name,onChange:g=>x("name",g),placeholder:"e.g. Chicken Grill"})}),e.jsx(I,{label:"Name (Dhivehi) â€” optional",children:e.jsx(k,{value:r.name_dv,onChange:g=>x("name_dv",g),placeholder:"Þ‹Þ¨ÞˆÞ¬Þ€Þ¨"})})]}),e.jsx(I,{label:"Description",children:e.jsx(be,{value:r.description,onChange:g=>x("description",g),placeholder:"Describe the itemâ€¦"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(I,{label:"Price (MVR) *",children:e.jsx(k,{value:r.base_price,onChange:g=>x("base_price",g),type:"number",placeholder:"0.00"})}),e.jsx(I,{label:"Tax Rate (%)",children:e.jsx(k,{value:r.tax_rate,onChange:g=>x("tax_rate",g),type:"number",placeholder:"0"})}),e.jsx(I,{label:"Sort Order",children:e.jsx(k,{value:r.sort_order,onChange:g=>x("sort_order",g),type:"number",placeholder:"0"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:12},children:[e.jsx(I,{label:"Category",children:e.jsxs("select",{value:r.category_id,onChange:g=>x("category_id",g.target.value),style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"",children:"â€” No category â€”"}),s.map(g=>e.jsx("option",{value:String(g.id),children:g.name},g.id))]})}),e.jsx(I,{label:"SKU / Internal Code",children:e.jsx(k,{value:r.sku,onChange:g=>x("sku",g),placeholder:"e.g. CHKGRL-01"})})]}),e.jsx(I,{label:"Image URL",children:e.jsx(k,{value:r.image_url,onChange:g=>x("image_url",g),placeholder:"https://â€¦"})}),r.image_url&&e.jsx("img",{src:r.image_url,alt:"preview",style:{height:80,width:80,objectFit:"cover",borderRadius:10,border:"1px solid #e2e8f0"},onError:g=>{g.target.style.display="none"}}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:g=>x("is_active",g.target.checked)}),"Active (exists in system)"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.is_available,onChange:g=>x("is_available",g.target.checked)}),"Available (orderable today)"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:l,children:"Cancel"}),e.jsx(j,{onClick:y,disabled:h,children:h?"Savingâ€¦":"Save Item"})]})]})}function ve({children:t,onClose:n,wide:s}){const i=a.useRef(null);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(15,23,42,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onMouseDown:l=>{l.target===l.currentTarget&&n()},children:e.jsx("div",{ref:i,style:{background:"#fff",borderRadius:16,padding:28,width:"100%",maxWidth:s?640:480,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:t})})}function Kt(){const[t,n]=a.useState("categories"),[s,i]=a.useState([]),[l,r]=a.useState([]),[d,h]=a.useState(!0),[u,p]=a.useState(""),[o,x]=a.useState(null),[y,g]=a.useState(""),[m,f]=a.useState(1),[w,b]=a.useState(1),[C,F]=a.useState(null),[v,$]=a.useState(!1),[V,N]=a.useState(null),[Y,_]=a.useState(!1),W=async()=>{h(!0);try{const c=await ct();i(c.data)}catch(c){p(c.message)}finally{h(!1)}},H=async(c=m)=>{var R;h(!0);try{const O=await ut({category_id:o??void 0,search:y||void 0,page:c});r(O.data),b(((R=O.meta)==null?void 0:R.last_page)??1)}catch(O){p(O.message)}finally{h(!1)}};a.useEffect(()=>{W()},[]),a.useEffect(()=>{t==="items"&&(f(1),H(1))},[t,o,y]);const _e=async c=>{await gt({name:c.name.trim(),name_dv:c.name_dv.trim()||null,description:c.description.trim()||null,image_url:c.image_url.trim()||null,sort_order:c.sort_order!==""?parseInt(c.sort_order):null}),$(!1),await W()},Ce=async c=>{C&&(await oe(C.id,{name:c.name.trim(),name_dv:c.name_dv.trim()||null,description:c.description.trim()||null,image_url:c.image_url.trim()||null,sort_order:c.sort_order!==""?parseInt(c.sort_order):null,is_active:c.is_active}),F(null),await W())},we=async c=>{if(confirm("Delete this category? It must have no items."))try{await xt(c),await W()}catch(R){p(R.message)}},ke=async c=>{await oe(c.id,{is_active:!c.is_active}),await W()},ze=async c=>{await ft(ue(c)),_(!1),await H()},Pe=async c=>{V&&(await ht(V.id,ue(c)),N(null),await H())},Te=async c=>{if(confirm("Delete this item?"))try{await pt(c),await H()}catch(R){p(R.message)}},Ie=async c=>{await yt(c.id),await H()},Re={name:"",name_dv:"",description:"",sku:"",image_url:"",base_price:"",tax_rate:"",sort_order:"",is_active:!0,is_available:!0,category_id:o!=null?String(o):""};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Menu Management",subtitle:"Categories, items, prices and availability",action:t==="categories"?e.jsx(j,{onClick:()=>$(!0),children:"+ New Category"}):e.jsx(j,{onClick:()=>_(!0),children:"+ New Item"})}),u&&e.jsx(T,{message:u}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:24,borderBottom:"2px solid #e2e8f0"},children:["categories","items"].map(c=>e.jsx("button",{onClick:()=>n(c),style:{padding:"10px 22px",fontSize:14,fontWeight:t===c?700:400,color:t===c?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",textTransform:"capitalize",borderBottom:t===c?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:c==="categories"?`Categories (${s.length})`:"Items"},c))}),t==="categories"&&(d&&s.length===0?e.jsx(D,{}):s.length===0?e.jsx(z,{children:e.jsx(L,{message:"No categories yet. Add your first one."})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:s.map(c=>{var R;return e.jsx(z,{style:{padding:"14px 18px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[c.image_url&&e.jsx("img",{src:c.image_url,alt:c.name,style:{width:52,height:52,objectFit:"cover",borderRadius:10,flexShrink:0},onError:O=>{O.target.style.display="none"}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:2},children:[e.jsx("span",{style:{fontWeight:700,fontSize:15},children:c.name}),c.name_dv&&e.jsx("span",{style:{color:"#94a3b8",fontSize:13},children:c.name_dv}),e.jsx(P,{label:c.is_active?"Active":"Hidden",color:c.is_active?"green":"gray"})]}),c.description&&e.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.description}),e.jsxs("p",{style:{fontSize:12,color:"#94a3b8",margin:"2px 0 0"},children:["Sort: ",c.sort_order??0," Â· ",((R=c.items)==null?void 0:R.length)??"?"," items"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexShrink:0},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>ke(c),children:c.is_active?"Hide":"Show"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>F(c),children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>we(c.id),children:"Delete"})]})]})},c.id)})})),t==="items"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("select",{value:o??"",onChange:c=>x(c.target.value?parseInt(c.target.value):null),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"8px 12px",fontSize:14,minWidth:180},children:[e.jsx("option",{value:"",children:"All Categories"}),s.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx(k,{value:y,onChange:g,placeholder:"Search by name or SKUâ€¦"})})]}),d&&l.length===0?e.jsx(D,{}):l.length===0?e.jsx(z,{children:e.jsx(L,{message:"No items found."})}):e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["","Name","Category","Price","Available","Active",""].map((c,R)=>e.jsx("th",{style:{padding:"11px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:c},R))})}),e.jsx("tbody",{children:l.map(c=>{var R;return e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",opacity:c.is_active?1:.5},children:[e.jsx("td",{style:{padding:"10px 14px",width:52},children:c.image_url?e.jsx("img",{src:c.image_url,alt:c.name,style:{width:40,height:40,objectFit:"cover",borderRadius:8},onError:O=>{O.target.style.display="none"}}):e.jsx("div",{style:{width:40,height:40,background:"#f1f5f9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:"ðŸ½"})}),e.jsxs("td",{style:{padding:"10px 14px"},children:[e.jsx("div",{style:{fontWeight:600},children:c.name}),c.sku&&e.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:c.sku})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#475569",fontSize:13},children:((R=c.category)==null?void 0:R.name)??e.jsx("span",{style:{color:"#cbd5e1"},children:"â€”"})}),e.jsxs("td",{style:{padding:"10px 14px",fontWeight:700,color:"#0ea5e9"},children:["MVR ",c.base_price.toFixed(2)]}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx("button",{onClick:()=>Ie(c),style:{background:c.is_available?"#dcfce7":"#fee2e2",color:c.is_available?"#16a34a":"#dc2626",border:"none",borderRadius:20,padding:"3px 12px",fontSize:12,fontWeight:700,cursor:"pointer"},children:c.is_available?"Yes":"No"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:c.is_active?"Active":"Hidden",color:c.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"secondary",onClick:()=>N(c),children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>Te(c.id),children:"Delete"})]})})]},c.id)})})]})}),w>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,marginTop:16},children:[e.jsx(j,{small:!0,variant:"secondary",disabled:m<=1,onClick:()=>{const c=m-1;f(c),H(c)},children:"â† Prev"}),e.jsxs("span",{style:{padding:"6px 14px",fontSize:14,color:"#64748b"},children:["Page ",m," of ",w]}),e.jsx(j,{small:!0,variant:"secondary",disabled:m>=w,onClick:()=>{const c=m+1;f(c),H(c)},children:"Next â†’"})]})]})]}),v&&e.jsx(xe,{initial:Jt,title:"New Category",onSave:_e,onClose:()=>$(!1)}),C&&e.jsx(xe,{initial:{name:C.name,name_dv:C.name_dv??"",description:C.description??"",image_url:C.image_url??"",sort_order:C.sort_order!=null?String(C.sort_order):"",is_active:C.is_active},title:`Edit: ${C.name}`,onSave:Ce,onClose:()=>F(null)}),Y&&e.jsx(fe,{initial:Re,title:"New Menu Item",categories:s,onSave:ze,onClose:()=>_(!1)}),V&&e.jsx(fe,{initial:Yt(V),title:`Edit: ${V.name}`,categories:s,onSave:Pe,onClose:()=>N(null)})]})}function B({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function Se({value:t,onChange:n,roles:s}){return e.jsxs("select",{value:t,onChange:i=>n(i.target.value),style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"",children:"â€” Select role â€”"}),s.map(i=>e.jsx("option",{value:String(i.id),children:i.name},i.id))]})}function K({value:t,onChange:n}){return e.jsx(k,{value:t,onChange:s=>{/^\d{0,8}$/.test(s)&&n(s)},type:"password",placeholder:"4â€“8 digit PIN"})}function Gt(t){return{owner:"purple",admin:"blue",manager:"teal",cashier:"yellow"}[t??""]??"gray"}function Xt(t){if(!t)return"Never";const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n<1?"Just now":n<60?`${n}m ago`:n<1440?`${Math.floor(n/60)}h ago`:new Date(t).toLocaleDateString()}function se({title:t,onClose:n,children:s}){return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(15,23,42,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onMouseDown:i=>{i.target===i.currentTarget&&n()},children:e.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:28,width:"100%",maxWidth:440,boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx("h3",{style:{fontWeight:800,fontSize:17,color:"#0f172a",margin:0},children:t}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8",lineHeight:1},children:"âœ•"})]}),s]})})}function Qt({roles:t,onSave:n,onClose:s}){const[i,l]=a.useState(""),[r,d]=a.useState(""),[h,u]=a.useState(""),[p,o]=a.useState(""),[x,y]=a.useState(""),[g,m]=a.useState(!1),[f,w]=a.useState(""),b=async()=>{if(!i.trim()){w("Name is required.");return}if(!r.trim()){w("Email is required.");return}if(!h){w("Select a role.");return}if(p.length<4){w("PIN must be at least 4 digits.");return}if(p!==x){w("PINs do not match.");return}w(""),m(!0);try{await n({name:i.trim(),email:r.trim(),role_id:parseInt(h),pin:p})}catch(C){w(C.message)}finally{m(!1)}};return e.jsxs(se,{title:"Add Staff Member",onClose:s,children:[f&&e.jsx(T,{message:f}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsx(B,{label:"Full Name",children:e.jsx(k,{value:i,onChange:l,placeholder:"e.g. Ahmed Ali"})}),e.jsx(B,{label:"Email",children:e.jsx(k,{value:r,onChange:d,placeholder:"ahmed@bakegrill.mv"})}),e.jsx(B,{label:"Role",children:e.jsx(Se,{value:h,onChange:u,roles:t})}),e.jsx(B,{label:"PIN",children:e.jsx(K,{value:p,onChange:o})}),e.jsx(B,{label:"Confirm PIN",children:e.jsx(K,{value:x,onChange:y})})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(j,{onClick:b,disabled:g,children:g?"Creatingâ€¦":"Create Staff"})]})]})}function Zt({member:t,roles:n,onSave:s,onClose:i}){const[l,r]=a.useState(t.name),[d,h]=a.useState(t.email),[u,p]=a.useState(t.role_id!=null?String(t.role_id):""),[o,x]=a.useState(t.is_active),[y,g]=a.useState(!1),[m,f]=a.useState(""),w=async()=>{if(!l.trim()){f("Name is required.");return}if(!u){f("Select a role.");return}f(""),g(!0);try{await s({name:l.trim(),email:d.trim(),role_id:parseInt(u),is_active:o})}catch(b){f(b.message)}finally{g(!1)}};return e.jsxs(se,{title:`Edit: ${t.name}`,onClose:i,children:[m&&e.jsx(T,{message:m}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsx(B,{label:"Full Name",children:e.jsx(k,{value:l,onChange:r,placeholder:"Full name"})}),e.jsx(B,{label:"Email",children:e.jsx(k,{value:d,onChange:h,placeholder:"email@example.com"})}),e.jsx(B,{label:"Role",children:e.jsx(Se,{value:u,onChange:p,roles:n})}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o,onChange:b=>x(b.target.checked)}),"Active (can log in)"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:i,children:"Cancel"}),e.jsx(j,{onClick:w,disabled:y,children:y?"Savingâ€¦":"Save Changes"})]})]})}function en({member:t,onSave:n,onClose:s}){const[i,l]=a.useState(""),[r,d]=a.useState(""),[h,u]=a.useState(!1),[p,o]=a.useState(""),x=async()=>{if(i.length<4){o("PIN must be at least 4 digits.");return}if(i!==r){o("PINs do not match.");return}o(""),u(!0);try{await n(i)}catch(y){o(y.message)}finally{u(!1)}};return e.jsxs(se,{title:`Change PIN â€” ${t.name}`,onClose:s,children:[p&&e.jsx(T,{message:p}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsx(B,{label:"New PIN",children:e.jsx(K,{value:i,onChange:l})}),e.jsx(B,{label:"Confirm New PIN",children:e.jsx(K,{value:r,onChange:d})})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(j,{onClick:x,disabled:h,children:h?"Savingâ€¦":"Update PIN"})]})]})}function tn(){const[t,n]=a.useState([]),[s,i]=a.useState([]),[l,r]=a.useState(!0),[d,h]=a.useState(""),[u,p]=a.useState(!1),[o,x]=a.useState(null),[y,g]=a.useState(null),m=async()=>{r(!0);try{const v=await mt();n(v.staff),i(v.roles)}catch(v){h(v.message)}finally{r(!1)}};a.useEffect(()=>{m()},[]);const f=async v=>{await jt(v),p(!1),await m()},w=async v=>{o&&(await de(o.id,v),x(null),await m())},b=async v=>{y&&(await bt(y.id,v),g(null))},C=async v=>{if(confirm(`Remove ${v.name}? This cannot be undone.`))try{await vt(v.id),await m()}catch($){h($.message)}},F=async v=>{await de(v.id,{is_active:!v.is_active}),await m()};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Staff Management",subtitle:"Manage staff accounts and PINs",action:e.jsx(j,{onClick:()=>p(!0),children:"+ Add Staff"})}),d&&e.jsx(T,{message:d}),l&&t.length===0?e.jsx(D,{}):t.length===0?e.jsx(z,{children:e.jsx(L,{message:"No staff members found."})}):e.jsx(z,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Email","Role","PIN","Status","Last Login",""].map(v=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:v},v))})}),e.jsx("tbody",{children:t.map(v=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",opacity:v.is_active?1:.55},children:[e.jsx("td",{style:{padding:"13px 16px",fontWeight:700},children:v.name}),e.jsx("td",{style:{padding:"13px 16px",color:"#475569"},children:v.email}),e.jsx("td",{style:{padding:"13px 16px"},children:e.jsx(P,{label:v.role_name??v.role??"â€”",color:Gt(v.role)})}),e.jsx("td",{style:{padding:"13px 16px"},children:v.has_pin?e.jsx("span",{style:{color:"#22c55e",fontSize:13,fontWeight:600},children:"Set âœ“"}):e.jsx("span",{style:{color:"#f59e0b",fontSize:13,fontWeight:600},children:"Not set"})}),e.jsx("td",{style:{padding:"13px 16px"},children:e.jsx(P,{label:v.is_active?"Active":"Inactive",color:v.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"13px 16px",color:"#94a3b8",fontSize:12},children:Xt(v.last_login_at)}),e.jsx("td",{style:{padding:"13px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsx(j,{small:!0,variant:"secondary",onClick:()=>x(v),children:"Edit"}),e.jsx(j,{small:!0,variant:"ghost",onClick:()=>g(v),children:"PIN"}),e.jsx(j,{small:!0,variant:"ghost",onClick:()=>F(v),children:v.is_active?"Disable":"Enable"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>C(v),children:"Remove"})]})})]},v.id))})]})}),u&&e.jsx(Qt,{roles:s,onSave:f,onClose:()=>p(!1)}),o&&e.jsx(Zt,{member:o,roles:s,onSave:w,onClose:()=>x(null)}),y&&e.jsx(en,{member:y,onSave:b,onClose:()=>g(null)})]})}function nn({user:t,children:n}){return t?e.jsx(e.Fragment,{children:n}):e.jsx(ee,{to:"/login",replace:!0})}function sn(){const[t,n]=a.useState(null),[s,i]=a.useState(!0),l=he();a.useEffect(()=>{if(!localStorage.getItem("admin_token")){i(!1);return}He().then(u=>n(u.user)).catch(()=>{localStorage.removeItem("admin_token"),l("/login")}).finally(()=>i(!1))},[]);const r=(h,u)=>{n(u),l("/orders")},d=()=>{n(null)};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9"},children:e.jsx("div",{style:{color:"#64748b",fontSize:14},children:"Loadingâ€¦"})}):e.jsxs(ie,{children:[e.jsx(E,{path:"/login",element:e.jsx(Ct,{onLogin:r})}),e.jsx(E,{path:"/*",element:e.jsx(nn,{user:t,children:e.jsx(_t,{user:t,onLogout:d,children:e.jsxs(ie,{children:[e.jsx(E,{index:!0,element:e.jsx(ee,{to:"/orders",replace:!0})}),e.jsx(E,{path:"orders",element:e.jsx(Tt,{})}),e.jsx(E,{path:"kds",element:e.jsx(Rt,{})}),e.jsx(E,{path:"delivery",element:e.jsx(Dt,{})}),e.jsx(E,{path:"promotions",element:e.jsx(At,{})}),e.jsx(E,{path:"loyalty",element:e.jsx(Ft,{})}),e.jsx(E,{path:"sms",element:e.jsx(Ht,{})}),e.jsx(E,{path:"reports",element:e.jsx(qt,{})}),e.jsx(E,{path:"menu",element:e.jsx(Kt,{})}),e.jsx(E,{path:"staff",element:e.jsx(tn,{})}),e.jsx(E,{path:"*",element:e.jsx(ee,{to:"/orders",replace:!0})})]})})})})]})}te.createRoot(document.getElementById("root")).render(e.jsx(Le.StrictMode,{children:e.jsx(Be,{basename:"/admin",children:e.jsx(sn,{})})}));
