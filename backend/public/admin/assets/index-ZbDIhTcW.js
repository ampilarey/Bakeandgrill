import{r as l,a as ze,u as ge,N as Te,R as te,b as R,c as Q,d as Pe,B as Re}from"./vendor-ik71KGou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();var xe={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie=l,Be=Symbol.for("react.element"),Le=Symbol.for("react.fragment"),De=Object.prototype.hasOwnProperty,We=Ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ee={key:!0,ref:!0,__self:!0,__source:!0};function ue(t,n,s){var i,a={},r=null,o=null;s!==void 0&&(r=""+s),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(o=n.ref);for(i in n)De.call(n,i)&&!Ee.hasOwnProperty(i)&&(a[i]=n[i]);if(t&&t.defaultProps)for(i in n=t.defaultProps,n)a[i]===void 0&&(a[i]=n[i]);return{$$typeof:Be,type:t,key:r,ref:o,props:a,_owner:We.current}}J.Fragment=Le;J.jsx=ue;J.jsxs=ue;xe.exports=J;var e=xe.exports,Z={},ne=ze;Z.createRoot=ne.createRoot,Z.hydrateRoot=ne.hydrateRoot;const Oe="/api";async function S(t,n={}){var a;const s=localStorage.getItem("admin_token"),i=await fetch(`${Oe}${t}`,{headers:{"Content-Type":"application/json",Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{},...n.headers},...n});if(!i.ok){const r=await i.json().catch(()=>({}));throw new Error(r.message??((a=Object.values(r.errors??{})[0])==null?void 0:a[0])??`HTTP ${i.status}`)}return i.json()}async function Ae(t){return S("/auth/staff/pin-login",{method:"POST",body:JSON.stringify({pin:t})})}async function Fe(){return S("/auth/me")}async function Me(){await S("/auth/logout",{method:"POST"})}async function pe(t){const n=new URLSearchParams;return t!=null&&t.status&&n.set("status",t.status),t!=null&&t.type&&n.set("type",t.type),t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.date&&n.set("date",t.date),S(`/orders?${n}`)}async function Ne(t){return S(`/orders/${t}`)}async function $e(){return S("/kds/orders?status=pending,in_progress,paid")}async function Ve(t){await S(`/kds/orders/${t}/start`,{method:"POST"})}async function se(t){await S(`/kds/orders/${t}/bump`,{method:"POST"})}async function He(t){await S(`/kds/orders/${t}/recall`,{method:"POST"})}async function Ue(){return S("/admin/promotions")}async function qe(t){return S("/admin/promotions",{method:"POST",body:JSON.stringify(t)})}async function ie(t,n){return S(`/admin/promotions/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function Je(t){await S(`/admin/promotions/${t}`,{method:"DELETE"})}async function Ye(t){const n=new URLSearchParams;return t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.search&&n.set("search",t.search),S(`/admin/loyalty/accounts?${n}`)}async function Ke(t,n,s){await S(`/admin/loyalty/accounts/${t}/adjust`,{method:"POST",body:JSON.stringify({delta:n,reason:s})})}async function Ge(t){return S(`/admin/loyalty/accounts/${t}/ledger`)}async function Xe(t){const n=new URLSearchParams;return t!=null&&t.type&&n.set("type",t.type),t!=null&&t.status&&n.set("status",t.status),t!=null&&t.page&&n.set("page",String(t.page)),S(`/admin/sms/logs?${n}`)}async function Qe(){const n=(await S("/admin/sms/logs/stats")).stats??[],s=n.reduce((o,h)=>o+h.count,0),i=n.filter(o=>o.status==="sent").reduce((o,h)=>o+h.count,0),a=n.filter(o=>o.status==="failed").reduce((o,h)=>o+h.count,0),r={};for(const o of n)r[o.type]=(r[o.type]??0)+o.count;return{total:s,sent:i,failed:a,by_type:r}}async function Ze(){return S("/admin/sms/campaigns")}async function et(t){return S("/admin/sms/campaigns/preview",{method:"POST",body:JSON.stringify(t)})}async function tt(t){return S("/admin/sms/campaigns",{method:"POST",body:JSON.stringify(t)})}async function nt(t){await S(`/admin/sms/campaigns/${t}/send`,{method:"POST"})}async function st(t){await S(`/admin/sms/campaigns/${t}/cancel`,{method:"POST"})}async function it(t){var r,o;const n=new URLSearchParams;t!=null&&t.from&&n.set("from",t.from),t!=null&&t.to&&n.set("to",t.to);const s=await S(`/reports/sales-summary?${n}`),i=((r=s.totals)==null?void 0:r.orders_count)??0,a=((o=s.totals)==null?void 0:o.total)??0;return{total_revenue:a,order_count:i,average_order_value:i>0?a/i:0,period:`${s.from} â€“ ${s.to}`}}async function at(){return S("/categories?admin=1")}async function lt(t){return S("/categories",{method:"POST",body:JSON.stringify(t)})}async function ae(t,n){return S(`/categories/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function rt(t){await S(`/categories/${t}`,{method:"DELETE"})}async function ot(t){const n=new URLSearchParams({admin:"1"});return t!=null&&t.category_id&&n.set("category_id",String(t.category_id)),t!=null&&t.search&&n.set("search",t.search),t!=null&&t.page&&n.set("page",String(t.page)),S(`/items?${n}`)}async function dt(t){return S("/items",{method:"POST",body:JSON.stringify(t)})}async function ct(t,n){return S(`/items/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function gt(t){await S(`/items/${t}`,{method:"DELETE"})}async function xt(t){return S(`/items/${t}/toggle-availability`,{method:"PATCH"})}const ut=[{to:"/orders",icon:"ðŸ“‹",label:"Orders"},{to:"/kds",icon:"ðŸ‘¨â€ðŸ³",label:"Kitchen"},{to:"/delivery",icon:"ðŸ›µ",label:"Delivery"},{to:"/menu",icon:"ðŸ½ï¸",label:"Menu"},{to:"/promotions",icon:"ðŸ·ï¸",label:"Promos"},{to:"/loyalty",icon:"â­",label:"Loyalty"},{to:"/sms",icon:"ðŸ“±",label:"SMS"},{to:"/reports",icon:"ðŸ“Š",label:"Reports"}];function pt({user:t,children:n,onLogout:s}){const i=ge(),[a,r]=l.useState(!1),o=async()=>{try{await Me()}catch{}localStorage.removeItem("admin_token"),s(),i("/login")};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"#f1f5f9"},children:[e.jsxs("aside",{style:{width:a?64:220,background:"#0f172a",display:"flex",flexDirection:"column",transition:"width 0.2s",flexShrink:0,position:"sticky",top:0,height:"100vh",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:a?"20px 12px":"20px 20px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",gap:10,cursor:"pointer"},onClick:()=>r(!a),children:[e.jsx("span",{style:{fontSize:22,flexShrink:0},children:"ðŸž"}),!a&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:800,fontSize:14},children:"Bake & Grill"}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:"Admin"})]})]}),e.jsx("nav",{style:{flex:1,padding:"12px 0"},children:ut.map(({to:h,icon:u,label:y})=>e.jsxs(Te,{to:h,style:({isActive:d})=>({display:"flex",alignItems:"center",gap:12,padding:a?"12px 20px":"11px 20px",color:d?"#38bdf8":"#94a3b8",textDecoration:"none",fontWeight:d?700:400,fontSize:14,background:d?"rgba(56,189,248,0.08)":"transparent",borderLeft:d?"3px solid #38bdf8":"3px solid transparent",transition:"all 0.15s",whiteSpace:"nowrap"}),children:[e.jsx("span",{style:{fontSize:18,flexShrink:0},children:u}),!a&&e.jsx("span",{children:y})]},h))}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid #1e293b"},children:[!a&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:t.role??"Staff"})]}),e.jsx("button",{onClick:o,style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.2)",color:"#f87171",borderRadius:8,padding:a?"8px":"8px 14px",fontSize:12,fontWeight:600,width:"100%",cursor:"pointer"},children:a?"â†’":"Logout"})]})]}),e.jsx("main",{style:{flex:1,minWidth:0,padding:"24px",overflowY:"auto"},children:n})]})}function A({title:t,subtitle:n,action:s}){return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:t}),n&&e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:2},children:n})]}),s&&e.jsx("div",{children:s})]})}function C({children:t,style:n}){return e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",padding:"20px 24px",boxShadow:"0 1px 4px rgba(0,0,0,0.04)",...n},children:t})}function P({label:t,color:n}){const s={green:{bg:"#dcfce7",text:"#166534"},yellow:{bg:"#fef9c3",text:"#854d0e"},blue:{bg:"#dbeafe",text:"#1e40af"},red:{bg:"#fee2e2",text:"#991b1b"},gray:{bg:"#f1f5f9",text:"#475569"},teal:{bg:"#ccfbf1",text:"#115e59"},orange:{bg:"#ffedd5",text:"#9a3412"}},i=s[n]??s.gray;return e.jsx("span",{style:{background:i.bg,color:i.text,padding:"2px 10px",borderRadius:999,fontSize:12,fontWeight:600,display:"inline-block"},children:t})}function j({children:t,onClick:n,variant:s="primary",disabled:i,small:a,style:r}){const o={primary:{background:"#0ea5e9",color:"#fff",border:"none"},secondary:{background:"#f1f5f9",color:"#0f172a",border:"1px solid #e2e8f0"},danger:{background:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca"},ghost:{background:"transparent",color:"#64748b",border:"1px solid #e2e8f0"}};return e.jsx("button",{onClick:n,disabled:i,style:{...o[s],padding:a?"5px 12px":"9px 18px",borderRadius:9,fontSize:a?12:14,fontWeight:600,cursor:i?"not-allowed":"pointer",opacity:i?.6:1,transition:"opacity 0.15s",...r},children:t})}function w({value:t,onChange:n,placeholder:s,type:i="text",style:a}){return e.jsx("input",{type:i,value:t,onChange:r=>n(r.target.value),placeholder:s,style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",outline:"none",width:"100%",background:"#fff",...a}})}function U({value:t,onChange:n,options:s,style:i}){return e.jsx("select",{value:t,onChange:a=>n(a.target.value),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",background:"#fff",cursor:"pointer",...i},children:s.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}function B(){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:"Loadingâ€¦"})}function L({message:t}){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8",fontSize:14},children:t})}function I({message:t}){return e.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#991b1b",borderRadius:10,padding:"12px 16px",fontSize:13,marginBottom:16},children:t})}function $(t){return{pending:"yellow",preparing:"blue",in_progress:"blue",ready:"teal",paid:"green",completed:"gray",cancelled:"red",out_for_delivery:"teal",draft:"gray",sent:"green",failed:"red",active:"green",expired:"gray"}[t]??"gray"}function ht({onLogin:t}){const[n,s]=l.useState(""),[i,a]=l.useState(""),[r,o]=l.useState(!1),h=async()=>{if(!(n.length<4)){a(""),o(!0);try{const d=await Ae(n);localStorage.setItem("admin_token",d.token),t(d.token,d.user)}catch(d){a(d.message),s("")}finally{o(!1)}}},u=d=>{n.length<8&&s(x=>x+d)},y=()=>s("");return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,padding:"40px 36px",width:"100%",maxWidth:380,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:"ðŸž"}),e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:"Bake & Grill"}),e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:4},children:"Staff Admin â€” Enter your PIN"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:10,marginBottom:24,minHeight:54,alignItems:"center"},children:n.length===0?e.jsx("span",{style:{color:"#94a3b8",fontSize:14},children:"Enter your PIN below"}):Array.from({length:n.length}).map((d,x)=>e.jsx("div",{style:{width:16,height:16,borderRadius:"50%",background:"#0ea5e9",transition:"all 0.1s"}},x))}),i&&e.jsx("div",{style:{background:"#fee2e2",color:"#991b1b",borderRadius:10,padding:"10px 14px",fontSize:13,marginBottom:16,textAlign:"center"},children:i}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:10},children:["1","2","3","4","5","6","7","8","9","","0","âŒ«"].map(d=>e.jsx("button",{onClick:()=>{d==="âŒ«"?s(x=>x.slice(0,-1)):d!==""&&u(d)},disabled:d==="",style:{height:56,borderRadius:12,border:"1px solid #e2e8f0",background:d==="âŒ«"?"#fee2e2":d===""?"transparent":"#f8fafc",fontSize:18,fontWeight:700,color:d==="âŒ«"?"#991b1b":"#0f172a",cursor:d===""?"default":"pointer",transition:"background 0.1s"},children:d},d))}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[e.jsx("button",{onClick:y,style:{flex:1,height:48,borderRadius:12,border:"1px solid #e2e8f0",background:"#f1f5f9",fontSize:14,fontWeight:600,color:"#64748b",cursor:"pointer"},children:"Clear"}),e.jsx("button",{onClick:h,disabled:n.length<4||r,style:{flex:2,height:48,borderRadius:12,border:"none",background:r||n.length<4?"#bae6fd":"#0ea5e9",fontSize:14,fontWeight:700,color:"#fff",cursor:"pointer",transition:"background 0.15s"},children:r?"Signing inâ€¦":"Sign In â†’"})]})]})})}const ft=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"preparing",label:"Preparing"},{value:"ready",label:"Ready"},{value:"paid",label:"Paid"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],yt=[{value:"",label:"All Types"},{value:"dine_in",label:"Dine In"},{value:"takeaway",label:"Takeaway"},{value:"online_pickup",label:"Online Pickup"},{value:"delivery",label:"Delivery"}];function ee(t){return{dine_in:"Dine In",takeaway:"Takeaway",online_pickup:"Online",delivery:"Delivery",preorder:"Pre-order"}[t]??t}function mt(t){const n=Date.now()-new Date(t).getTime(),s=Math.floor(n/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const i=Math.floor(s/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function jt({orderId:t,onClose:n}){var o,h,u,y;const[s,i]=l.useState(null),[a,r]=l.useState(!0);return l.useEffect(()=>{Ne(t).then(d=>{i(d.order),r(!1)}).catch(()=>r(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"stretch",justifyContent:"flex-end"},onClick:n,children:e.jsxs("div",{style:{width:420,background:"#fff",height:"100%",overflowY:"auto",padding:24,boxShadow:"-4px 0 20px rgba(0,0,0,0.1)"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:18,color:"#0f172a"},children:s?`#${s.order_number}`:"Order Details"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#64748b"},children:"âœ•"})]}),a&&e.jsx(B,{}),!a&&!s&&e.jsx(L,{message:"Order not found."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:20},children:[e.jsx(P,{label:s.status,color:$(s.status)}),e.jsx(P,{label:ee(s.type),color:"blue"})]}),e.jsxs("div",{style:{background:"#f8fafc",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx(N,{label:"Order #",value:s.order_number}),e.jsx(N,{label:"Type",value:ee(s.type)}),e.jsx(N,{label:"Time",value:new Date(s.created_at).toLocaleString()}),s.table_number&&e.jsx(N,{label:"Table",value:s.table_number}),(((o=s.customer)==null?void 0:o.name)??s.customer_name)&&e.jsx(N,{label:"Customer",value:((h=s.customer)==null?void 0:h.name)??s.customer_name}),(((u=s.customer)==null?void 0:u.phone)??s.customer_phone)&&e.jsx(N,{label:"Phone",value:((y=s.customer)==null?void 0:y.phone)??s.customer_phone}),s.paid_at&&e.jsx(N,{label:"Paid at",value:new Date(s.paid_at).toLocaleString()})]}),s.type==="delivery"&&s.delivery_address_line1&&e.jsxs("div",{style:{background:"#eff6ff",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#1e40af",marginBottom:8},children:"Delivery Address"}),e.jsx("p",{style:{fontSize:14},children:s.delivery_address_line1}),s.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:s.delivery_island}),s.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:4},children:[s.delivery_contact_name," Â· ",s.delivery_contact_phone]})]}),s.items&&s.items.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#475569",marginBottom:8},children:"Items"}),s.items.map(d=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,paddingBottom:6,marginBottom:6,borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:[d.quantity,"Ã— ",d.item_name]}),e.jsxs("span",{style:{color:"#0ea5e9",fontWeight:600},children:["MVR ",(d.total_price??0).toFixed(2)]})]},d.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:16,paddingTop:8},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["MVR ",s.total.toFixed(2)]})]})]}),s.notes&&e.jsxs("div",{style:{background:"#fefce8",borderRadius:10,padding:"12px 14px",fontSize:13,color:"#713f12"},children:["ðŸ“ ",s.notes]})]})]})})}function N({label:t,value:n}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:4},children:[e.jsx("span",{style:{color:"#64748b"},children:t}),e.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:n})]})}function bt(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(""),[u,y]=l.useState(""),[d,x]=l.useState(null),[f,g]=l.useState(1),[m,p]=l.useState(1),k=async()=>{var v;i(!0),r("");try{const _=await pe({status:o||void 0,type:u||void 0,page:f});n(_.data),p(((v=_.meta)==null?void 0:v.last_page)??1)}catch(_){r(_.message)}finally{i(!1)}};return l.useEffect(()=>{k()},[o,u,f]),l.useEffect(()=>{const v=setInterval(()=>void k(),3e4);return()=>clearInterval(v)},[o,u,f]),e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Orders",subtitle:"All customer and POS orders",action:e.jsx(j,{onClick:k,variant:"secondary",children:"â†» Refresh"})}),a&&e.jsx(I,{message:a}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(U,{value:o,onChange:v=>{h(v),g(1)},options:ft,style:{width:160}}),e.jsx(U,{value:u,onChange:v=>{y(v),g(1)},options:yt,style:{width:160}})]}),s&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No orders found."})}):e.jsxs(C,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Order #","Type","Status","Customer","Total","Time",""].map(v=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:v},v))})}),e.jsx("tbody",{children:t.map(v=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",transition:"background 0.1s"},onMouseEnter:_=>{_.currentTarget.style.background="#f8fafc"},onMouseLeave:_=>{_.currentTarget.style.background=""},children:[e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0f172a"},children:["#",v.order_number,v.type==="delivery"&&e.jsx("span",{style:{marginLeft:6,fontSize:12},children:"ðŸ›µ"})]}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:ee(v.type),color:"blue"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:v.status,color:$(v.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:v.customer_name??v.table_number??"â€”"}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:600,color:"#0ea5e9"},children:["MVR ",v.total.toFixed(2)]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:mt(v.created_at)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(j,{small:!0,onClick:()=>x(v.id),variant:"ghost",children:"View"})})]},v.id))})]}),m>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,padding:"16px"},children:[e.jsx(j,{small:!0,variant:"secondary",disabled:f<=1,onClick:()=>g(v=>v-1),children:"â† Prev"}),e.jsxs("span",{style:{lineHeight:"30px",fontSize:13,color:"#64748b"},children:["Page ",f," of ",m]}),e.jsx(j,{small:!0,variant:"secondary",disabled:f>=m,onClick:()=>g(v=>v+1),children:"Next â†’"})]})]}),d&&e.jsx(jt,{orderId:d,onClose:()=>x(null)})]})}function vt(t){const n=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(n<60)return`${n}s`;const s=Math.floor(n/60);return s<60?`${s}m ${n%60}s`:`${Math.floor(s/60)}h ${s%60}m`}function he(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n>=15?"#ef4444":n>=8?"#f97316":"#22c55e"}function St(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(null),u=async()=>{try{const m=await $e();n(m.orders),r("")}catch(m){r(m.message)}finally{i(!1)}};l.useEffect(()=>{u();const m=setInterval(()=>void u(),1e4);return()=>clearInterval(m)},[]);const y=async(m,p)=>{h(m);try{await p(m),await u()}catch(k){r(k.message)}finally{h(null)}},d=t.filter(m=>["pending","paid"].includes(m.status)),x=t.filter(m=>m.status==="in_progress"),f=[],g=({title:m,items:p,color:k,children:v})=>e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:k}}),e.jsx("span",{style:{fontWeight:700,fontSize:14,color:"#0f172a"},children:m}),e.jsx("span",{style:{background:"#f1f5f9",color:"#64748b",borderRadius:999,padding:"1px 8px",fontSize:12,fontWeight:600},children:p.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:p.length===0?e.jsx("div",{style:{color:"#94a3b8",fontSize:13,padding:"20px 0"},children:"Nothing here"}):p.map(_=>e.jsx("div",{style:{background:"#fff",borderRadius:14,padding:"16px",border:`2px solid ${he(_.created_at)}22`,boxShadow:"0 2px 6px rgba(0,0,0,0.04)"},children:v(_)},_.id))})]});return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Kitchen Display",subtitle:"Live ticket board â€” auto-refreshes every 10s",action:e.jsx(j,{onClick:u,variant:"secondary",children:"â†» Refresh"})}),a&&e.jsx(I,{message:a}),s&&t.length===0?e.jsx(C,{children:e.jsx(L,{message:"Loading kitchen ticketsâ€¦"})}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:20},children:[e.jsx(g,{title:"Pending",items:d,color:"#f59e0b",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(K,{ticket:m}),e.jsx(j,{small:!0,onClick:()=>y(m.id,Ve),disabled:o===m.id,style:{marginTop:12,width:"100%",background:"#f59e0b",color:"#fff",border:"none"},children:o===m.id?"â€¦":"Start Cooking"})]})}),e.jsx(g,{title:"Cooking",items:x,color:"#3b82f6",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(K,{ticket:m}),e.jsx(j,{small:!0,onClick:()=>y(m.id,se),disabled:o===m.id,style:{marginTop:12,width:"100%",background:"#3b82f6",color:"#fff",border:"none"},children:o===m.id?"â€¦":"Mark Ready âœ“"})]})}),e.jsx(g,{title:"Ready",items:f,color:"#22c55e",children:m=>e.jsxs(e.Fragment,{children:[e.jsx(K,{ticket:m}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx(j,{small:!0,onClick:()=>y(m.id,se),disabled:o===m.id,style:{flex:1,background:"#22c55e",color:"#fff",border:"none"},children:"Complete"}),e.jsx(j,{small:!0,onClick:()=>y(m.id,He),disabled:o===m.id,variant:"ghost",children:"Recall"})]})]})})]})]})}function K({ticket:t}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:"#0f172a"},children:["#",t.order_number]}),t.table_number&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#64748b"},children:["Table ",t.table_number]}),t.delivery_island&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#0ea5e9"},children:["ðŸ›µ ",t.delivery_island]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{color:he(t.created_at),fontSize:13,fontWeight:700},children:vt(t.created_at)}),e.jsx(P,{label:t.type,color:$(t.status)})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.items.map((n,s)=>e.jsxs("div",{style:{fontSize:13,color:"#374151"},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0f172a"},children:[n.quantity,"Ã—"]})," ",n.item_name,n.modifiers&&n.modifiers.length>0&&e.jsxs("span",{style:{color:"#6b7280",fontSize:11,display:"block",marginLeft:16},children:["+ ",n.modifiers.map(i=>i.modifier_name).join(", ")]})]},s))})]})}function _t(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n<1?"just now":n<60?`${n}m ago`:`${Math.floor(n/60)}h ago`}function Ct(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(null),u=async()=>{try{const x=await pe({type:"delivery"});n(x.data),r("")}catch(x){r(x.message)}finally{i(!1)}};l.useEffect(()=>{u();const x=setInterval(()=>void u(),3e4);return()=>clearInterval(x)},[]);const y=t.filter(x=>!["completed","cancelled"].includes(x.status)),d=t.filter(x=>["completed","cancelled"].includes(x.status));return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Delivery Orders",subtitle:"All delivery orders â€” auto-refreshes every 30s",action:e.jsx(j,{onClick:u,variant:"secondary",children:"â†» Refresh"})}),a&&e.jsx(I,{message:a}),s&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No delivery orders yet."})}):e.jsxs(e.Fragment,{children:[y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#475569",marginBottom:12},children:["ACTIVE (",y.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16,marginBottom:28},children:y.map(x=>e.jsx(le,{order:x,onSelect:h},x.id))})]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#94a3b8",marginBottom:12},children:["COMPLETED (",d.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:d.slice(0,10).map(x=>e.jsx(le,{order:x,onSelect:h},x.id))})]})]}),o&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>h(null),children:e.jsx(C,{style:{width:"100%",maxWidth:480},children:e.jsxs("div",{onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:18},children:["#",o.order_number]}),e.jsx("button",{onClick:()=>h(null),style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),e.jsx(P,{label:o.status,color:$(o.status)}),e.jsxs("div",{style:{background:"#f0f9ff",borderRadius:10,padding:16,marginTop:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#0369a1",marginBottom:8},children:"Delivery Details"}),e.jsx("p",{style:{fontSize:14,color:"#0f172a"},children:o.delivery_address_line1??"N/A"}),o.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:o.delivery_island}),o.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:6},children:["ðŸ‘¤ ",o.delivery_contact_name," Â· ",o.delivery_contact_phone]})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:18},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:"#0ea5e9"},children:["MVR ",o.total.toFixed(2)]})]})]})})})]})}function le({order:t,onSelect:n}){const s=t.status==="pending"&&Date.now()-new Date(t.created_at).getTime()>6e5;return e.jsxs(C,{style:{border:s?"2px solid #ef4444":void 0,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("span",{style:{fontWeight:800,fontSize:15,color:"#0f172a"},children:["#",t.order_number]}),e.jsx(P,{label:t.status,color:$(t.status)})]}),e.jsx("p",{style:{fontSize:14,color:"#374151",marginBottom:4},children:t.delivery_address_line1??"â€”"}),t.delivery_island&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ“ ",t.delivery_island]}),t.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ‘¤ ",t.delivery_contact_name]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[e.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:_t(t.created_at)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0ea5e9"},children:["MVR ",t.total.toFixed(2)]}),e.jsx(j,{small:!0,variant:"ghost",onClick:()=>n(t),children:"Details"})]})]})]})}const wt={name:"",code:"",type:"fixed",discount_value:0,scope:"order",min_order_laar:null,max_uses:null,stackable:!1,is_active:!0,starts_at:null,expires_at:null};function kt({initial:t,onSave:n,onCancel:s}){const[i,a]=l.useState(t),[r,o]=l.useState(!1),[h,u]=l.useState(""),y=(p,k)=>a(v=>({...v,[p]:k})),d=i.type==="fixed"?String((i.discount_value/100).toFixed(2)):String(i.discount_value),x=p=>{const k=parseFloat(p)||0;y("discount_value",i.type==="fixed"?Math.round(k*100):k)},f=i.min_order_laar!=null?String((i.min_order_laar/100).toFixed(2)):"",g=p=>{y("min_order_laar",p?Math.round(parseFloat(p)*100):null)},m=async()=>{if(!i.name||!i.code){u("Name and code are required.");return}u(""),o(!0);try{await n(i)}catch(p){u(p.message)}finally{o(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[h&&e.jsx(I,{message:h}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(O,{label:"Promo Name",children:e.jsx(w,{value:i.name,onChange:p=>y("name",p),placeholder:"e.g. Ramadan Special"})}),e.jsx(O,{label:"Code",children:e.jsx(w,{value:i.code,onChange:p=>y("code",p.toUpperCase()),placeholder:"e.g. RAMADAN20"})}),e.jsx(O,{label:"Discount Type",children:e.jsx(U,{value:i.type,onChange:p=>y("type",p),options:[{value:"fixed",label:"Fixed Amount (MVR)"},{value:"percentage",label:"Percentage (%)"}]})}),e.jsx(O,{label:`Discount Value (${i.type==="percentage"?"%":"MVR"})`,children:e.jsx(w,{value:d,onChange:x,type:"number"})}),e.jsx(O,{label:"Min Order Amount (MVR)",children:e.jsx(w,{value:f,onChange:g,type:"number",placeholder:"No minimum"})}),e.jsx(O,{label:"Max Uses",children:e.jsx(w,{value:i.max_uses!=null?String(i.max_uses):"",onChange:p=>y("max_uses",p?parseInt(p):null),type:"number",placeholder:"Unlimited"})}),e.jsx(O,{label:"Starts At",children:e.jsx(w,{value:i.starts_at??"",onChange:p=>y("starts_at",p||null),type:"datetime-local"})}),e.jsx(O,{label:"Expires At",children:e.jsx(w,{value:i.expires_at??"",onChange:p=>y("expires_at",p||null),type:"datetime-local"})})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.is_active,onChange:p=>y("is_active",p.target.checked)}),"Active"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.stackable,onChange:p=>y("stackable",p.target.checked)}),"Stackable"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(j,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(j,{onClick:m,disabled:r,children:r?"Savingâ€¦":"Save Promo"})]})]})}function O({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function zt(t){return t.type==="percentage"?`${t.discount_value}%`:t.type==="fixed"?`MVR ${(t.discount_value/100).toFixed(2)}`:t.type}function Tt(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(!1),[u,y]=l.useState(null),d=async()=>{i(!0);try{const p=await Ue();n(p.data)}catch(p){r(p.message)}finally{i(!1)}};l.useEffect(()=>{d()},[]);const x=async p=>{await qe(p),h(!1),await d()},f=async p=>{u&&(await ie(u.id,p),y(null),await d())},g=async p=>{confirm("Delete this promotion?")&&(await Je(p),await d())},m=async p=>{await ie(p.id,{is_active:!p.is_active}),await d()};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Promotions",subtitle:"Manage promo codes and discounts",action:!o&&!u?e.jsx(j,{onClick:()=>h(!0),children:"+ New Promo"}):void 0}),a&&e.jsx(I,{message:a}),(o||u)&&e.jsxs(C,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:18,color:"#0f172a"},children:o?"Create New Promotion":`Edit: ${u==null?void 0:u.name}`}),e.jsx(kt,{initial:u?{name:u.name,code:u.code,type:u.type==="percentage"?"percentage":"fixed",discount_value:u.discount_value,scope:u.scope,min_order_laar:u.min_order_laar,max_uses:u.max_uses,stackable:u.stackable,is_active:u.is_active,starts_at:u.starts_at,expires_at:u.expires_at}:wt,onSave:o?x:f,onCancel:()=>{h(!1),y(null)}})]}),s&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No promotions yet. Create your first promo code."})}):e.jsx(C,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Code","Discount","Uses","Valid","Status",""].map(p=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:p},p))})}),e.jsx("tbody",{children:t.map(p=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:p.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 8px",borderRadius:6,fontSize:13,fontWeight:700,letterSpacing:1},children:p.code})}),e.jsx("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:zt(p)}),e.jsxs("td",{style:{padding:"12px 16px",color:"#475569"},children:[p.redemptions_count,p.max_uses?` / ${p.max_uses}`:""]}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569",fontSize:12},children:p.expires_at?new Date(p.expires_at).toLocaleDateString():"âˆž"}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:p.is_active?"Active":"Inactive",color:p.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>m(p),children:p.is_active?"Disable":"Enable"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>{y(p),h(!1)},children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>g(p.id),children:"Delete"})]})})]},p.id))})]})})]})}const Pt={bronze:"orange",silver:"gray",gold:"yellow",platinum:"blue"};function Rt({customerId:t,name:n,onClose:s}){const[i,a]=l.useState([]),[r,o]=l.useState(!0);return l.useEffect(()=>{Ge(t).then(h=>a(h.data)).finally(()=>o(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s,children:e.jsx(C,{style:{width:"100%",maxWidth:520,maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsxs("div",{onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:17},children:["Ledger â€” ",n]}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),r?e.jsx(B,{}):i.length===0?e.jsx(L,{message:"No transactions yet."}):e.jsx("div",{style:{overflowY:"auto",flex:1},children:i.map(h=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,color:"#374151"},children:h.reason}),e.jsx("p",{style:{fontSize:11,color:"#94a3b8"},children:new Date(h.created_at).toLocaleString()})]}),e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:h.delta>=0?"#22c55e":"#ef4444"},children:[h.delta>=0?"+":"",h.delta," pts"]})]},h.id))})]})})})}function It({account:t,onClose:n,onDone:s}){const[i,a]=l.useState(""),[r,o]=l.useState(""),[h,u]=l.useState(!1),[y,d]=l.useState(""),x=async()=>{const f=parseInt(i);if(!f||!r){d("Delta and reason are required.");return}d(""),u(!0);try{await Ke(t.customer_id,f,r),s(),n()}catch(g){d(g.message)}finally{u(!1)}};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:n,children:e.jsx(C,{style:{width:"100%",maxWidth:400},children:e.jsxs("div",{onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:17},children:"Adjust Points"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer"},children:"âœ•"})]}),e.jsxs("p",{style:{color:"#475569",fontSize:14,marginBottom:16},children:[t.customer_name??t.customer_phone," â€” current balance: ",e.jsxs("strong",{children:[t.points_balance," pts"]})]}),y&&e.jsx(I,{message:y}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Points (use âˆ’ to deduct)"}),e.jsx(w,{value:i,onChange:a,placeholder:"e.g. 100 or -50",type:"number"})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Reason"}),e.jsx(w,{value:r,onChange:o,placeholder:"e.g. Goodwill adjustment"})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(j,{variant:"ghost",onClick:n,children:"Cancel"}),e.jsx(j,{onClick:x,disabled:h,children:h?"Savingâ€¦":"Apply Adjustment"})]})]})})})}function Bt(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(""),[u,y]=l.useState(null),[d,x]=l.useState(null),f=async()=>{i(!0);try{const g=await Ye({search:o||void 0});n(g.data)}catch(g){r(g.message)}finally{i(!1)}};return l.useEffect(()=>{f()},[o]),e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Loyalty Accounts",subtitle:"View and manage customer loyalty points"}),a&&e.jsx(I,{message:a}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(w,{value:o,onChange:h,placeholder:"Search by name or phoneâ€¦",style:{maxWidth:320}})}),s&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No loyalty accounts found."})}):e.jsx(C,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Customer","Phone","Tier","Balance","Held","Lifetime",""].map(g=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:g},g))})}),e.jsx("tbody",{children:t.map(g=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:g.customer_name??"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.customer_phone}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:g.tier,color:Pt[g.tier]??"gray"})}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0ea5e9"},children:[g.points_balance.toLocaleString()," pts"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8"},children:g.points_held>0?`${g.points_held} held`:"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:g.lifetime_points.toLocaleString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>x(g),children:"Ledger"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>y(g),children:"Adjust"})]})})]},g.id))})]})}),u&&e.jsx(It,{account:u,onClose:()=>y(null),onDone:f}),d&&e.jsx(Rt,{customerId:d.customer_id,name:d.customer_name??d.customer_phone,onClose:()=>x(null)})]})}function Lt(){const[t,n]=l.useState([]),[s,i]=l.useState(null),[a,r]=l.useState(!0),[o,h]=l.useState(""),[u,y]=l.useState(""),d=async()=>{r(!0);try{const[x,f]=await Promise.all([Xe({type:o||void 0,status:u||void 0}),Qe()]);n(x.data),i(f)}finally{r(!1)}};return l.useEffect(()=>{d()},[o,u]),e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:14,marginBottom:20},children:[e.jsx(G,{label:"Total SMS",value:s.total,color:"#0ea5e9"}),e.jsx(G,{label:"Sent",value:s.sent,color:"#22c55e"}),e.jsx(G,{label:"Failed",value:s.failed,color:"#ef4444"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsx(U,{value:o,onChange:h,options:[{value:"",label:"All Types"},{value:"otp",label:"OTP"},{value:"promotion",label:"Promotion"},{value:"campaign",label:"Campaign"},{value:"transactional",label:"Transactional"}],style:{width:160}}),e.jsx(U,{value:u,onChange:y,options:[{value:"",label:"All Statuses"},{value:"sent",label:"Sent"},{value:"failed",label:"Failed"},{value:"demo",label:"Demo"}],style:{width:140}}),e.jsx(j,{variant:"secondary",onClick:d,children:"â†» Refresh"})]}),a&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No SMS logs found."})}):e.jsx(C,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["To","Type","Status","Message","Segments","Cost","Sent At"].map(x=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:11},children:x},x))})}),e.jsx("tbody",{children:t.map(x=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:x.to}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:x.type,color:"blue"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:x.status,color:$(x.status)})}),e.jsxs("td",{style:{padding:"10px 14px",color:"#475569",maxWidth:200},children:[e.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:x.message}),x.error_message&&e.jsx("span",{style:{color:"#ef4444",fontSize:11},children:x.error_message})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#64748b",textAlign:"center"},children:x.segments}),e.jsxs("td",{style:{padding:"10px 14px",color:"#0ea5e9",fontWeight:600},children:["MVR ",x.cost_estimate_mvr]}),e.jsx("td",{style:{padding:"10px 14px",color:"#94a3b8",fontSize:11},children:x.sent_at?new Date(x.sent_at).toLocaleString():"â€”"})]},x.id))})]})})]})}function Dt(){const[t,n]=l.useState([]),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(!1),[u,y]=l.useState(""),[d,x]=l.useState(""),[f,g]=l.useState(null),[m,p]=l.useState(!1),[k,v]=l.useState(!1),_=async()=>{i(!0);try{const b=await Ze();n(b.data)}catch(b){r(b.message)}finally{i(!1)}};l.useEffect(()=>{_()},[]);const V=async()=>{if(d){p(!0);try{const b=await et({message:d,criteria:{}});g(b)}catch(b){r(b.message)}finally{p(!1)}}},Y=async()=>{if(!(!u||!d)){v(!0);try{await tt({name:u,message:d,criteria:{}}),h(!1),y(""),x(""),g(null),await _()}catch(b){r(b.message)}finally{v(!1)}}},H=async b=>{if(confirm("Send this campaign to all recipients?"))try{await nt(b),await _()}catch(D){r(D.message)}},F=async b=>{if(confirm("Cancel this campaign?"))try{await st(b),await _()}catch(D){r(D.message)}},W=d.length,q=W<=160?1:Math.ceil(W/153);return e.jsxs(e.Fragment,{children:[a&&e.jsx(I,{message:a}),!o&&e.jsx(j,{onClick:()=>h(!0),style:{marginBottom:20},children:"+ New Campaign"}),o&&e.jsxs(C,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:16},children:"New SMS Campaign"}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Campaign Name"}),e.jsx(w,{value:u,onChange:y,placeholder:"e.g. Eid Special Offer"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569"},children:"Message"}),e.jsxs("span",{style:{fontSize:11,color:W>160?"#ef4444":"#94a3b8"},children:[W," chars Â· ",q," segment",q>1?"s":""]})]}),e.jsx("textarea",{value:d,onChange:b=>x(b.target.value),placeholder:"Type your SMS message hereâ€¦",rows:4,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"10px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical"}})]}),f&&e.jsx("div",{style:{background:"#f0f9ff",borderRadius:10,padding:"12px 16px",marginBottom:14},children:e.jsxs("p",{style:{fontSize:14,fontWeight:600,color:"#0369a1"},children:["Preview: ",f.recipient_count," recipients Â· Est. MVR ",f.estimated_cost_mvr]})}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx(j,{variant:"secondary",onClick:V,disabled:m||!d,children:m?"Checkingâ€¦":"ðŸ‘ Preview Audience"}),e.jsx(j,{onClick:Y,disabled:k||!u||!d,children:k?"Creatingâ€¦":"Create Draft"}),e.jsx(j,{variant:"ghost",onClick:()=>{h(!1),g(null)},children:"Cancel"})]})]}),s&&t.length===0?e.jsx(B,{}):t.length===0?e.jsx(C,{children:e.jsx(L,{message:"No campaigns yet."})}):e.jsx(C,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Status","Recipients","Sent","Cost","Created",""].map(b=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:b},b))})}),e.jsx("tbody",{children:t.map(b=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:b.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(P,{label:b.status,color:$(b.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:b.total_recipients}),e.jsxs("td",{style:{padding:"12px 16px"},children:[e.jsx("span",{style:{color:"#22c55e"},children:b.sent_count}),b.failed_count>0&&e.jsxs("span",{style:{color:"#ef4444",marginLeft:4},children:["/ ",b.failed_count," failed"]})]}),e.jsxs("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:["MVR ",b.total_cost_mvr??"â€”"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:new Date(b.created_at).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[b.status==="draft"&&e.jsx(j,{small:!0,onClick:()=>H(b.id),style:{background:"#22c55e",color:"#fff",border:"none"},children:"Send"}),["draft","sending"].includes(b.status)&&e.jsx(j,{small:!0,variant:"danger",onClick:()=>F(b.id),children:"Cancel"})]})})]},b.id))})]})})]})}function G({label:t,value:n,color:s}){return e.jsxs(C,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:s},children:n.toLocaleString()}),e.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:4},children:t})]})}function Wt(){const[t,n]=l.useState("logs");return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"SMS",subtitle:"Logs and bulk campaigns"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20,borderBottom:"2px solid #e2e8f0"},children:[["logs","Audit Logs"],["campaigns","Campaigns"]].map(([s,i])=>e.jsx("button",{onClick:()=>n(s),style:{padding:"10px 20px",fontSize:14,fontWeight:t===s?700:400,color:t===s?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",borderBottom:t===s?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:i},s))}),t==="logs"?e.jsx(Lt,{}):e.jsx(Dt,{})]})}function re(){return new Date().toISOString().slice(0,10)}function Et(){const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().slice(0,10)}function X({label:t,value:n,sub:s,color:i="#0ea5e9"}){return e.jsxs(C,{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:6},children:t}),e.jsx("div",{style:{fontSize:28,fontWeight:800,color:i},children:n}),s&&e.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginTop:4},children:s})]})}function Ot(){const[t,n]=l.useState(null),[s,i]=l.useState(!0),[a,r]=l.useState(""),[o,h]=l.useState(Et()),[u,y]=l.useState(re()),d=async()=>{i(!0),r("");try{const f=await it({from:o,to:u});n(f)}catch(f){r(f.message)}finally{i(!1)}};l.useEffect(()=>{d()},[]);const x=f=>{const g=new Date;g.setDate(g.getDate()-f),h(g.toISOString().slice(0,10)),y(re())};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Reports",subtitle:"Sales overview"}),a&&e.jsx(I,{message:a}),e.jsx(C,{style:{marginBottom:20},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"From"}),e.jsx("input",{type:"date",value:o,onChange:f=>h(f.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"To"}),e.jsx("input",{type:"date",value:u,onChange:f=>y(f.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[[[0,"Today"],[7,"7 days"],[30,"30 days"],[90,"90 days"]].map(([f,g])=>e.jsx(j,{small:!0,variant:"secondary",onClick:()=>x(f),children:g},g)),e.jsx(j,{small:!0,onClick:d,children:"Apply"})]})]})}),s?e.jsx(B,{}):t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[e.jsx(X,{label:"Total Revenue",value:`MVR ${t.total_revenue.toLocaleString(void 0,{minimumFractionDigits:2})}`,color:"#22c55e"}),e.jsx(X,{label:"Orders",value:t.order_count.toLocaleString(),color:"#0ea5e9"}),e.jsx(X,{label:"Avg Order Value",value:`MVR ${t.average_order_value.toFixed(2)}`,color:"#8b5cf6"})]}),e.jsxs(C,{children:[e.jsxs("p",{style:{color:"#64748b",fontSize:14,textAlign:"center",padding:"20px 0"},children:["Period: ",e.jsx("strong",{children:t.period})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Detailed breakdown reports (by item, category, staff) coming soon."})]})]})]})}function z({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function fe({value:t,onChange:n,placeholder:s,rows:i=3}){return e.jsx("textarea",{value:t,onChange:a=>n(a.target.value),placeholder:s,rows:i,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"}})}const At={name:"",name_dv:"",description:"",image_url:"",sort_order:"",is_active:!0};function oe({initial:t,title:n,onSave:s,onClose:i}){const[a,r]=l.useState(t),[o,h]=l.useState(!1),[u,y]=l.useState(""),d=(f,g)=>r(m=>({...m,[f]:g})),x=async()=>{if(!a.name.trim()){y("Category name is required.");return}y(""),h(!0);try{await s(a)}catch(f){y(f.message)}finally{h(!1)}};return e.jsxs(ye,{onClose:i,children:[e.jsx("h3",{style:{fontWeight:800,fontSize:17,marginBottom:20,color:"#0f172a"},children:n}),u&&e.jsx(I,{message:u}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(z,{label:"Name (English)",children:e.jsx(w,{value:a.name,onChange:f=>d("name",f),placeholder:"e.g. Grills"})}),e.jsx(z,{label:"Name (Dhivehi) â€” optional",children:e.jsx(w,{value:a.name_dv,onChange:f=>d("name_dv",f),placeholder:"Þ‹Þ¨ÞˆÞ¬Þ€Þ¨"})})]}),e.jsx(z,{label:"Description",children:e.jsx(fe,{value:a.description,onChange:f=>d("description",f),placeholder:"Short descriptionâ€¦",rows:2})}),e.jsx(z,{label:"Image URL",children:e.jsx(w,{value:a.image_url,onChange:f=>d("image_url",f),placeholder:"https://â€¦"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(z,{label:"Sort Order",children:e.jsx(w,{value:a.sort_order,onChange:f=>d("sort_order",f),type:"number",placeholder:"0"})}),e.jsx(z,{label:"Status",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,height:38,cursor:"pointer",fontSize:14},children:[e.jsx("input",{type:"checkbox",checked:a.is_active,onChange:f=>d("is_active",f.target.checked)}),"Active (visible to customers)"]})})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:i,children:"Cancel"}),e.jsx(j,{onClick:x,disabled:o,children:o?"Savingâ€¦":"Save Category"})]})]})}function Ft(t){return{name:t.name,name_dv:t.name_dv??"",description:t.description??"",sku:t.sku??"",image_url:t.image_url??"",base_price:String(t.base_price),tax_rate:t.tax_rate!=null?String(t.tax_rate):"",sort_order:t.sort_order!=null?String(t.sort_order):"",is_active:t.is_active,is_available:t.is_available,category_id:t.category_id!=null?String(t.category_id):""}}function de(t){return{name:t.name.trim(),name_dv:t.name_dv.trim()||null,description:t.description.trim()||null,sku:t.sku.trim()||null,image_url:t.image_url.trim()||null,base_price:parseFloat(t.base_price)||0,tax_rate:t.tax_rate!==""?parseFloat(t.tax_rate):null,sort_order:t.sort_order!==""?parseInt(t.sort_order):null,is_active:t.is_active,is_available:t.is_available,category_id:t.category_id!==""?parseInt(t.category_id):null}}function ce({initial:t,title:n,categories:s,onSave:i,onClose:a}){const[r,o]=l.useState(t),[h,u]=l.useState(!1),[y,d]=l.useState(""),x=(g,m)=>o(p=>({...p,[g]:m})),f=async()=>{if(!r.name.trim()){d("Item name is required.");return}if(!r.base_price||parseFloat(r.base_price)<0){d("Price must be 0 or more.");return}d(""),u(!0);try{await i(r)}catch(g){d(g.message)}finally{u(!1)}};return e.jsxs(ye,{onClose:a,wide:!0,children:[e.jsx("h3",{style:{fontWeight:800,fontSize:17,marginBottom:20,color:"#0f172a"},children:n}),y&&e.jsx(I,{message:y}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(z,{label:"Name (English) *",children:e.jsx(w,{value:r.name,onChange:g=>x("name",g),placeholder:"e.g. Chicken Grill"})}),e.jsx(z,{label:"Name (Dhivehi) â€” optional",children:e.jsx(w,{value:r.name_dv,onChange:g=>x("name_dv",g),placeholder:"Þ‹Þ¨ÞˆÞ¬Þ€Þ¨"})})]}),e.jsx(z,{label:"Description",children:e.jsx(fe,{value:r.description,onChange:g=>x("description",g),placeholder:"Describe the itemâ€¦"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(z,{label:"Price (MVR) *",children:e.jsx(w,{value:r.base_price,onChange:g=>x("base_price",g),type:"number",placeholder:"0.00"})}),e.jsx(z,{label:"Tax Rate (%)",children:e.jsx(w,{value:r.tax_rate,onChange:g=>x("tax_rate",g),type:"number",placeholder:"0"})}),e.jsx(z,{label:"Sort Order",children:e.jsx(w,{value:r.sort_order,onChange:g=>x("sort_order",g),type:"number",placeholder:"0"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:12},children:[e.jsx(z,{label:"Category",children:e.jsxs("select",{value:r.category_id,onChange:g=>x("category_id",g.target.value),style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"",children:"â€” No category â€”"}),s.map(g=>e.jsx("option",{value:String(g.id),children:g.name},g.id))]})}),e.jsx(z,{label:"SKU / Internal Code",children:e.jsx(w,{value:r.sku,onChange:g=>x("sku",g),placeholder:"e.g. CHKGRL-01"})})]}),e.jsx(z,{label:"Image URL",children:e.jsx(w,{value:r.image_url,onChange:g=>x("image_url",g),placeholder:"https://â€¦"})}),r.image_url&&e.jsx("img",{src:r.image_url,alt:"preview",style:{height:80,width:80,objectFit:"cover",borderRadius:10,border:"1px solid #e2e8f0"},onError:g=>{g.target.style.display="none"}}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:g=>x("is_active",g.target.checked)}),"Active (exists in system)"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.is_available,onChange:g=>x("is_available",g.target.checked)}),"Available (orderable today)"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx(j,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(j,{onClick:f,disabled:h,children:h?"Savingâ€¦":"Save Item"})]})]})}function ye({children:t,onClose:n,wide:s}){const i=l.useRef(null);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(15,23,42,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onMouseDown:a=>{a.target===a.currentTarget&&n()},children:e.jsx("div",{ref:i,style:{background:"#fff",borderRadius:16,padding:28,width:"100%",maxWidth:s?640:480,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:t})})}function Mt(){const[t,n]=l.useState("categories"),[s,i]=l.useState([]),[a,r]=l.useState([]),[o,h]=l.useState(!0),[u,y]=l.useState(""),[d,x]=l.useState(null),[f,g]=l.useState(""),[m,p]=l.useState(1),[k,v]=l.useState(1),[_,V]=l.useState(null),[Y,H]=l.useState(!1),[F,W]=l.useState(null),[q,b]=l.useState(!1),D=async()=>{h(!0);try{const c=await at();i(c.data)}catch(c){y(c.message)}finally{h(!1)}},M=async(c=m)=>{var T;h(!0);try{const E=await ot({category_id:d??void 0,search:f||void 0,page:c});r(E.data),v(((T=E.meta)==null?void 0:T.last_page)??1)}catch(E){y(E.message)}finally{h(!1)}};l.useEffect(()=>{D()},[]),l.useEffect(()=>{t==="items"&&(p(1),M(1))},[t,d,f]);const me=async c=>{await lt({name:c.name.trim(),name_dv:c.name_dv.trim()||null,description:c.description.trim()||null,image_url:c.image_url.trim()||null,sort_order:c.sort_order!==""?parseInt(c.sort_order):null}),H(!1),await D()},je=async c=>{_&&(await ae(_.id,{name:c.name.trim(),name_dv:c.name_dv.trim()||null,description:c.description.trim()||null,image_url:c.image_url.trim()||null,sort_order:c.sort_order!==""?parseInt(c.sort_order):null,is_active:c.is_active}),V(null),await D())},be=async c=>{if(confirm("Delete this category? It must have no items."))try{await rt(c),await D()}catch(T){y(T.message)}},ve=async c=>{await ae(c.id,{is_active:!c.is_active}),await D()},Se=async c=>{await dt(de(c)),b(!1),await M()},_e=async c=>{F&&(await ct(F.id,de(c)),W(null),await M())},Ce=async c=>{if(confirm("Delete this item?"))try{await gt(c),await M()}catch(T){y(T.message)}},we=async c=>{await xt(c.id),await M()},ke={name:"",name_dv:"",description:"",sku:"",image_url:"",base_price:"",tax_rate:"",sort_order:"",is_active:!0,is_available:!0,category_id:d!=null?String(d):""};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Menu Management",subtitle:"Categories, items, prices and availability",action:t==="categories"?e.jsx(j,{onClick:()=>H(!0),children:"+ New Category"}):e.jsx(j,{onClick:()=>b(!0),children:"+ New Item"})}),u&&e.jsx(I,{message:u}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:24,borderBottom:"2px solid #e2e8f0"},children:["categories","items"].map(c=>e.jsx("button",{onClick:()=>n(c),style:{padding:"10px 22px",fontSize:14,fontWeight:t===c?700:400,color:t===c?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",textTransform:"capitalize",borderBottom:t===c?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:c==="categories"?`Categories (${s.length})`:"Items"},c))}),t==="categories"&&(o&&s.length===0?e.jsx(B,{}):s.length===0?e.jsx(C,{children:e.jsx(L,{message:"No categories yet. Add your first one."})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:s.map(c=>{var T;return e.jsx(C,{style:{padding:"14px 18px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[c.image_url&&e.jsx("img",{src:c.image_url,alt:c.name,style:{width:52,height:52,objectFit:"cover",borderRadius:10,flexShrink:0},onError:E=>{E.target.style.display="none"}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:2},children:[e.jsx("span",{style:{fontWeight:700,fontSize:15},children:c.name}),c.name_dv&&e.jsx("span",{style:{color:"#94a3b8",fontSize:13},children:c.name_dv}),e.jsx(P,{label:c.is_active?"Active":"Hidden",color:c.is_active?"green":"gray"})]}),c.description&&e.jsx("p",{style:{fontSize:13,color:"#64748b",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.description}),e.jsxs("p",{style:{fontSize:12,color:"#94a3b8",margin:"2px 0 0"},children:["Sort: ",c.sort_order??0," Â· ",((T=c.items)==null?void 0:T.length)??"?"," items"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexShrink:0},children:[e.jsx(j,{small:!0,variant:"ghost",onClick:()=>ve(c),children:c.is_active?"Hide":"Show"}),e.jsx(j,{small:!0,variant:"secondary",onClick:()=>V(c),children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>be(c.id),children:"Delete"})]})]})},c.id)})})),t==="items"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("select",{value:d??"",onChange:c=>x(c.target.value?parseInt(c.target.value):null),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"8px 12px",fontSize:14,minWidth:180},children:[e.jsx("option",{value:"",children:"All Categories"}),s.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx(w,{value:f,onChange:g,placeholder:"Search by name or SKUâ€¦"})})]}),o&&a.length===0?e.jsx(B,{}):a.length===0?e.jsx(C,{children:e.jsx(L,{message:"No items found."})}):e.jsxs(e.Fragment,{children:[e.jsx(C,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["","Name","Category","Price","Available","Active",""].map((c,T)=>e.jsx("th",{style:{padding:"11px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:c},T))})}),e.jsx("tbody",{children:a.map(c=>{var T;return e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",opacity:c.is_active?1:.5},children:[e.jsx("td",{style:{padding:"10px 14px",width:52},children:c.image_url?e.jsx("img",{src:c.image_url,alt:c.name,style:{width:40,height:40,objectFit:"cover",borderRadius:8},onError:E=>{E.target.style.display="none"}}):e.jsx("div",{style:{width:40,height:40,background:"#f1f5f9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:"ðŸ½"})}),e.jsxs("td",{style:{padding:"10px 14px"},children:[e.jsx("div",{style:{fontWeight:600},children:c.name}),c.sku&&e.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:c.sku})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#475569",fontSize:13},children:((T=c.category)==null?void 0:T.name)??e.jsx("span",{style:{color:"#cbd5e1"},children:"â€”"})}),e.jsxs("td",{style:{padding:"10px 14px",fontWeight:700,color:"#0ea5e9"},children:["MVR ",c.base_price.toFixed(2)]}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx("button",{onClick:()=>we(c),style:{background:c.is_available?"#dcfce7":"#fee2e2",color:c.is_available?"#16a34a":"#dc2626",border:"none",borderRadius:20,padding:"3px 12px",fontSize:12,fontWeight:700,cursor:"pointer"},children:c.is_available?"Yes":"No"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(P,{label:c.is_active?"Active":"Hidden",color:c.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(j,{small:!0,variant:"secondary",onClick:()=>W(c),children:"Edit"}),e.jsx(j,{small:!0,variant:"danger",onClick:()=>Ce(c.id),children:"Delete"})]})})]},c.id)})})]})}),k>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,marginTop:16},children:[e.jsx(j,{small:!0,variant:"secondary",disabled:m<=1,onClick:()=>{const c=m-1;p(c),M(c)},children:"â† Prev"}),e.jsxs("span",{style:{padding:"6px 14px",fontSize:14,color:"#64748b"},children:["Page ",m," of ",k]}),e.jsx(j,{small:!0,variant:"secondary",disabled:m>=k,onClick:()=>{const c=m+1;p(c),M(c)},children:"Next â†’"})]})]})]}),Y&&e.jsx(oe,{initial:At,title:"New Category",onSave:me,onClose:()=>H(!1)}),_&&e.jsx(oe,{initial:{name:_.name,name_dv:_.name_dv??"",description:_.description??"",image_url:_.image_url??"",sort_order:_.sort_order!=null?String(_.sort_order):"",is_active:_.is_active},title:`Edit: ${_.name}`,onSave:je,onClose:()=>V(null)}),q&&e.jsx(ce,{initial:ke,title:"New Menu Item",categories:s,onSave:Se,onClose:()=>b(!1)}),F&&e.jsx(ce,{initial:Ft(F),title:`Edit: ${F.name}`,categories:s,onSave:_e,onClose:()=>W(null)})]})}function Nt({user:t,children:n}){return t?e.jsx(e.Fragment,{children:n}):e.jsx(Q,{to:"/login",replace:!0})}function $t(){const[t,n]=l.useState(null),[s,i]=l.useState(!0),a=ge();l.useEffect(()=>{if(!localStorage.getItem("admin_token")){i(!1);return}Fe().then(u=>n(u.user)).catch(()=>{localStorage.removeItem("admin_token"),a("/login")}).finally(()=>i(!1))},[]);const r=(h,u)=>{n(u),a("/orders")},o=()=>{n(null)};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9"},children:e.jsx("div",{style:{color:"#64748b",fontSize:14},children:"Loadingâ€¦"})}):e.jsxs(te,{children:[e.jsx(R,{path:"/login",element:e.jsx(ht,{onLogin:r})}),e.jsx(R,{path:"/*",element:e.jsx(Nt,{user:t,children:e.jsx(pt,{user:t,onLogout:o,children:e.jsxs(te,{children:[e.jsx(R,{index:!0,element:e.jsx(Q,{to:"/orders",replace:!0})}),e.jsx(R,{path:"orders",element:e.jsx(bt,{})}),e.jsx(R,{path:"kds",element:e.jsx(St,{})}),e.jsx(R,{path:"delivery",element:e.jsx(Ct,{})}),e.jsx(R,{path:"promotions",element:e.jsx(Tt,{})}),e.jsx(R,{path:"loyalty",element:e.jsx(Bt,{})}),e.jsx(R,{path:"sms",element:e.jsx(Wt,{})}),e.jsx(R,{path:"reports",element:e.jsx(Ot,{})}),e.jsx(R,{path:"menu",element:e.jsx(Mt,{})}),e.jsx(R,{path:"*",element:e.jsx(Q,{to:"/orders",replace:!0})})]})})})})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(Pe.StrictMode,{children:e.jsx(Re,{basename:"/admin",children:e.jsx($t,{})})}));
