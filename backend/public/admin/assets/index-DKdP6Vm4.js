import{r,a as re,u as Q,N as ae,R as H,b as C,c as N,d as de,B as ce}from"./vendor-ik71KGou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Z={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xe=r,fe=Symbol.for("react.element"),ue=Symbol.for("react.fragment"),ge=Object.prototype.hasOwnProperty,pe=xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,he={key:!0,ref:!0,__self:!0,__source:!0};function ee(t,n,s){var o,i={},a=null,l=null;s!==void 0&&(a=""+s),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(l=n.ref);for(o in n)ge.call(n,o)&&!he.hasOwnProperty(o)&&(i[o]=n[o]);if(t&&t.defaultProps)for(o in n=t.defaultProps,n)i[o]===void 0&&(i[o]=n[o]);return{$$typeof:fe,type:t,key:a,ref:l,props:i,_owner:pe.current}}A.Fragment=ue;A.jsx=ee;A.jsxs=ee;Z.exports=A;var e=Z.exports,V={},J=re;V.createRoot=J.createRoot,V.hydrateRoot=J.hydrateRoot;const ye="/api";async function v(t,n={}){var i;const s=localStorage.getItem("admin_token"),o=await fetch(`${ye}${t}`,{headers:{"Content-Type":"application/json",Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{},...n.headers},...n});if(!o.ok){const a=await o.json().catch(()=>({}));throw new Error(a.message??((i=Object.values(a.errors??{})[0])==null?void 0:i[0])??`HTTP ${o.status}`)}return o.json()}async function me(t){return v("/auth/staff/pin-login",{method:"POST",body:JSON.stringify({pin:t})})}async function je(){return v("/auth/me")}async function be(){await v("/auth/logout",{method:"POST"})}async function te(t){const n=new URLSearchParams;return t!=null&&t.status&&n.set("status",t.status),t!=null&&t.type&&n.set("type",t.type),t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.date&&n.set("date",t.date),v(`/orders?${n}`)}async function ve(t){return v(`/orders/${t}`)}async function Se(){return v("/kds/orders?status=pending,in_progress,paid")}async function _e(t){await v(`/kds/orders/${t}/start`,{method:"POST"})}async function Y(t){await v(`/kds/orders/${t}/bump`,{method:"POST"})}async function we(t){await v(`/kds/orders/${t}/recall`,{method:"POST"})}async function ke(){return v("/admin/promotions")}async function Ce(t){return v("/admin/promotions",{method:"POST",body:JSON.stringify(t)})}async function K(t,n){return v(`/admin/promotions/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function ze(t){await v(`/admin/promotions/${t}`,{method:"DELETE"})}async function Te(t){const n=new URLSearchParams;return t!=null&&t.page&&n.set("page",String(t.page)),t!=null&&t.search&&n.set("search",t.search),v(`/admin/loyalty/accounts?${n}`)}async function Pe(t,n,s){await v(`/admin/loyalty/accounts/${t}/adjust`,{method:"POST",body:JSON.stringify({delta:n,reason:s})})}async function Re(t){return v(`/admin/loyalty/accounts/${t}/ledger`)}async function Be(t){const n=new URLSearchParams;return t!=null&&t.type&&n.set("type",t.type),t!=null&&t.status&&n.set("status",t.status),t!=null&&t.page&&n.set("page",String(t.page)),v(`/admin/sms/logs?${n}`)}async function Le(){const n=(await v("/admin/sms/logs/stats")).stats??[],s=n.reduce((l,u)=>l+u.count,0),o=n.filter(l=>l.status==="sent").reduce((l,u)=>l+u.count,0),i=n.filter(l=>l.status==="failed").reduce((l,u)=>l+u.count,0),a={};for(const l of n)a[l.type]=(a[l.type]??0)+l.count;return{total:s,sent:o,failed:i,by_type:a}}async function We(){return v("/admin/sms/campaigns")}async function De(t){return v("/admin/sms/campaigns/preview",{method:"POST",body:JSON.stringify(t)})}async function Oe(t){return v("/admin/sms/campaigns",{method:"POST",body:JSON.stringify(t)})}async function Ie(t){await v(`/admin/sms/campaigns/${t}/send`,{method:"POST"})}async function Ae(t){await v(`/admin/sms/campaigns/${t}/cancel`,{method:"POST"})}async function Ee(t){var a,l;const n=new URLSearchParams;t!=null&&t.from&&n.set("from",t.from),t!=null&&t.to&&n.set("to",t.to);const s=await v(`/reports/sales-summary?${n}`),o=((a=s.totals)==null?void 0:a.orders_count)??0,i=((l=s.totals)==null?void 0:l.total)??0;return{total_revenue:i,order_count:o,average_order_value:o>0?i/o:0,period:`${s.from} â€“ ${s.to}`}}const Fe=[{to:"/orders",icon:"ðŸ“‹",label:"Orders"},{to:"/kds",icon:"ðŸ‘¨â€ðŸ³",label:"Kitchen"},{to:"/delivery",icon:"ðŸ›µ",label:"Delivery"},{to:"/promotions",icon:"ðŸ·ï¸",label:"Promos"},{to:"/loyalty",icon:"â­",label:"Loyalty"},{to:"/sms",icon:"ðŸ“±",label:"SMS"},{to:"/reports",icon:"ðŸ“Š",label:"Reports"}];function Me({user:t,children:n,onLogout:s}){const o=Q(),[i,a]=r.useState(!1),l=async()=>{try{await be()}catch{}localStorage.removeItem("admin_token"),s(),o("/login")};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"#f1f5f9"},children:[e.jsxs("aside",{style:{width:i?64:220,background:"#0f172a",display:"flex",flexDirection:"column",transition:"width 0.2s",flexShrink:0,position:"sticky",top:0,height:"100vh",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:i?"20px 12px":"20px 20px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",gap:10,cursor:"pointer"},onClick:()=>a(!i),children:[e.jsx("span",{style:{fontSize:22,flexShrink:0},children:"ðŸž"}),!i&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:800,fontSize:14},children:"Bake & Grill"}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:"Admin"})]})]}),e.jsx("nav",{style:{flex:1,padding:"12px 0"},children:Fe.map(({to:u,icon:x,label:g})=>e.jsxs(ae,{to:u,style:({isActive:d})=>({display:"flex",alignItems:"center",gap:12,padding:i?"12px 20px":"11px 20px",color:d?"#38bdf8":"#94a3b8",textDecoration:"none",fontWeight:d?700:400,fontSize:14,background:d?"rgba(56,189,248,0.08)":"transparent",borderLeft:d?"3px solid #38bdf8":"3px solid transparent",transition:"all 0.15s",whiteSpace:"nowrap"}),children:[e.jsx("span",{style:{fontSize:18,flexShrink:0},children:x}),!i&&e.jsx("span",{children:g})]},u))}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid #1e293b"},children:[!i&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{color:"#f8fafc",fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsx("div",{style:{color:"#64748b",fontSize:11},children:t.role??"Staff"})]}),e.jsx("button",{onClick:l,style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.2)",color:"#f87171",borderRadius:8,padding:i?"8px":"8px 14px",fontSize:12,fontWeight:600,width:"100%",cursor:"pointer"},children:i?"â†’":"Logout"})]})]}),e.jsx("main",{style:{flex:1,minWidth:0,padding:"24px",overflowY:"auto"},children:n})]})}function W({title:t,subtitle:n,action:s}){return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:t}),n&&e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:2},children:n})]}),s&&e.jsx("div",{children:s})]})}function S({children:t,style:n}){return e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",padding:"20px 24px",boxShadow:"0 1px 4px rgba(0,0,0,0.04)",...n},children:t})}function k({label:t,color:n}){const s={green:{bg:"#dcfce7",text:"#166534"},yellow:{bg:"#fef9c3",text:"#854d0e"},blue:{bg:"#dbeafe",text:"#1e40af"},red:{bg:"#fee2e2",text:"#991b1b"},gray:{bg:"#f1f5f9",text:"#475569"},teal:{bg:"#ccfbf1",text:"#115e59"},orange:{bg:"#ffedd5",text:"#9a3412"}},o=s[n]??s.gray;return e.jsx("span",{style:{background:o.bg,color:o.text,padding:"2px 10px",borderRadius:999,fontSize:12,fontWeight:600,display:"inline-block"},children:t})}function b({children:t,onClick:n,variant:s="primary",disabled:o,small:i,style:a}){const l={primary:{background:"#0ea5e9",color:"#fff",border:"none"},secondary:{background:"#f1f5f9",color:"#0f172a",border:"1px solid #e2e8f0"},danger:{background:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca"},ghost:{background:"transparent",color:"#64748b",border:"1px solid #e2e8f0"}};return e.jsx("button",{onClick:n,disabled:o,style:{...l[s],padding:i?"5px 12px":"9px 18px",borderRadius:9,fontSize:i?12:14,fontWeight:600,cursor:o?"not-allowed":"pointer",opacity:o?.6:1,transition:"opacity 0.15s",...a},children:t})}function z({value:t,onChange:n,placeholder:s,type:o="text",style:i}){return e.jsx("input",{type:o,value:t,onChange:a=>n(a.target.value),placeholder:s,style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",outline:"none",width:"100%",background:"#fff",...i}})}function O({value:t,onChange:n,options:s,style:o}){return e.jsx("select",{value:t,onChange:i=>n(i.target.value),style:{border:"1px solid #e2e8f0",borderRadius:9,padding:"9px 12px",fontSize:14,color:"#0f172a",background:"#fff",cursor:"pointer",...o},children:s.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})}function T(){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:"Loadingâ€¦"})}function P({message:t}){return e.jsx("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8",fontSize:14},children:t})}function R({message:t}){return e.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#991b1b",borderRadius:10,padding:"12px 16px",fontSize:13,marginBottom:16},children:t})}function D(t){return{pending:"yellow",preparing:"blue",in_progress:"blue",ready:"teal",paid:"green",completed:"gray",cancelled:"red",out_for_delivery:"teal",draft:"gray",sent:"green",failed:"red",active:"green",expired:"gray"}[t]??"gray"}function $e({onLogin:t}){const[n,s]=r.useState(""),[o,i]=r.useState(""),[a,l]=r.useState(!1),u=async()=>{if(!(n.length<4)){i(""),l(!0);try{const d=await me(n);localStorage.setItem("admin_token",d.token),t(d.token,d.user)}catch(d){i(d.message),s("")}finally{l(!1)}}},x=d=>{n.length<8&&s(f=>f+d)},g=()=>s("");return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,padding:"40px 36px",width:"100%",maxWidth:380,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:"ðŸž"}),e.jsx("h1",{style:{fontSize:22,fontWeight:800,color:"#0f172a"},children:"Bake & Grill"}),e.jsx("p",{style:{color:"#64748b",fontSize:14,marginTop:4},children:"Staff Admin â€” Enter your PIN"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:10,marginBottom:24,minHeight:54,alignItems:"center"},children:n.length===0?e.jsx("span",{style:{color:"#94a3b8",fontSize:14},children:"Enter your PIN below"}):Array.from({length:n.length}).map((d,f)=>e.jsx("div",{style:{width:16,height:16,borderRadius:"50%",background:"#0ea5e9",transition:"all 0.1s"}},f))}),o&&e.jsx("div",{style:{background:"#fee2e2",color:"#991b1b",borderRadius:10,padding:"10px 14px",fontSize:13,marginBottom:16,textAlign:"center"},children:o}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:10},children:["1","2","3","4","5","6","7","8","9","","0","âŒ«"].map(d=>e.jsx("button",{onClick:()=>{d==="âŒ«"?s(f=>f.slice(0,-1)):d!==""&&x(d)},disabled:d==="",style:{height:56,borderRadius:12,border:"1px solid #e2e8f0",background:d==="âŒ«"?"#fee2e2":d===""?"transparent":"#f8fafc",fontSize:18,fontWeight:700,color:d==="âŒ«"?"#991b1b":"#0f172a",cursor:d===""?"default":"pointer",transition:"background 0.1s"},children:d},d))}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[e.jsx("button",{onClick:g,style:{flex:1,height:48,borderRadius:12,border:"1px solid #e2e8f0",background:"#f1f5f9",fontSize:14,fontWeight:600,color:"#64748b",cursor:"pointer"},children:"Clear"}),e.jsx("button",{onClick:u,disabled:n.length<4||a,style:{flex:2,height:48,borderRadius:12,border:"none",background:a||n.length<4?"#bae6fd":"#0ea5e9",fontSize:14,fontWeight:700,color:"#fff",cursor:"pointer",transition:"background 0.15s"},children:a?"Signing inâ€¦":"Sign In â†’"})]})]})})}const Ne=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"preparing",label:"Preparing"},{value:"ready",label:"Ready"},{value:"paid",label:"Paid"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],Ve=[{value:"",label:"All Types"},{value:"dine_in",label:"Dine In"},{value:"takeaway",label:"Takeaway"},{value:"online_pickup",label:"Online Pickup"},{value:"delivery",label:"Delivery"}];function U(t){return{dine_in:"Dine In",takeaway:"Takeaway",online_pickup:"Online",delivery:"Delivery",preorder:"Pre-order"}[t]??t}function Ue(t){const n=Date.now()-new Date(t).getTime(),s=Math.floor(n/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const o=Math.floor(s/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`}function qe({orderId:t,onClose:n}){var l,u,x,g;const[s,o]=r.useState(null),[i,a]=r.useState(!0);return r.useEffect(()=>{ve(t).then(d=>{o(d.order),a(!1)}).catch(()=>a(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"stretch",justifyContent:"flex-end"},onClick:n,children:e.jsxs("div",{style:{width:420,background:"#fff",height:"100%",overflowY:"auto",padding:24,boxShadow:"-4px 0 20px rgba(0,0,0,0.1)"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:18,color:"#0f172a"},children:s?`#${s.order_number}`:"Order Details"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#64748b"},children:"âœ•"})]}),i&&e.jsx(T,{}),!i&&!s&&e.jsx(P,{message:"Order not found."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:20},children:[e.jsx(k,{label:s.status,color:D(s.status)}),e.jsx(k,{label:U(s.type),color:"blue"})]}),e.jsxs("div",{style:{background:"#f8fafc",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx(L,{label:"Order #",value:s.order_number}),e.jsx(L,{label:"Type",value:U(s.type)}),e.jsx(L,{label:"Time",value:new Date(s.created_at).toLocaleString()}),s.table_number&&e.jsx(L,{label:"Table",value:s.table_number}),(((l=s.customer)==null?void 0:l.name)??s.customer_name)&&e.jsx(L,{label:"Customer",value:((u=s.customer)==null?void 0:u.name)??s.customer_name}),(((x=s.customer)==null?void 0:x.phone)??s.customer_phone)&&e.jsx(L,{label:"Phone",value:((g=s.customer)==null?void 0:g.phone)??s.customer_phone}),s.paid_at&&e.jsx(L,{label:"Paid at",value:new Date(s.paid_at).toLocaleString()})]}),s.type==="delivery"&&s.delivery_address_line1&&e.jsxs("div",{style:{background:"#eff6ff",borderRadius:10,padding:"14px 16px",marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#1e40af",marginBottom:8},children:"Delivery Address"}),e.jsx("p",{style:{fontSize:14},children:s.delivery_address_line1}),s.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:s.delivery_island}),s.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:4},children:[s.delivery_contact_name," Â· ",s.delivery_contact_phone]})]}),s.items&&s.items.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#475569",marginBottom:8},children:"Items"}),s.items.map(d=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,paddingBottom:6,marginBottom:6,borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:[d.quantity,"Ã— ",d.item_name]}),e.jsxs("span",{style:{color:"#0ea5e9",fontWeight:600},children:["MVR ",(d.total_price??0).toFixed(2)]})]},d.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:16,paddingTop:8},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["MVR ",s.total.toFixed(2)]})]})]}),s.notes&&e.jsxs("div",{style:{background:"#fefce8",borderRadius:10,padding:"12px 14px",fontSize:13,color:"#713f12"},children:["ðŸ“ ",s.notes]})]})]})})}function L({label:t,value:n}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:4},children:[e.jsx("span",{style:{color:"#64748b"},children:t}),e.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:n})]})}function He(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(""),[x,g]=r.useState(""),[d,f]=r.useState(null),[y,p]=r.useState(1),[h,c]=r.useState(1),w=async()=>{var m;o(!0),a("");try{const _=await te({status:l||void 0,type:x||void 0,page:y});n(_.data),c(((m=_.meta)==null?void 0:m.last_page)??1)}catch(_){a(_.message)}finally{o(!1)}};return r.useEffect(()=>{w()},[l,x,y]),r.useEffect(()=>{const m=setInterval(()=>void w(),3e4);return()=>clearInterval(m)},[l,x,y]),e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Orders",subtitle:"All customer and POS orders",action:e.jsx(b,{onClick:w,variant:"secondary",children:"â†» Refresh"})}),i&&e.jsx(R,{message:i}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(O,{value:l,onChange:m=>{u(m),p(1)},options:Ne,style:{width:160}}),e.jsx(O,{value:x,onChange:m=>{g(m),p(1)},options:Ve,style:{width:160}})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No orders found."})}):e.jsxs(S,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Order #","Type","Status","Customer","Total","Time",""].map(m=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:m},m))})}),e.jsx("tbody",{children:t.map(m=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",transition:"background 0.1s"},onMouseEnter:_=>{_.currentTarget.style.background="#f8fafc"},onMouseLeave:_=>{_.currentTarget.style.background=""},children:[e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0f172a"},children:["#",m.order_number,m.type==="delivery"&&e.jsx("span",{style:{marginLeft:6,fontSize:12},children:"ðŸ›µ"})]}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(k,{label:U(m.type),color:"blue"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(k,{label:m.status,color:D(m.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:m.customer_name??m.table_number??"â€”"}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:600,color:"#0ea5e9"},children:["MVR ",m.total.toFixed(2)]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:Ue(m.created_at)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(b,{small:!0,onClick:()=>f(m.id),variant:"ghost",children:"View"})})]},m.id))})]}),h>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,padding:"16px"},children:[e.jsx(b,{small:!0,variant:"secondary",disabled:y<=1,onClick:()=>p(m=>m-1),children:"â† Prev"}),e.jsxs("span",{style:{lineHeight:"30px",fontSize:13,color:"#64748b"},children:["Page ",y," of ",h]}),e.jsx(b,{small:!0,variant:"secondary",disabled:y>=h,onClick:()=>p(m=>m+1),children:"Next â†’"})]})]}),d&&e.jsx(qe,{orderId:d,onClose:()=>f(null)})]})}function Je(t){const n=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(n<60)return`${n}s`;const s=Math.floor(n/60);return s<60?`${s}m ${n%60}s`:`${Math.floor(s/60)}h ${s%60}m`}function ne(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n>=15?"#ef4444":n>=8?"#f97316":"#22c55e"}function Ye(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(null),x=async()=>{try{const h=await Se();n(h.orders),a("")}catch(h){a(h.message)}finally{o(!1)}};r.useEffect(()=>{x();const h=setInterval(()=>void x(),1e4);return()=>clearInterval(h)},[]);const g=async(h,c)=>{u(h);try{await c(h),await x()}catch(w){a(w.message)}finally{u(null)}},d=t.filter(h=>["pending","paid"].includes(h.status)),f=t.filter(h=>h.status==="in_progress"),y=[],p=({title:h,items:c,color:w,children:m})=>e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:w}}),e.jsx("span",{style:{fontWeight:700,fontSize:14,color:"#0f172a"},children:h}),e.jsx("span",{style:{background:"#f1f5f9",color:"#64748b",borderRadius:999,padding:"1px 8px",fontSize:12,fontWeight:600},children:c.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:c.length===0?e.jsx("div",{style:{color:"#94a3b8",fontSize:13,padding:"20px 0"},children:"Nothing here"}):c.map(_=>e.jsx("div",{style:{background:"#fff",borderRadius:14,padding:"16px",border:`2px solid ${ne(_.created_at)}22`,boxShadow:"0 2px 6px rgba(0,0,0,0.04)"},children:m(_)},_.id))})]});return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Kitchen Display",subtitle:"Live ticket board â€” auto-refreshes every 10s",action:e.jsx(b,{onClick:x,variant:"secondary",children:"â†» Refresh"})}),i&&e.jsx(R,{message:i}),s&&t.length===0?e.jsx(S,{children:e.jsx(P,{message:"Loading kitchen ticketsâ€¦"})}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:20},children:[e.jsx(p,{title:"Pending",items:d,color:"#f59e0b",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsx(b,{small:!0,onClick:()=>g(h.id,_e),disabled:l===h.id,style:{marginTop:12,width:"100%",background:"#f59e0b",color:"#fff",border:"none"},children:l===h.id?"â€¦":"Start Cooking"})]})}),e.jsx(p,{title:"Cooking",items:f,color:"#3b82f6",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsx(b,{small:!0,onClick:()=>g(h.id,Y),disabled:l===h.id,style:{marginTop:12,width:"100%",background:"#3b82f6",color:"#fff",border:"none"},children:l===h.id?"â€¦":"Mark Ready âœ“"})]})}),e.jsx(p,{title:"Ready",items:y,color:"#22c55e",children:h=>e.jsxs(e.Fragment,{children:[e.jsx(F,{ticket:h}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx(b,{small:!0,onClick:()=>g(h.id,Y),disabled:l===h.id,style:{flex:1,background:"#22c55e",color:"#fff",border:"none"},children:"Complete"}),e.jsx(b,{small:!0,onClick:()=>g(h.id,we),disabled:l===h.id,variant:"ghost",children:"Recall"})]})]})})]})]})}function F({ticket:t}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:"#0f172a"},children:["#",t.order_number]}),t.table_number&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#64748b"},children:["Table ",t.table_number]}),t.delivery_island&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#0ea5e9"},children:["ðŸ›µ ",t.delivery_island]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{color:ne(t.created_at),fontSize:13,fontWeight:700},children:Je(t.created_at)}),e.jsx(k,{label:t.type,color:D(t.status)})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.items.map((n,s)=>e.jsxs("div",{style:{fontSize:13,color:"#374151"},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0f172a"},children:[n.quantity,"Ã—"]})," ",n.item_name,n.modifiers&&n.modifiers.length>0&&e.jsxs("span",{style:{color:"#6b7280",fontSize:11,display:"block",marginLeft:16},children:["+ ",n.modifiers.map(o=>o.modifier_name).join(", ")]})]},s))})]})}function Ke(t){const n=Math.floor((Date.now()-new Date(t).getTime())/6e4);return n<1?"just now":n<60?`${n}m ago`:`${Math.floor(n/60)}h ago`}function Ge(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(null),x=async()=>{try{const f=await te({type:"delivery"});n(f.data),a("")}catch(f){a(f.message)}finally{o(!1)}};r.useEffect(()=>{x();const f=setInterval(()=>void x(),3e4);return()=>clearInterval(f)},[]);const g=t.filter(f=>!["completed","cancelled"].includes(f.status)),d=t.filter(f=>["completed","cancelled"].includes(f.status));return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Delivery Orders",subtitle:"All delivery orders â€” auto-refreshes every 30s",action:e.jsx(b,{onClick:x,variant:"secondary",children:"â†» Refresh"})}),i&&e.jsx(R,{message:i}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No delivery orders yet."})}):e.jsxs(e.Fragment,{children:[g.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#475569",marginBottom:12},children:["ACTIVE (",g.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16,marginBottom:28},children:g.map(f=>e.jsx(G,{order:f,onSelect:u},f.id))})]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{style:{fontSize:14,fontWeight:700,color:"#94a3b8",marginBottom:12},children:["COMPLETED (",d.length,")"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:d.slice(0,10).map(f=>e.jsx(G,{order:f,onSelect:u},f.id))})]})]}),l&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:()=>u(null),children:e.jsx(S,{style:{width:"100%",maxWidth:480},children:e.jsxs("div",{onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:18},children:["#",l.order_number]}),e.jsx("button",{onClick:()=>u(null),style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),e.jsx(k,{label:l.status,color:D(l.status)}),e.jsxs("div",{style:{background:"#f0f9ff",borderRadius:10,padding:16,marginTop:16},children:[e.jsx("p",{style:{fontWeight:700,fontSize:13,color:"#0369a1",marginBottom:8},children:"Delivery Details"}),e.jsx("p",{style:{fontSize:14,color:"#0f172a"},children:l.delivery_address_line1??"N/A"}),l.delivery_island&&e.jsx("p",{style:{fontSize:13,color:"#475569"},children:l.delivery_island}),l.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#475569",marginTop:6},children:["ðŸ‘¤ ",l.delivery_contact_name," Â· ",l.delivery_contact_phone]})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:18},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:"#0ea5e9"},children:["MVR ",l.total.toFixed(2)]})]})]})})})]})}function G({order:t,onSelect:n}){const s=t.status==="pending"&&Date.now()-new Date(t.created_at).getTime()>6e5;return e.jsxs(S,{style:{border:s?"2px solid #ef4444":void 0,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10},children:[e.jsxs("span",{style:{fontWeight:800,fontSize:15,color:"#0f172a"},children:["#",t.order_number]}),e.jsx(k,{label:t.status,color:D(t.status)})]}),e.jsx("p",{style:{fontSize:14,color:"#374151",marginBottom:4},children:t.delivery_address_line1??"â€”"}),t.delivery_island&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ“ ",t.delivery_island]}),t.delivery_contact_name&&e.jsxs("p",{style:{fontSize:13,color:"#64748b"},children:["ðŸ‘¤ ",t.delivery_contact_name]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[e.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:Ke(t.created_at)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:"#0ea5e9"},children:["MVR ",t.total.toFixed(2)]}),e.jsx(b,{small:!0,variant:"ghost",onClick:()=>n(t),children:"Details"})]})]})]})}const Xe={name:"",code:"",type:"fixed",discount_value:0,scope:"order",min_order_laar:null,max_uses:null,stackable:!1,is_active:!0,starts_at:null,expires_at:null};function Qe({initial:t,onSave:n,onCancel:s}){const[o,i]=r.useState(t),[a,l]=r.useState(!1),[u,x]=r.useState(""),g=(c,w)=>i(m=>({...m,[c]:w})),d=o.type==="fixed"?String((o.discount_value/100).toFixed(2)):String(o.discount_value),f=c=>{const w=parseFloat(c)||0;g("discount_value",o.type==="fixed"?Math.round(w*100):w)},y=o.min_order_laar!=null?String((o.min_order_laar/100).toFixed(2)):"",p=c=>{g("min_order_laar",c?Math.round(parseFloat(c)*100):null)},h=async()=>{if(!o.name||!o.code){x("Name and code are required.");return}x(""),l(!0);try{await n(o)}catch(c){x(c.message)}finally{l(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[u&&e.jsx(R,{message:u}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(B,{label:"Promo Name",children:e.jsx(z,{value:o.name,onChange:c=>g("name",c),placeholder:"e.g. Ramadan Special"})}),e.jsx(B,{label:"Code",children:e.jsx(z,{value:o.code,onChange:c=>g("code",c.toUpperCase()),placeholder:"e.g. RAMADAN20"})}),e.jsx(B,{label:"Discount Type",children:e.jsx(O,{value:o.type,onChange:c=>g("type",c),options:[{value:"fixed",label:"Fixed Amount (MVR)"},{value:"percentage",label:"Percentage (%)"}]})}),e.jsx(B,{label:`Discount Value (${o.type==="percentage"?"%":"MVR"})`,children:e.jsx(z,{value:d,onChange:f,type:"number"})}),e.jsx(B,{label:"Min Order Amount (MVR)",children:e.jsx(z,{value:y,onChange:p,type:"number",placeholder:"No minimum"})}),e.jsx(B,{label:"Max Uses",children:e.jsx(z,{value:o.max_uses!=null?String(o.max_uses):"",onChange:c=>g("max_uses",c?parseInt(c):null),type:"number",placeholder:"Unlimited"})}),e.jsx(B,{label:"Starts At",children:e.jsx(z,{value:o.starts_at??"",onChange:c=>g("starts_at",c||null),type:"datetime-local"})}),e.jsx(B,{label:"Expires At",children:e.jsx(z,{value:o.expires_at??"",onChange:c=>g("expires_at",c||null),type:"datetime-local"})})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o.is_active,onChange:c=>g("is_active",c.target.checked)}),"Active"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:14,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o.stackable,onChange:c=>g("stackable",c.target.checked)}),"Stackable"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(b,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsx(b,{onClick:h,disabled:a,children:a?"Savingâ€¦":"Save Promo"})]})]})}function B({label:t,children:n}){return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:"#475569",marginBottom:4},children:t}),n]})}function Ze(t){return t.type==="percentage"?`${t.discount_value}%`:t.type==="fixed"?`MVR ${(t.discount_value/100).toFixed(2)}`:t.type}function et(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(!1),[x,g]=r.useState(null),d=async()=>{o(!0);try{const c=await ke();n(c.data)}catch(c){a(c.message)}finally{o(!1)}};r.useEffect(()=>{d()},[]);const f=async c=>{await Ce(c),u(!1),await d()},y=async c=>{x&&(await K(x.id,c),g(null),await d())},p=async c=>{confirm("Delete this promotion?")&&(await ze(c),await d())},h=async c=>{await K(c.id,{is_active:!c.is_active}),await d()};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Promotions",subtitle:"Manage promo codes and discounts",action:!l&&!x?e.jsx(b,{onClick:()=>u(!0),children:"+ New Promo"}):void 0}),i&&e.jsx(R,{message:i}),(l||x)&&e.jsxs(S,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:18,color:"#0f172a"},children:l?"Create New Promotion":`Edit: ${x==null?void 0:x.name}`}),e.jsx(Qe,{initial:x?{name:x.name,code:x.code,type:x.type==="percentage"?"percentage":"fixed",discount_value:x.discount_value,scope:x.scope,min_order_laar:x.min_order_laar,max_uses:x.max_uses,stackable:x.stackable,is_active:x.is_active,starts_at:x.starts_at,expires_at:x.expires_at}:Xe,onSave:l?f:y,onCancel:()=>{u(!1),g(null)}})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No promotions yet. Create your first promo code."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Code","Discount","Uses","Valid","Status",""].map(c=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:c},c))})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:c.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 8px",borderRadius:6,fontSize:13,fontWeight:700,letterSpacing:1},children:c.code})}),e.jsx("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:Ze(c)}),e.jsxs("td",{style:{padding:"12px 16px",color:"#475569"},children:[c.redemptions_count,c.max_uses?` / ${c.max_uses}`:""]}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569",fontSize:12},children:c.expires_at?new Date(c.expires_at).toLocaleDateString():"âˆž"}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(k,{label:c.is_active?"Active":"Inactive",color:c.is_active?"green":"gray"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(b,{small:!0,variant:"ghost",onClick:()=>h(c),children:c.is_active?"Disable":"Enable"}),e.jsx(b,{small:!0,variant:"secondary",onClick:()=>{g(c),u(!1)},children:"Edit"}),e.jsx(b,{small:!0,variant:"danger",onClick:()=>p(c.id),children:"Delete"})]})})]},c.id))})]})})]})}const tt={bronze:"orange",silver:"gray",gold:"yellow",platinum:"blue"};function nt({customerId:t,name:n,onClose:s}){const[o,i]=r.useState([]),[a,l]=r.useState(!0);return r.useEffect(()=>{Re(t).then(u=>i(u.data)).finally(()=>l(!1))},[t]),e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s,children:e.jsx(S,{style:{width:"100%",maxWidth:520,maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h2",{style:{fontWeight:800,fontSize:17},children:["Ledger â€” ",n]}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:"#94a3b8"},children:"âœ•"})]}),a?e.jsx(T,{}):o.length===0?e.jsx(P,{message:"No transactions yet."}):e.jsx("div",{style:{overflowY:"auto",flex:1},children:o.map(u=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,color:"#374151"},children:u.reason}),e.jsx("p",{style:{fontSize:11,color:"#94a3b8"},children:new Date(u.created_at).toLocaleString()})]}),e.jsxs("span",{style:{fontWeight:800,fontSize:16,color:u.delta>=0?"#22c55e":"#ef4444"},children:[u.delta>=0?"+":"",u.delta," pts"]})]},u.id))})]})})})}function st({account:t,onClose:n,onDone:s}){const[o,i]=r.useState(""),[a,l]=r.useState(""),[u,x]=r.useState(!1),[g,d]=r.useState(""),f=async()=>{const y=parseInt(o);if(!y||!a){d("Delta and reason are required.");return}d(""),x(!0);try{await Pe(t.customer_id,y,a),s(),n()}catch(p){d(p.message)}finally{x(!1)}};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:n,children:e.jsx(S,{style:{width:"100%",maxWidth:400},children:e.jsxs("div",{onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx("h2",{style:{fontWeight:800,fontSize:17},children:"Adjust Points"}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",fontSize:20,cursor:"pointer"},children:"âœ•"})]}),e.jsxs("p",{style:{color:"#475569",fontSize:14,marginBottom:16},children:[t.customer_name??t.customer_phone," â€” current balance: ",e.jsxs("strong",{children:[t.points_balance," pts"]})]}),g&&e.jsx(R,{message:g}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Points (use âˆ’ to deduct)"}),e.jsx(z,{value:o,onChange:i,placeholder:"e.g. 100 or -50",type:"number"})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Reason"}),e.jsx(z,{value:a,onChange:l,placeholder:"e.g. Goodwill adjustment"})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(b,{variant:"ghost",onClick:n,children:"Cancel"}),e.jsx(b,{onClick:f,disabled:u,children:u?"Savingâ€¦":"Apply Adjustment"})]})]})})})}function ot(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(""),[x,g]=r.useState(null),[d,f]=r.useState(null),y=async()=>{o(!0);try{const p=await Te({search:l||void 0});n(p.data)}catch(p){a(p.message)}finally{o(!1)}};return r.useEffect(()=>{y()},[l]),e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Loyalty Accounts",subtitle:"View and manage customer loyalty points"}),i&&e.jsx(R,{message:i}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(z,{value:l,onChange:u,placeholder:"Search by name or phoneâ€¦",style:{maxWidth:320}})}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No loyalty accounts found."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Customer","Phone","Tier","Balance","Held","Lifetime",""].map(p=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:p},p))})}),e.jsx("tbody",{children:t.map(p=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:p.customer_name??"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:p.customer_phone}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(k,{label:p.tier,color:tt[p.tier]??"gray"})}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0ea5e9"},children:[p.points_balance.toLocaleString()," pts"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8"},children:p.points_held>0?`${p.points_held} held`:"â€”"}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:p.lifetime_points.toLocaleString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(b,{small:!0,variant:"ghost",onClick:()=>f(p),children:"Ledger"}),e.jsx(b,{small:!0,variant:"secondary",onClick:()=>g(p),children:"Adjust"})]})})]},p.id))})]})}),x&&e.jsx(st,{account:x,onClose:()=>g(null),onDone:y}),d&&e.jsx(nt,{customerId:d.customer_id,name:d.customer_name??d.customer_phone,onClose:()=>f(null)})]})}function it(){const[t,n]=r.useState([]),[s,o]=r.useState(null),[i,a]=r.useState(!0),[l,u]=r.useState(""),[x,g]=r.useState(""),d=async()=>{a(!0);try{const[f,y]=await Promise.all([Be({type:l||void 0,status:x||void 0}),Le()]);n(f.data),o(y)}finally{a(!1)}};return r.useEffect(()=>{d()},[l,x]),e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:14,marginBottom:20},children:[e.jsx(M,{label:"Total SMS",value:s.total,color:"#0ea5e9"}),e.jsx(M,{label:"Sent",value:s.sent,color:"#22c55e"}),e.jsx(M,{label:"Failed",value:s.failed,color:"#ef4444"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsx(O,{value:l,onChange:u,options:[{value:"",label:"All Types"},{value:"otp",label:"OTP"},{value:"promotion",label:"Promotion"},{value:"campaign",label:"Campaign"},{value:"transactional",label:"Transactional"}],style:{width:160}}),e.jsx(O,{value:x,onChange:g,options:[{value:"",label:"All Statuses"},{value:"sent",label:"Sent"},{value:"failed",label:"Failed"},{value:"demo",label:"Demo"}],style:{width:140}}),e.jsx(b,{variant:"secondary",onClick:d,children:"â†» Refresh"})]}),i&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No SMS logs found."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["To","Type","Status","Message","Segments","Cost","Sent At"].map(f=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:11},children:f},f))})}),e.jsx("tbody",{children:t.map(f=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:f.to}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(k,{label:f.type,color:"blue"})}),e.jsx("td",{style:{padding:"10px 14px"},children:e.jsx(k,{label:f.status,color:D(f.status)})}),e.jsxs("td",{style:{padding:"10px 14px",color:"#475569",maxWidth:200},children:[e.jsx("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:f.message}),f.error_message&&e.jsx("span",{style:{color:"#ef4444",fontSize:11},children:f.error_message})]}),e.jsx("td",{style:{padding:"10px 14px",color:"#64748b",textAlign:"center"},children:f.segments}),e.jsxs("td",{style:{padding:"10px 14px",color:"#0ea5e9",fontWeight:600},children:["MVR ",f.cost_estimate_mvr]}),e.jsx("td",{style:{padding:"10px 14px",color:"#94a3b8",fontSize:11},children:f.sent_at?new Date(f.sent_at).toLocaleString():"â€”"})]},f.id))})]})})]})}function lt(){const[t,n]=r.useState([]),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(!1),[x,g]=r.useState(""),[d,f]=r.useState(""),[y,p]=r.useState(null),[h,c]=r.useState(!1),[w,m]=r.useState(!1),_=async()=>{o(!0);try{const j=await We();n(j.data)}catch(j){a(j.message)}finally{o(!1)}};r.useEffect(()=>{_()},[]);const se=async()=>{if(d){c(!0);try{const j=await De({message:d,criteria:{}});p(j)}catch(j){a(j.message)}finally{c(!1)}}},oe=async()=>{if(!(!x||!d)){m(!0);try{await Oe({name:x,message:d,criteria:{}}),u(!1),g(""),f(""),p(null),await _()}catch(j){a(j.message)}finally{m(!1)}}},ie=async j=>{if(confirm("Send this campaign to all recipients?"))try{await Ie(j),await _()}catch(E){a(E.message)}},le=async j=>{if(confirm("Cancel this campaign?"))try{await Ae(j),await _()}catch(E){a(E.message)}},I=d.length,q=I<=160?1:Math.ceil(I/153);return e.jsxs(e.Fragment,{children:[i&&e.jsx(R,{message:i}),!l&&e.jsx(b,{onClick:()=>u(!0),style:{marginBottom:20},children:"+ New Campaign"}),l&&e.jsxs(S,{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontWeight:700,fontSize:16,marginBottom:16},children:"New SMS Campaign"}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"Campaign Name"}),e.jsx(z,{value:x,onChange:g,placeholder:"e.g. Eid Special Offer"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569"},children:"Message"}),e.jsxs("span",{style:{fontSize:11,color:I>160?"#ef4444":"#94a3b8"},children:[I," chars Â· ",q," segment",q>1?"s":""]})]}),e.jsx("textarea",{value:d,onChange:j=>f(j.target.value),placeholder:"Type your SMS message hereâ€¦",rows:4,style:{width:"100%",border:"1px solid #e2e8f0",borderRadius:9,padding:"10px 12px",fontSize:14,fontFamily:"inherit",resize:"vertical"}})]}),y&&e.jsx("div",{style:{background:"#f0f9ff",borderRadius:10,padding:"12px 16px",marginBottom:14},children:e.jsxs("p",{style:{fontSize:14,fontWeight:600,color:"#0369a1"},children:["Preview: ",y.recipient_count," recipients Â· Est. MVR ",y.estimated_cost_mvr]})}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx(b,{variant:"secondary",onClick:se,disabled:h||!d,children:h?"Checkingâ€¦":"ðŸ‘ Preview Audience"}),e.jsx(b,{onClick:oe,disabled:w||!x||!d,children:w?"Creatingâ€¦":"Create Draft"}),e.jsx(b,{variant:"ghost",onClick:()=>{u(!1),p(null)},children:"Cancel"})]})]}),s&&t.length===0?e.jsx(T,{}):t.length===0?e.jsx(S,{children:e.jsx(P,{message:"No campaigns yet."})}):e.jsx(S,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Name","Status","Recipients","Sent","Cost","Created",""].map(j=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#475569",fontSize:12},children:j},j))})}),e.jsx("tbody",{children:t.map(j=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"12px 16px",fontWeight:600},children:j.name}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(k,{label:j.status,color:D(j.status)})}),e.jsx("td",{style:{padding:"12px 16px",color:"#475569"},children:j.total_recipients}),e.jsxs("td",{style:{padding:"12px 16px"},children:[e.jsx("span",{style:{color:"#22c55e"},children:j.sent_count}),j.failed_count>0&&e.jsxs("span",{style:{color:"#ef4444",marginLeft:4},children:["/ ",j.failed_count," failed"]})]}),e.jsxs("td",{style:{padding:"12px 16px",color:"#0ea5e9",fontWeight:600},children:["MVR ",j.total_cost_mvr??"â€”"]}),e.jsx("td",{style:{padding:"12px 16px",color:"#94a3b8",fontSize:12},children:new Date(j.created_at).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[j.status==="draft"&&e.jsx(b,{small:!0,onClick:()=>ie(j.id),style:{background:"#22c55e",color:"#fff",border:"none"},children:"Send"}),["draft","sending"].includes(j.status)&&e.jsx(b,{small:!0,variant:"danger",onClick:()=>le(j.id),children:"Cancel"})]})})]},j.id))})]})})]})}function M({label:t,value:n,color:s}){return e.jsxs(S,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:s},children:n.toLocaleString()}),e.jsx("div",{style:{fontSize:13,color:"#64748b",marginTop:4},children:t})]})}function rt(){const[t,n]=r.useState("logs");return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"SMS",subtitle:"Logs and bulk campaigns"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20,borderBottom:"2px solid #e2e8f0"},children:[["logs","Audit Logs"],["campaigns","Campaigns"]].map(([s,o])=>e.jsx("button",{onClick:()=>n(s),style:{padding:"10px 20px",fontSize:14,fontWeight:t===s?700:400,color:t===s?"#0ea5e9":"#64748b",background:"none",border:"none",cursor:"pointer",borderBottom:t===s?"2px solid #0ea5e9":"2px solid transparent",marginBottom:-2},children:o},s))}),t==="logs"?e.jsx(it,{}):e.jsx(lt,{})]})}function X(){return new Date().toISOString().slice(0,10)}function at(){const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().slice(0,10)}function $({label:t,value:n,sub:s,color:o="#0ea5e9"}){return e.jsxs(S,{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:6},children:t}),e.jsx("div",{style:{fontSize:28,fontWeight:800,color:o},children:n}),s&&e.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginTop:4},children:s})]})}function dt(){const[t,n]=r.useState(null),[s,o]=r.useState(!0),[i,a]=r.useState(""),[l,u]=r.useState(at()),[x,g]=r.useState(X()),d=async()=>{o(!0),a("");try{const y=await Ee({from:l,to:x});n(y)}catch(y){a(y.message)}finally{o(!1)}};r.useEffect(()=>{d()},[]);const f=y=>{const p=new Date;p.setDate(p.getDate()-y),u(p.toISOString().slice(0,10)),g(X())};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Reports",subtitle:"Sales overview"}),i&&e.jsx(R,{message:i}),e.jsx(S,{style:{marginBottom:20},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"From"}),e.jsx("input",{type:"date",value:l,onChange:y=>u(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,fontWeight:600,color:"#475569",display:"block",marginBottom:4},children:"To"}),e.jsx("input",{type:"date",value:x,onChange:y=>g(y.target.value),style:{border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:14}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[[[0,"Today"],[7,"7 days"],[30,"30 days"],[90,"90 days"]].map(([y,p])=>e.jsx(b,{small:!0,variant:"secondary",onClick:()=>f(y),children:p},p)),e.jsx(b,{small:!0,onClick:d,children:"Apply"})]})]})}),s?e.jsx(T,{}):t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[e.jsx($,{label:"Total Revenue",value:`MVR ${t.total_revenue.toLocaleString(void 0,{minimumFractionDigits:2})}`,color:"#22c55e"}),e.jsx($,{label:"Orders",value:t.order_count.toLocaleString(),color:"#0ea5e9"}),e.jsx($,{label:"Avg Order Value",value:`MVR ${t.average_order_value.toFixed(2)}`,color:"#8b5cf6"})]}),e.jsxs(S,{children:[e.jsxs("p",{style:{color:"#64748b",fontSize:14,textAlign:"center",padding:"20px 0"},children:["Period: ",e.jsx("strong",{children:t.period})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:13,textAlign:"center"},children:"Detailed breakdown reports (by item, category, staff) coming soon."})]})]})]})}function ct({user:t,children:n}){return t?e.jsx(e.Fragment,{children:n}):e.jsx(N,{to:"/login",replace:!0})}function xt(){const[t,n]=r.useState(null),[s,o]=r.useState(!0),i=Q();r.useEffect(()=>{if(!localStorage.getItem("admin_token")){o(!1);return}je().then(x=>n(x.user)).catch(()=>{localStorage.removeItem("admin_token"),i("/login")}).finally(()=>o(!1))},[]);const a=(u,x)=>{n(x),i("/orders")},l=()=>{n(null)};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9"},children:e.jsx("div",{style:{color:"#64748b",fontSize:14},children:"Loadingâ€¦"})}):e.jsxs(H,{children:[e.jsx(C,{path:"/login",element:e.jsx($e,{onLogin:a})}),e.jsx(C,{path:"/*",element:e.jsx(ct,{user:t,children:e.jsx(Me,{user:t,onLogout:l,children:e.jsxs(H,{children:[e.jsx(C,{index:!0,element:e.jsx(N,{to:"/orders",replace:!0})}),e.jsx(C,{path:"orders",element:e.jsx(He,{})}),e.jsx(C,{path:"kds",element:e.jsx(Ye,{})}),e.jsx(C,{path:"delivery",element:e.jsx(Ge,{})}),e.jsx(C,{path:"promotions",element:e.jsx(et,{})}),e.jsx(C,{path:"loyalty",element:e.jsx(ot,{})}),e.jsx(C,{path:"sms",element:e.jsx(rt,{})}),e.jsx(C,{path:"reports",element:e.jsx(dt,{})}),e.jsx(C,{path:"*",element:e.jsx(N,{to:"/orders",replace:!0})})]})})})})]})}V.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(ce,{basename:"/admin",children:e.jsx(xt,{})})}));
